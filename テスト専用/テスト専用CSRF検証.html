<!DOCTYPE html>
<html lang="ja">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>ğŸ”’ CSRFè„†å¼±æ€§ãƒ†ã‚¹ãƒˆï¼ˆæœ¬ç•ªé‹ç”¨ç‰ˆï¼‰</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                display: flex;
                justify-content: center;
                align-items: center;
                padding: 20px;
            }
            .container {
                background: white;
                border-radius: 20px;
                box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
                max-width: 700px;
                width: 100%;
                padding: 40px;
            }
            h1 {
                color: #667eea;
                margin-bottom: 10px;
                font-size: 2em;
                text-align: center;
            }
            .subtitle {
                text-align: center;
                color: #666;
                margin-bottom: 30px;
                font-size: 0.9em;
            }
            .config-section {
                background: #f8f9fa;
                padding: 20px;
                border-radius: 10px;
                margin-bottom: 20px;
                border-left: 4px solid #667eea;
            }
            .config-section h2 {
                color: #667eea;
                font-size: 1.2em;
                margin-bottom: 15px;
            }
            label {
                display: block;
                margin: 10px 0 5px 0;
                font-weight: bold;
                color: #555;
            }
            input[type='text'] {
                width: 100%;
                padding: 10px;
                border: 2px solid #ddd;
                border-radius: 5px;
                font-size: 1em;
                font-family: 'Courier New', monospace;
            }
            input[type='text']:focus {
                outline: none;
                border-color: #667eea;
            }
            .attack-section {
                margin: 20px 0;
                padding: 20px;
                background: #f8f9fa;
                border-radius: 10px;
                border-left: 4px solid #dc3545;
            }
            .attack-section h2 {
                color: #dc3545;
                margin-bottom: 15px;
                font-size: 1.2em;
            }
            button {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                border: none;
                padding: 15px 30px;
                font-size: 1em;
                border-radius: 50px;
                cursor: pointer;
                transition: transform 0.2s, box-shadow 0.2s;
                margin: 5px;
                width: calc(50% - 10px);
            }
            button:hover {
                transform: translateY(-2px);
                box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
            }
            button:active {
                transform: translateY(0);
            }
            .danger-btn {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            }
            .clear-btn {
                background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
                width: 100%;
            }
            #result {
                margin-top: 20px;
                padding: 15px;
                border-radius: 10px;
                display: none;
                max-height: 400px;
                overflow-y: auto;
            }
            .log-entry {
                padding: 8px;
                margin: 5px 0;
                border-radius: 5px;
                font-size: 0.9em;
            }
            .success {
                background: #d4edda;
                color: #155724;
                border: 1px solid #c3e6cb;
            }
            .error {
                background: #f8d7da;
                color: #721c24;
                border: 1px solid #f5c6cb;
            }
            .warning {
                background: #fff3cd;
                color: #856404;
                border: 1px solid #ffeaa7;
            }
            .info {
                background: #d1ecf1;
                color: #0c5460;
                border: 1px solid #bee5eb;
            }
            .help-box {
                background: #e7f3ff;
                padding: 15px;
                border-radius: 10px;
                margin: 20px 0;
                border-left: 4px solid #2196f3;
            }
            .help-box h3 {
                color: #2196f3;
                margin-bottom: 10px;
                font-size: 1.1em;
            }
            .help-box ul {
                margin-left: 20px;
                line-height: 1.8;
            }
            .attack-info {
                background: #fff9e6;
                padding: 12px;
                border-radius: 5px;
                margin: 10px 0;
                font-size: 0.9em;
                border-left: 3px solid #ffc107;
            }
            code {
                background: #f4f4f4;
                padding: 2px 6px;
                border-radius: 3px;
                font-family: 'Courier New', monospace;
                font-size: 0.9em;
            }
            .status-indicator {
                display: inline-block;
                width: 10px;
                height: 10px;
                border-radius: 50%;
                margin-right: 5px;
            }
            .status-safe {
                background: #28a745;
            }
            .status-danger {
                background: #dc3545;
            }
            .current-target {
                background: #f8f9fa;
                padding: 12px;
                border-radius: 5px;
                font-family: 'Courier New', monospace;
                color: #333;
                margin-top: 10px;
                word-break: break-all;
            }
        </style>
    </head>
    <body>
        <div class="container">
            <h1>ğŸ”’ CSRFè„†å¼±æ€§ãƒ†ã‚¹ãƒˆ</h1>
            <p class="subtitle">
                Django REST Framework + Vue.js SPA æœ¬ç•ªé‹ç”¨ç‰ˆ
            </p>

            <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="config-section">
                <h2>âš™ï¸ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆè¨­å®š</h2>

                <label for="apiBase">
                    APIãƒ™ãƒ¼ã‚¹URL:
                    <small style="color: #666; font-weight: normal">
                        (axios.defaults.baseURL ã¨åŒã˜)
                    </small>
                </label>
                <input
                    type="text"
                    id="apiBase"
                    value="http://localhost:8000/api/"
                    placeholder="http://localhost:8000/api/"
                />
                <small style="color: #666; display: block; margin-top: 5px">
                    ä¾‹: config/urls.py ã® <code>path('api/', ...)</code> ã¾ã§
                </small>

                <label for="targetEndpoint" style="margin-top: 15px">
                    æ”»æ’ƒå¯¾è±¡ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ:
                    <small style="color: #666; font-weight: normal">
                        (backend/api/xxx/urls.py ã§å®šç¾©ã•ã‚ŒãŸãƒ‘ã‚¹)
                    </small>
                </label>
                <input
                    type="text"
                    id="targetEndpoint"
                    value="auth/logout/"
                    placeholder="auth/logout/"
                />
                <small style="color: #666; display: block; margin-top: 5px">
                    ä¾‹: <code>auth/logout/</code>, <code>users/me/</code>,
                    <code>posts/123/delete/</code>
                </small>

                <div class="current-target" id="currentTarget">
                    èª­ã¿è¾¼ã¿ä¸­...
                </div>
            </div>

            <!-- æ”»æ’ƒãƒ‘ã‚¿ãƒ¼ãƒ³èª¬æ˜ -->
            <div class="help-box">
                <h3>ğŸ¯ ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ2ç¨®é¡ï¼‰</h3>
                <div class="attack-info">
                    <strong>Pattern 1: Fetch API</strong><br />
                    <span class="status-indicator status-safe"></span>
                    é€šå¸¸ã®JavaScriptæ”»æ’ƒã€‚<code>ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆç™ºç”Ÿ</code> â†’
                    CORSã§é˜²ãŒã‚Œã‚‹ã¯ãšã€‚
                </div>
                <div class="attack-info">
                    <strong>Pattern 2: Formé€ä¿¡ï¼ˆæœ¬å‘½âš¡ï¼‰</strong><br />
                    <span class="status-indicator status-danger"></span>
                    å®Ÿéš›ã®æ”»æ’ƒæ‰‹æ³•ã€‚<code>ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãªã—</code> â†’ CORSãƒã‚¤ãƒ‘ã‚¹
                    â†’ CSRFãƒˆãƒ¼ã‚¯ãƒ³ã§é˜²ãå¿…è¦ã‚ã‚Šã€‚<br />
                    <small
                        >â€»éš ã—iframeä½¿ç”¨ã§ãƒšãƒ¼ã‚¸é·ç§»ãªã—ï¼ˆå®Ÿéš›ã®æ”»æ’ƒã¨åŒã˜ï¼‰</small
                    >
                </div>
            </div>

            <!-- æ”»æ’ƒãƒ†ã‚¹ãƒˆ -->
            <div class="attack-section">
                <h2>âš ï¸ æ”»æ’ƒå®Ÿè¡Œ</h2>
                <button onclick="attack1()">Pattern 1: Fetch API</button>
                <button onclick="attack2()" class="danger-btn">
                    Pattern 2: Formé€ä¿¡ âš¡
                </button>
                <button onclick="clearResults()" class="clear-btn">
                    ğŸ—‘ï¸ ãƒ­ã‚°ã‚’ã‚¯ãƒªã‚¢
                </button>
            </div>

            <!-- çµæœè¡¨ç¤º -->
            <div id="result"></div>

            <!-- ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰ -->
            <div class="help-box">
                <h3>ğŸ“– ãƒ†ã‚¹ãƒˆæ‰‹é †</h3>
                <ol style="margin-left: 20px; line-height: 1.8">
                    <li>
                        å¯¾è±¡ã‚µã‚¤ãƒˆã«<strong>åˆ¥ã‚¿ãƒ–ã§ãƒ­ã‚°ã‚¤ãƒ³</strong>ã—ã¦ãŠã
                    </li>
                    <li>ä¸Šã®è¨­å®šã§APIã®URLã‚’ç¢ºèªï¼ˆå¿…è¦ãªã‚‰å¤‰æ›´ï¼‰</li>
                    <li>å„Patternãƒœã‚¿ãƒ³ã§æ”»æ’ƒã‚’ãƒ†ã‚¹ãƒˆ</li>
                    <li><code>F12</code>ã§Networkã‚¿ãƒ–ã‚’é–‹ã„ã¦çµæœã‚’ç¢ºèª</li>
                </ol>
                <br />
                <strong>âœ… æ­£å¸¸ãªé˜²å¾¡ï¼ˆæœŸå¾…ã•ã‚Œã‚‹çµæœï¼‰:</strong>
                <ul style="margin-left: 20px; margin-top: 5px">
                    <li>
                        Pattern 1: <code>CORS error</code> ã¾ãŸã¯
                        <code>403 Forbidden</code>
                    </li>
                    <li>
                        Pattern 2: <code>403 Forbidden</code> (CSRF token
                        missing)
                    </li>
                </ul>
                <br />
                <strong>âŒ è„†å¼±æ€§ã‚ã‚Šï¼ˆä¿®æ­£å¿…è¦ï¼‰:</strong>
                <ul style="margin-left: 20px; margin-top: 5px">
                    <li>ã©ã¡ã‚‰ã‹ã§ <code>200 OK</code> ãŒè¿”ã‚‹å ´åˆ</li>
                </ul>
            </div>

            <!-- é‡è¦ãªè­¦å‘Š -->
            <div
                class="help-box"
                style="background: #ffe6e6; border-left: 4px solid #dc3545"
            >
                <h3 style="color: #dc3545">ğŸš¨ æœ¬ç•ªç’°å¢ƒã§ã®é‡è¦ãªæ³¨æ„</h3>
                <p style="line-height: 1.8; margin-bottom: 10px">
                    <strong
                        >IPåˆ¶é™ãƒ»HTTPSãƒ»ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ã§ã¯CSRFæ”»æ’ƒã‚’é˜²ã’ã¾ã›ã‚“ï¼</strong
                    ><br />
                    ç†ç”±:
                    æ”»æ’ƒã¯<strong>æ­£è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã€æ­£è¦IPã§å®Ÿè¡Œã•ã‚Œã‚‹</strong>ãŸã‚
                </p>
                <p style="font-size: 0.9em; color: #666">
                    ãƒ­ãƒ¼ã‚«ãƒ«ã§200 OKãŒå‡ºã‚‹ = æœ¬ç•ªã§ã‚‚è„†å¼±æ€§ã‚ã‚Š<br />
                    ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¶é™ã«é–¢ä¿‚ãªãæ”»æ’ƒå¯èƒ½ã§ã™
                </p>
            </div>
        </div>

        <!-- éš ã—Iframeï¼ˆç”»é¢é·ç§»ã‚’é˜²ãï¼‰ -->
        <iframe name="csrfFrame" style="display: none"></iframe>

        <!-- éš ã—Form -->
        <form
            id="csrfForm"
            method="POST"
            target="csrfFrame"
            style="display: none"
        >
            <input type="hidden" name="attack_test" value="csrf_simulation" />
        </form>

        <script>
            let config = {
                apiBase: 'http://localhost:8000/api/',
                endpoint: 'auth/logout/',
                fullUrl: '',
            };

            const resultDiv = document.getElementById('result');

            // åˆæœŸåŒ–
            window.onload = () => {
                updateConfig();
                console.log(
                    '%cğŸ”’ CSRFè„†å¼±æ€§ãƒ†ã‚¹ãƒˆ',
                    'color: red; font-size: 20px; font-weight: bold;',
                );
                console.log('æœ¬ç•ªé‹ç”¨ç‰ˆ - Django REST Framework + Vue.js SPA');
                console.log('ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ:', config.fullUrl);
            };

            // è¨­å®šæ›´æ–°
            function updateConfig() {
                config.apiBase = document
                    .getElementById('apiBase')
                    .value.trim();
                config.endpoint = document
                    .getElementById('targetEndpoint')
                    .value.trim();

                if (!config.apiBase.endsWith('/')) {
                    config.apiBase += '/';
                }

                config.fullUrl = config.apiBase + config.endpoint;

                document.getElementById('currentTarget').innerHTML = `
                <strong>ãƒ†ã‚¹ãƒˆå¯¾è±¡:</strong> ${config.fullUrl}
            `;

                document.getElementById('csrfForm').action = config.fullUrl;
            }

            // URLå¤‰æ›´æ™‚ã«è‡ªå‹•æ›´æ–°
            document
                .getElementById('apiBase')
                .addEventListener('change', updateConfig);
            document
                .getElementById('targetEndpoint')
                .addEventListener('change', updateConfig);

            // ãƒ­ã‚°è¡¨ç¤º
            function showLog(msg, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                resultDiv.innerHTML += `
                <div class="log-entry ${type}">
                    <strong>[${timestamp}]</strong> ${msg}
                </div>
            `;
                resultDiv.style.display = 'block';
                resultDiv.scrollTop = resultDiv.scrollHeight;
            }

            // ãƒ­ã‚°ã‚¯ãƒªã‚¢
            function clearResults() {
                resultDiv.innerHTML = '';
                resultDiv.style.display = 'none';
            }

            // Pattern 1: Fetch APIï¼ˆCORSãƒ–ãƒ­ãƒƒã‚¯æœŸå¾…ï¼‰
            async function attack1() {
                showLog(
                    `ğŸš€ Pattern 1 é–‹å§‹: Fetch APIæ”»æ’ƒ â†’ ${config.fullUrl}`,
                    'warning',
                );
                showLog(
                    'ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãƒªã‚¯ã‚¨ã‚¹ãƒˆç™ºç”Ÿ â†’ CORSã§é˜²ãŒã‚Œã‚‹ã¯ãš',
                    'info',
                );

                try {
                    const response = await fetch(config.fullUrl, {
                        method: 'POST',
                        credentials: 'include', // Cookieé€ä¿¡
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({}),
                    });

                    if (response.ok) {
                        showLog(
                            'âŒ æ”»æ’ƒæˆåŠŸï¼CSRFãƒˆãƒ¼ã‚¯ãƒ³ãªã—ã§å®Ÿè¡Œã§ãã¾ã—ãŸï¼ˆè„†å¼±æ€§ã‚ã‚Šï¼‰',
                            'error',
                        );
                    } else {
                        showLog(
                            `âœ… é˜²å¾¡æˆåŠŸï¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status} - ã‚µãƒ¼ãƒãƒ¼å´ã§æ‹’å¦ã•ã‚Œã¾ã—ãŸ`,
                            'success',
                        );
                    }
                } catch (error) {
                    showLog(
                        `âœ… é˜²å¾¡æˆåŠŸï¼CORSã«ã‚ˆã‚Šãƒ–ãƒ­ãƒƒã‚¯: ${error.message}`,
                        'success',
                    );
                }
            }

            // Pattern 2: Formé€ä¿¡ï¼ˆCORSãƒã‚¤ãƒ‘ã‚¹ã€å®Ÿéš›ã®æ”»æ’ƒæ‰‹æ³•ï¼‰
            function attack2() {
                showLog(
                    `ğŸš€ Pattern 2 é–‹å§‹: Formé€ä¿¡æ”»æ’ƒ â†’ ${config.fullUrl}`,
                    'warning',
                );
                showLog(
                    'âš¡ ãƒ—ãƒªãƒ•ãƒ©ã‚¤ãƒˆãªã— â†’ CORSã‚’ãƒã‚¤ãƒ‘ã‚¹ â†’ CSRFãƒˆãƒ¼ã‚¯ãƒ³ã§é˜²ãå¿…è¦ã‚ã‚Š',
                    'info',
                );
                showLog(
                    'ğŸ’¡ éš ã—iframeä½¿ç”¨ã®ãŸã‚ãƒšãƒ¼ã‚¸é·ç§»ãªã—ï¼ˆå®Ÿéš›ã®æ”»æ’ƒã¨åŒã˜ï¼‰',
                    'info',
                );

                const form = document.getElementById('csrfForm');
                form.submit();

                setTimeout(() => {
                    showLog(
                        'ğŸ” F12ã®Networkã‚¿ãƒ–ã§ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:',
                        'info',
                    );
                    showLog(
                        'âœ… <strong>403 Forbidden</strong> ãªã‚‰é˜²å¾¡æˆåŠŸï¼ˆCSRFãƒˆãƒ¼ã‚¯ãƒ³ã§æ‹’å¦ï¼‰',
                        'success',
                    );
                    showLog(
                        'âŒ <strong>200 OK</strong> ãªã‚‰è„†å¼±æ€§ã‚ã‚Šï¼ˆå³ä¿®æ­£ãŒå¿…è¦ï¼‰',
                        'error',
                    );
                }, 500);
            }
        </script>
    </body>
</html>
