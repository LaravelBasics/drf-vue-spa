# Vue 3 ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã‚¬ã‚¤ãƒ‰

> **å¯¾è±¡è€…**: Vue 3 + Pinia + Vuetify 3 ã®åˆæœŸåŒ–å‡¦ç†ã‚’ç†è§£ã—ãŸã„æ–¹  
> **ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ**: å›³è§£ä¸­å¿ƒã§å‡¦ç†ã®æµã‚Œã‚’è§£èª¬

---

## ğŸ“– ç›®æ¬¡

1. [ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã¨ã¯ï¼Ÿ](#ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã¨ã¯)
2. [Vue 3 ã®åˆæœŸåŒ–ã®åŸºæœ¬](#vue-3-ã®åˆæœŸåŒ–ã®åŸºæœ¬)
3. [ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™»éŒ²é †åº](#ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™»éŒ²é †åº)
4. [Pinia ã®åˆæœŸåŒ–ã¨æ°¸ç¶šåŒ–](#pinia-ã®åˆæœŸåŒ–ã¨æ°¸ç¶šåŒ–)
5. [èªè¨¼çŠ¶æ…‹ã®å¾©å…ƒ](#èªè¨¼çŠ¶æ…‹ã®å¾©å…ƒ)
6. [å¤šè¨€èªè¨­å®šã®åˆæœŸåŒ–](#å¤šè¨€èªè¨­å®šã®åˆæœŸåŒ–)
7. [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°](#ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°)
8. [Graceful Degradation](#graceful-degradation)
9. [ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯](#ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯)

---

## ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³åˆæœŸåŒ–ã¨ã¯ï¼Ÿ

### ğŸ¯ å½¹å‰²

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒ—ãƒªã‚’é–‹ã„ãŸã¨ãã€ç”»é¢ã‚’è¡¨ç¤ºã™ã‚‹å‰ã«è¡Œã†æº–å‚™ä½œæ¥­**

### ğŸ“ ãªãœå¿…è¦ï¼Ÿ

```
ã€å•é¡Œã€‘
ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒšãƒ¼ã‚¸ã‚’é–‹ã
â†’ ã„ããªã‚Šç”»é¢è¡¨ç¤º
â†’ ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãŒä¸æ˜
â†’ è¨€èªè¨­å®šãŒãƒªã‚»ãƒƒãƒˆ
â†’ ä½¿ã„ã«ãã„...

ã€è§£æ±ºã€‘
åˆæœŸåŒ–å‡¦ç†ã§äº‹å‰æº–å‚™
â†’ ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’å¾©å…ƒ
â†’ è¨€èªè¨­å®šã‚’é©ç”¨
â†’ ã‚¹ãƒ ãƒ¼ã‚ºã«ä½¿ãˆã‚‹ï¼
```

### ğŸ”„ åˆæœŸåŒ–ã®æµã‚Œï¼ˆå…¨ä½“åƒï¼‰

```
ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒšãƒ¼ã‚¸ã‚’é–‹ãã€‘
   â†“
â‘  HTMLèª­ã¿è¾¼ã¿ (index.html)
   â†“
â‘¡ JavaScriptèª­ã¿è¾¼ã¿ (main.js)
   â†“
â‘¢ Vue ã‚¢ãƒ—ãƒªä½œæˆ (createApp)
   â†“
â‘£ ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç™»éŒ² (Pinia, Router, Vuetify, i18n)
   â†“
â‘¤ åˆæœŸåŒ–å‡¦ç† (initializeApp)
   â”œâ”€ èªè¨¼çŠ¶æ…‹ã®å¾©å…ƒ
   â”œâ”€ è¨€èªè¨­å®šã®é©ç”¨
   â””â”€ ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°è¨­å®š
   â†“
â‘¥ DOM ã«ãƒã‚¦ãƒ³ãƒˆ (app.mount)
   â†“
ã€ç”»é¢è¡¨ç¤ºã€‘
```

---

## Vue 3 ã®åˆæœŸåŒ–ã®åŸºæœ¬

### ğŸ¯ createApp ã®å½¹å‰²

Vue 3ã§ã¯ã€createAppé–¢æ•°ã‚’ä½¿ã£ã¦ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¬ãƒ™ãƒ«ã®è¨­å®šã‚’é©ç”¨ã—ã¦ã‹ã‚‰ã€mount()ãƒ¡ã‚½ãƒƒãƒ‰ã§DOMã«ãƒã‚¦ãƒ³ãƒˆã™ã‚‹

### ğŸ“Š Vue 2 vs Vue 3

**Vue 2ï¼ˆæ—§ï¼‰:**

```javascript
// ã‚°ãƒ­ãƒ¼ãƒãƒ«ãª Vue ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
import Vue from 'vue';

new Vue({
    router,
    store,
    render: h => h(App)
}).$mount('#app');

// å•é¡Œç‚¹:
// ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«æ±šæŸ“
// ãƒ»è¤‡æ•°ã‚¢ãƒ—ãƒªã§è¨­å®šãŒå…±æœ‰ã•ã‚Œã‚‹
// ãƒ»ãƒ†ã‚¹ãƒˆãŒå›°é›£
```

**Vue 3ï¼ˆæ–°ï¼‰:**

```javascript
// ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
import { createApp } from 'vue';

const app = createApp(App);

app.use(router);
app.use(store);

app.mount('#app');

// ãƒ¡ãƒªãƒƒãƒˆ:
// ãƒ»ç‹¬ç«‹ã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚³ãƒ¼ãƒ—
// ãƒ»è¤‡æ•°ã‚¢ãƒ—ãƒªã®å…±å­˜ãŒå¯èƒ½
// ãƒ»ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“
```

### ğŸ” ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã®å®Ÿè£…

```javascript
// main.js
import { createApp } from 'vue';
import App from './App.vue';

const app = createApp(App);

// â‘  Pinia (çŠ¶æ…‹ç®¡ç†)
app.use(pinia);

// â‘¡ Vue Router (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
app.use(router);

// â‘¢ Vuetify (UI)
app.use(vuetify);

// â‘£ Vue I18n (å¤šè¨€èª)
app.use(i18n);

// â‘¤ DOM ã«ãƒã‚¦ãƒ³ãƒˆ
app.mount('#app');
```

**å›³è§£:**

```
createApp(App)
    â†“ ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ
ã€app ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã€‘
    â†“ .use(pinia)
ã€app + Piniaã€‘
    â†“ .use(router)
ã€app + Pinia + Routerã€‘
    â†“ .use(vuetify)
ã€app + Pinia + Router + Vuetifyã€‘
    â†“ .use(i18n)
ã€app + ã™ã¹ã¦ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã€‘
    â†“ .mount('#app')
ã€DOM ã«è¡¨ç¤ºã€‘
```

---

## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™»éŒ²é †åº

### ğŸ¯ ãªãœé †åºãŒé‡è¦ï¼Ÿ

**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³é–“ã«ä¾å­˜é–¢ä¿‚ãŒã‚ã‚‹ãŸã‚**

### ğŸ“Š ç™»éŒ²é †åºã®ãƒ«ãƒ¼ãƒ«

```
1ï¸âƒ£ Pinia (çŠ¶æ…‹ç®¡ç†)
   â†“ Router ãŒ Pinia ã‚’ä½¿ã†
2ï¸âƒ£ Vue Router (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)
   â†“ Vuetify ãŒ Router ã‚’ä½¿ã†
3ï¸âƒ£ Vuetify (UI)
   â†“ i18n ãŒ Vuetify ã¨é€£æº
4ï¸âƒ£ Vue I18n (å¤šè¨€èª)
```

### ğŸ” ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§ã®å®Ÿè£…

```javascript
// é †åºé‡è¦: Pinia â†’ Router â†’ Vuetify â†’ i18n
const pinia = createPinia();
pinia.use(piniaPluginPersistedstate);  // æ°¸ç¶šåŒ–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³

app.use(pinia);      // â‘  æœ€åˆã« Pinia
app.use(router);     // â‘¡ Routerï¼ˆPinia ã‚’ä½¿ã†ï¼‰
app.use(vuetify);    // â‘¢ Vuetify
app.use(i18n);       // â‘£ i18nï¼ˆæœ€å¾Œï¼‰
```

**ãªãœã“ã®é †åºï¼Ÿ**

```
ã€Pinia ã‚’å…ˆã«ç™»éŒ²ã€‘
Router ã® Navigation Guard ã§
useAuthStore() ã‚’ä½¿ã†ãŸã‚

router.beforeEach((to, from) => {
    const auth = useAuthStore();  // â† Piniaå¿…é ˆ
    if (to.meta.requiresAuth && !auth.user) {
        return '/login';
    }
});

ã€Vuetify ã‚’ Router ã®å¾Œã€‘
ãƒ«ãƒ¼ãƒˆé·ç§»æ™‚ã« Vuetify ã®
ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤ºãªã©ã‚’ä½¿ã†ãŸã‚

ã€i18n ã‚’æœ€å¾Œã€‘
ä»–ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒ
ç¿»è¨³æ©Ÿèƒ½ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚
```

### âš ï¸ é–“é•ã£ãŸé †åºã®ä¾‹

```javascript
// âŒ é–“é•ã„: Router ã‚’å…ˆã«ç™»éŒ²
app.use(router);
app.use(pinia);

// ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ:
// Uncaught Error: 
// [ğŸ]: "getActivePinia()" was called but there was no active Pinia.
```

---

## Pinia ã®åˆæœŸåŒ–ã¨æ°¸ç¶šåŒ–

### ğŸ¯ Pinia ã®å½¹å‰²

**ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†**

### ğŸ“Š æ°¸ç¶šåŒ–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ä»•çµ„ã¿

Piniaã®æ°¸ç¶šåŒ–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¯ã€æŒ‡å®šã•ã‚ŒãŸstateã‚’localStorageã«è‡ªå‹•ä¿å­˜ã—ã€ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚çŠ¶æ…‹ã‚’å¾©å…ƒã™ã‚‹

```
ã€é€šå¸¸ã® Piniaï¼ˆæ°¸ç¶šåŒ–ãªã—ï¼‰ã€‘
ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰
   â†“
ã™ã¹ã¦ã® State ãŒãƒªã‚»ãƒƒãƒˆ
   â†“
ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒæ¶ˆãˆã‚‹
   â†“
å†ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦

ã€pinia-plugin-persistedstateï¼ˆæ°¸ç¶šåŒ–ã‚ã‚Šï¼‰ã€‘
ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰
   â†“
localStorage ã‹ã‚‰ State ã‚’å¾©å…ƒ
   â†“
ãƒ­ã‚°ã‚¤ãƒ³æƒ…å ±ãŒæ®‹ã‚‹
   â†“
ãã®ã¾ã¾ä½¿ãˆã‚‹ï¼
```

### ğŸ” ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§ã®å®Ÿè£…

**ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®ç™»éŒ²:**

```javascript
// main.js
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate';

const pinia = createPinia();
pinia.use(piniaPluginPersistedstate);  // æ°¸ç¶šåŒ–æ©Ÿèƒ½ã‚’è¿½åŠ 

app.use(pinia);
```

**Store ã§ã®è¨­å®š:**

```javascript
// stores/auth.js
export const useAuthStore = defineStore('auth', () => {
    const user = ref(null);
    
    return { user };
}, {
    persist: {
        paths: ['user'],  // user ã®ã¿æ°¸ç¶šåŒ–
    },
});
```

**å›³è§£:**

```
ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³ã€‘
user.value = { id: 1, name: 'å¤ªéƒ' }
   â†“
ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•å®Ÿè¡Œã€‘
localStorage.setItem(
    'auth',
    JSON.stringify({ user: { id: 1, name: 'å¤ªéƒ' } })
)

ã€ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã€‘
   â†“
ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ãŒè‡ªå‹•å®Ÿè¡Œã€‘
const stored = localStorage.getItem('auth');
user.value = JSON.parse(stored).user;
   â†“
ã€ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ãŒå¾©å…ƒã€‘
```

### ğŸ¨ LocalStorage ã®ç¢ºèªæ–¹æ³•

**Chrome DevTools ã§ç¢ºèª:**

```
F12 â†’ Application ã‚¿ãƒ–
  â”œâ”€ Local Storage
  â”‚   â””â”€ http://localhost:5173
  â”‚       â”œâ”€ auth  â† èªè¨¼çŠ¶æ…‹
  â”‚       â””â”€ locale  â† è¨€èªè¨­å®š
```

**ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿:**

```json
// auth
{
  "user": {
    "id": 1,
    "employee_id": "9999",
    "username": "ç®¡ç†è€…",
    "is_admin": true
  }
}

// locale
{
  "locale": "ja"
}
```

---

## èªè¨¼çŠ¶æ…‹ã®å¾©å…ƒ

### ğŸ¯ å½¹å‰²

**ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã‚’ç¶­æŒã™ã‚‹**

### ğŸ“Š å¾©å…ƒã®æµã‚Œ

```
ã€ã‚¢ãƒ—ãƒªèµ·å‹•ã€‘
   â†“
â‘  localStorage ã‹ã‚‰ user ã‚’èª­ã¿è¾¼ã¿
   user.value = { id: 1, ... }
   â†“
â‘¡ ã‚µãƒ¼ãƒãƒ¼ã«ç¢ºèªãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   GET /api/auth/me/
   â†“
â‘¢-A ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹
     â†’ user æƒ…å ±ã‚’æ›´æ–°
     â†’ ãƒ›ãƒ¼ãƒ ç”»é¢ã¸
   â†“
â‘¢-B ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹ï¼ˆ403ã‚¨ãƒ©ãƒ¼ï¼‰
     â†’ user ã‚’ã‚¯ãƒªã‚¢
     â†’ ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸
```

### ğŸ” ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§ã®å®Ÿè£…

**initializeApp é–¢æ•°:**

```javascript
// main.js
const initializeApp = async () => {
    try {
        const authStore = useAuthStore();
        
        // èªè¨¼çŠ¶æ…‹ã‚’åˆæœŸåŒ–ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å¾©å…ƒï¼‰
        await authStore.initialize();
        
    } catch (error) {
        console.error('Initialization error:', error);
    } finally {
        // åˆæœŸåŒ–ã®æˆå¦ã«é–¢ã‚ã‚‰ãšã‚¢ãƒ—ãƒªã‚’èµ·å‹•
        app.mount('#app');
    }
};

initializeApp();
```

**authStore.initialize() ã®ä¸­èº«:**

```javascript
// stores/auth.js
async function initialize() {
    if (initialized.value) {
        return;  // 2å›ç›®ä»¥é™ã¯å®Ÿè¡Œã—ãªã„
    }
    
    loading.value = true;
    
    try {
        if (user.value) {
            // localStorage ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒã‚ã‚‹
            try {
                await fetchUser();  // ã‚µãƒ¼ãƒãƒ¼ã¨åŒæœŸ
            } catch (error) {
                if (error.response?.status === 403) {
                    // ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹
                    user.value = null;
                }
            }
        }
    } finally {
        initialized.value = true;
        loading.value = false;
    }
}
```

**å›³è§£:**

```
ã€ãƒ‘ã‚¿ãƒ¼ãƒ³1: ã‚»ãƒƒã‚·ãƒ§ãƒ³æœ‰åŠ¹ã€‘
localStorage: user ã‚ã‚Š
   â†“
fetchUser() å®Ÿè¡Œ
   â†“ GET /api/auth/me/
Django: Cookie ã® sessionid ã‚’ç¢ºèª
   â†“
200 OK + æœ€æ–°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
   â†“
user.value ã‚’æ›´æ–°
   â†“
ãƒ›ãƒ¼ãƒ ç”»é¢ã¸

ã€ãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç„¡åŠ¹ã€‘
localStorage: user ã‚ã‚Š
   â†“
fetchUser() å®Ÿè¡Œ
   â†“ GET /api/auth/me/
Django: ã‚»ãƒƒã‚·ãƒ§ãƒ³æœŸé™åˆ‡ã‚Œ
   â†“
403 Forbidden
   â†“
user.value = null
   â†“
ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸

ã€ãƒ‘ã‚¿ãƒ¼ãƒ³3: æœªãƒ­ã‚°ã‚¤ãƒ³ã€‘
localStorage: user ãªã—
   â†“
initialize() ã¯ä½•ã‚‚ã—ãªã„
   â†“
ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã¸
```

### âš ï¸ ã‚ˆãã‚ã‚‹å•é¡Œã¨å¯¾ç­–

**å•é¡Œ1: ç„¡é™ãƒ«ãƒ¼ãƒ—**

```javascript
// âŒ é–“é•ã„: initialized ãƒã‚§ãƒƒã‚¯ãªã—
async function initialize() {
    await fetchUser();  // æ¯å›å®Ÿè¡Œã•ã‚Œã‚‹
}

// âœ… æ­£ã—ã„: initialized ãƒ•ãƒ©ã‚°
async function initialize() {
    if (initialized.value) {
        return;  // 2å›ç›®ä»¥é™ã¯ã‚¹ã‚­ãƒƒãƒ—
    }
    
    await fetchUser();
    initialized.value = true;
}
```

**å•é¡Œ2: ãƒã‚¦ãƒ³ãƒˆå‰ã«ã‚¨ãƒ©ãƒ¼é€šçŸ¥**

```javascript
// âŒ é–“é•ã„: ãƒã‚¦ãƒ³ãƒˆå‰ã«é€šçŸ¥
const initializeApp = async () => {
    try {
        await authStore.initialize();
    } catch (error) {
        notification.error('åˆæœŸåŒ–å¤±æ•—');  // ã‚¨ãƒ©ãƒ¼ï¼
    }
    app.mount('#app');
};

// âœ… æ­£ã—ã„: ãƒã‚¦ãƒ³ãƒˆå¾Œã«é€šçŸ¥
const initializeApp = async () => {
    let initializationError = null;
    
    try {
        await authStore.initialize();
    } catch (error) {
        initializationError = error;
    } finally {
        app.mount('#app');
        
        if (initializationError) {
            await nextTick();
            notification.error('åˆæœŸåŒ–å¤±æ•—');
        }
    }
};
```

---

## å¤šè¨€èªè¨­å®šã®åˆæœŸåŒ–

### ğŸ¯ å½¹å‰²

**ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨€èªè¨­å®šã‚’å¾©å…ƒã—ã€Vuetify ã¨åŒæœŸã™ã‚‹**

### ğŸ“Š åˆæœŸåŒ–ã®æµã‚Œ

```
ã€åˆå›ã‚¢ã‚¯ã‚»ã‚¹ã€‘
â‘  ãƒ–ãƒ©ã‚¦ã‚¶ã®è¨€èªè¨­å®šã‚’å–å¾—
   navigator.language â†’ 'ja-JP'
   â†“
â‘¡ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨€èªã‚’æ±ºå®š
   'ja-JP' â†’ 'ja'
   â†“
â‘¢ Vue I18n ã«è¨­å®š
   i18n.global.locale.value = 'ja'
   â†“
â‘£ localStorage ã«ä¿å­˜
   { "locale": "ja" }

ã€2å›ç›®ä»¥é™ã€‘
â‘  localStorage ã‹ã‚‰èª­ã¿è¾¼ã¿
   locale.value = 'ja'
   â†“
â‘¡ watch ãŒç™ºç«
   â†“
â‘¢ Vue I18n ã¨ Vuetify ã«åæ˜ 
   i18n.global.locale.value = 'ja'
   vuetify.locale.current = 'ja'
```

### ğŸ” ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§ã®å®Ÿè£…

**ãƒ–ãƒ©ã‚¦ã‚¶è¨€èªã®æ¤œå‡º:**

```javascript
// plugins/i18n.js
const getDefaultLocale = () => {
    const browserLocale = navigator.language || navigator.userLanguage;
    
    if (browserLocale.startsWith('ja')) return 'ja';
    if (browserLocale.startsWith('en')) return 'en';
    return 'ja';  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
};

const i18n = createI18n({
    locale: getDefaultLocale(),  // åˆæœŸè¨€èª
    fallbackLocale: 'ja',
    messages: { ja, en },
});
```

**Locale Store:**

```javascript
// stores/locale.js
export const useLocaleStore = defineStore('locale', () => {
    const locale = ref(i18n.global.locale.value);
    
    // è¨€èªå¤‰æ›´ã‚’ç›£è¦–
    watch(locale, (newLocale) => {
        i18n.global.locale.value = newLocale;
        vuetify.locale.current = newLocale;
    });
    
    return { locale, setLocale };
}, {
    persist: true,  // localStorage ã«ä¿å­˜
});
```

**åˆæœŸåŒ–æ™‚ã®åŒæœŸ:**

```javascript
// main.js
const initializeApp = async () => {
    const localeStore = useLocaleStore();
    
    // Vuetify ã®åˆæœŸè¨€èªã‚’è¨­å®š
    vuetify.locale.current = localeStore.locale;
    
    app.mount('#app');
};
```

**å›³è§£:**

```
ã€åˆæœŸåŒ–æ™‚ã€‘
localStorage â†’ locale.value = 'ja'
   â†“
ã€watch ãŒç™ºç«ã€‘
   â†“
i18n.global.locale.value = 'ja'
vuetify.locale.current = 'ja'
   â†“
ã€ç”»é¢è¡¨ç¤ºã€‘
ãƒ»ãƒœã‚¿ãƒ³ã®ãƒ©ãƒ™ãƒ«: æ—¥æœ¬èª
ãƒ»ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: æ—¥æœ¬èª
ãƒ»æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: æ—¥æœ¬èª
```

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ğŸ¯ å½¹å‰²

**äºˆæœŸã—ãªã„ã‚¨ãƒ©ãƒ¼ã‚’æ•æ‰ã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥ã™ã‚‹**

### ğŸ“Š ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®éšå±¤

```
ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼1: ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã€‘
Vue ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã®ã‚¨ãƒ©ãƒ¼

ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼2: Promise æ‹’å¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã€‘
éåŒæœŸå‡¦ç†ã®ã‚¨ãƒ©ãƒ¼

ã€ãƒ¬ã‚¤ãƒ¤ãƒ¼3: Try-Catchã€‘
å€‹åˆ¥ã®å‡¦ç†ã§ã®ã‚¨ãƒ©ãƒ¼
```

### ğŸ” ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§ã®å®Ÿè£…

**ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼:**

```javascript
// main.js
app.config.errorHandler = (err, instance, info) => {
    if (import.meta.env.DEV) {
        // é–‹ç™ºç’°å¢ƒ: è©³ç´°ã‚’è¡¨ç¤º
        console.error('Global error:', err);
        console.error('Component:', instance);
        console.error('Error info:', info);
    } else {
        // æœ¬ç•ªç’°å¢ƒ: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿
        console.error('Error:', err.message);
    }
    
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
    showErrorNotification('notifications.error.unknown');
};
```

**Promise æ‹’å¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼:**

```javascript
// main.js
window.addEventListener('unhandledrejection', (event) => {
    console.error('Unhandled promise rejection:', event.reason);
    
    showErrorNotification('notifications.error.unknown');
    
    event.preventDefault();  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®å‹•ä½œã‚’é˜²æ­¢
});
```

**ãƒã‚¦ãƒ³ãƒˆçŠ¶æ…‹ã®ç®¡ç†:**

```javascript
// main.js
let isAppMounted = false;

const showErrorNotification = (messageKey) => {
    // âœ… ãƒã‚¦ãƒ³ãƒˆå‰ã¯é€šçŸ¥ã—ãªã„
    if (!isAppMounted) return;
    
    try {
        const notificationStore = useNotificationStore();
        notificationStore.error(i18n.global.t(messageKey), 7000);
    } catch (error) {
        console.error('Failed to show notification:', error);
    }
};

const initializeApp = async () => {
    // ...
    app.mount('#app');
    isAppMounted = true;  // âœ… ãƒã‚¦ãƒ³ãƒˆå®Œäº†
};
```

**ãªãœãƒã‚¦ãƒ³ãƒˆçŠ¶æ…‹ã‚’ç®¡ç†ï¼Ÿ**

```
ã€å•é¡Œã€‘
åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ
   â†“
showErrorNotification() å®Ÿè¡Œ
   â†“
useNotificationStore() å‘¼ã³å‡ºã—
   â†“
ã‚¨ãƒ©ãƒ¼: Pinia is not initialized

ã€åŸå› ã€‘
app.mount() å‰ã¯ Store ãŒä½¿ãˆãªã„

ã€è§£æ±ºã€‘
isAppMounted ãƒ•ãƒ©ã‚°ã§ãƒã‚§ãƒƒã‚¯
   â†“
ãƒã‚¦ãƒ³ãƒˆå‰ â†’ console.error ã®ã¿
ãƒã‚¦ãƒ³ãƒˆå¾Œ â†’ é€šçŸ¥è¡¨ç¤º
```

---

## Graceful Degradation

### ğŸ¯ å½¹å‰²

**åˆæœŸåŒ–å¤±æ•—æ™‚ã‚‚ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ã€éƒ¨åˆ†çš„ã«æ©Ÿèƒ½ã•ã›ã‚‹**

### ğŸ“Š Graceful Degradation ã¨ã¯ï¼Ÿ

```
ã€å¾“æ¥ï¼ˆAll or Nothingï¼‰ã€‘
åˆæœŸåŒ–å¤±æ•—
   â†“
ã‚¢ãƒ—ãƒªèµ·å‹•ã›ãš
   â†“
çœŸã£ç™½ãªç”»é¢
   â†“
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ä½•ã‚‚ã§ããªã„

ã€Graceful Degradationã€‘
åˆæœŸåŒ–å¤±æ•—
   â†“
ã‚¢ãƒ—ãƒªã¯èµ·å‹•
   â†“
ä¸€éƒ¨æ©Ÿèƒ½ãŒåˆ¶é™ã•ã‚Œã‚‹
   â†“
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æœ€ä½é™ä½¿ãˆã‚‹
```

### ğŸ” ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§ã®å®Ÿè£…

```javascript
// main.js
const initializeApp = async () => {
    let initializationError = null;
    
    try {
        const authStore = useAuthStore();
        await authStore.initialize();
    } catch (error) {
        console.error('Initialization error:', error);
        initializationError = error;
        // âœ… ã‚¨ãƒ©ãƒ¼ã‚’ä¿å­˜ã™ã‚‹ã ã‘ï¼ˆthrow ã—ãªã„ï¼‰
    } finally {
        // âœ… åˆæœŸåŒ–ã®æˆå¦ã«é–¢ã‚ã‚‰ãšã‚¢ãƒ—ãƒªã‚’èµ·å‹•
        app.mount('#app');
        isAppMounted = true;
        
        // ãƒã‚¦ãƒ³ãƒˆå¾Œã«ã‚¨ãƒ©ãƒ¼é€šçŸ¥
        if (initializationError) {
            await nextTick();
            notification.warning(
                i18n.global.t('notifications.warning.initializationFailed'),
                5000
            );
        }
    }
};
```

**æŒ™å‹•ã®é•ã„:**

```
ã€All or Nothingï¼ˆNGï¼‰ã€‘
try {
    await authStore.initialize();
    app.mount('#app');
} catch (error) {
    // ã‚¢ãƒ—ãƒªãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œãªã„
    console.error(error);
}
â†’ ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œãªã„

ã€Graceful Degradationï¼ˆOKï¼‰ã€‘
try {
    await authStore.initialize();
} catch (error) {
    initializationError = error;
} finally {
    app.mount('#app');  // å¿…ãšå®Ÿè¡Œ
    
    if (initializationError) {
        // è­¦å‘Šã‚’è¡¨ç¤º
    }
}
â†’ ç”»é¢ã¯è¡¨ç¤ºã•ã‚Œã‚‹
   æœªãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹
```

---

## ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯

### ğŸ¯ å½¹å‰²

**ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ç‰¹å®šã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å‡¦ç†ã‚’å®Ÿè¡Œ**

### ğŸ“Š ä¸»è¦ãªãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯

Vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ã€ä½œæˆã€ãƒã‚¦ãƒ³ãƒˆã€æ›´æ–°ã€ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã®å„æ®µéšã§ã€beforeCreateã‹ã‚‰unmountedã¾ã§ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯ã‚’å®Ÿè¡Œã™ã‚‹

```
ã€Creationï¼ˆä½œæˆï¼‰ã€‘
beforeCreate
   â†“ data/computed/methods ã®åˆæœŸåŒ–å‰
created
   â†“ data/computed/methods ã®åˆæœŸåŒ–å¾Œ

ã€Mountingï¼ˆãƒã‚¦ãƒ³ãƒˆï¼‰ã€‘
beforeMount
   â†“ DOM ç”Ÿæˆå‰
mounted
   â†“ DOM ç”Ÿæˆå¾Œ

ã€Updatingï¼ˆæ›´æ–°ï¼‰ã€‘
beforeUpdate
   â†“ ãƒ‡ãƒ¼ã‚¿å¤‰æ›´å¾Œã€DOM æ›´æ–°å‰
updated
   â†“ DOM æ›´æ–°å¾Œ

ã€Unmountingï¼ˆç ´æ£„ï¼‰ã€‘
beforeUnmount
   â†“ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç ´æ£„å‰
unmounted
   â†“ ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç ´æ£„å¾Œ
```

### ğŸ” Options API vs Composition API

**Options API:**

```javascript
export default {
    data() {
        return { count: 0 };
    },
    created() {
        console.log('created');
    },
    mounted() {
        console.log('mounted');
    },
};
```

**Composition API:**

```javascript
import { ref, onMounted } from 'vue';

export default {
    setup() {
        const count = ref(0);
        
        // created ã¯ setup() è‡ªä½“
        console.log('created');
        
        onMounted(() => {
            console.log('mounted');
        });
        
        return { count };
    },
};
```

**<script setup> æ§‹æ–‡:**

```javascript
import { ref, onMounted } from 'vue';

const count = ref(0);

// ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ« = created
console.log('created');

onMounted(() => {
    console.log('mounted');
});
```

### ğŸ¨ ã‚ˆãä½¿ã†ãƒ•ãƒƒã‚¯ã®ç”¨é€”

**created / setup():**

```javascript
// API å‘¼ã³å‡ºã—
// localStorage ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
// åˆæœŸãƒ‡ãƒ¼ã‚¿è¨­å®š

setup() {
    const users = ref([]);
    
    // API å‘¼ã³å‡ºã—
    usersAPI.list().then(res => {
        users.value = res.data.results;
    });
}
```

**mounted:**

```javascript
// DOM æ“ä½œ
// å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®åˆæœŸåŒ–
// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼ç™»éŒ²

onMounted(() => {
    // DOM ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    const el = document.querySelector('.target');
    
    // Chart.js ãªã©ã®åˆæœŸåŒ–
    new Chart(el, options);
});
```

**beforeUnmount:**

```javascript
// ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
// ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è§£é™¤
// ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªã‚¢

onBeforeUnmount(() => {
    clearInterval(timer);
    window.removeEventListener('resize', handleResize);
});
```

---

## ã¾ã¨ã‚

### ğŸ¯ åˆæœŸåŒ–å‡¦ç†ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```
âœ… createApp ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä½œæˆ
âœ… ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’æ­£ã—ã„é †åºã§ç™»éŒ²
   1. Pinia
   2. Router
   3. Vuetify
   4. i18n
âœ… èªè¨¼çŠ¶æ…‹ã®å¾©å…ƒ
   ãƒ»localStorage ã‹ã‚‰èª­ã¿è¾¼ã¿
   ãƒ»ã‚µãƒ¼ãƒãƒ¼ã¨åŒæœŸ
âœ… è¨€èªè¨­å®šã®é©ç”¨
   ãƒ»ãƒ–ãƒ©ã‚¦ã‚¶è¨€èªã®æ¤œå‡º
   ãƒ»Vuetify ã¨ã®åŒæœŸ
âœ… ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
   ãƒ»ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
   ãƒ»Promise æ‹’å¦ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
âœ… Graceful Degradation
   ãƒ»åˆæœŸåŒ–å¤±æ•—æ™‚ã‚‚ã‚¢ãƒ—ãƒªèµ·å‹•
âœ… ãƒã‚¦ãƒ³ãƒˆçŠ¶æ…‹ã®ç®¡ç†
   ãƒ»ãƒã‚¦ãƒ³ãƒˆå‰ã¯é€šçŸ¥ã—ãªã„
```

### ğŸ“Š åˆæœŸåŒ–ã®å…¨ä½“ãƒ•ãƒ­ãƒ¼

```
HTML èª­ã¿è¾¼ã¿
   â†“
main.js å®Ÿè¡Œ
   â†“
createApp(App)
   â†“
ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ç™»éŒ²
â”œâ”€ Piniaï¼ˆæ°¸ç¶šåŒ–ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä»˜ãï¼‰
â”œâ”€ Router
â”œâ”€ Vuetify
â””â”€ i18n
   â†“
ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒ©ãƒ¼è¨­å®š
â”œâ”€ app.config.errorHandler
â””â”€ window.unhandledrejection
   â†“
initializeApp() å®Ÿè¡Œ
â”œâ”€ authStore.initialize()
â”‚  â”œâ”€ localStorage â†’ user èª­ã¿è¾¼ã¿
â”‚  â””â”€ GET /api/auth/me/ï¼ˆã‚µãƒ¼ãƒãƒ¼ã¨åŒæœŸï¼‰
â””â”€ localeStore è¨­å®šé©ç”¨
   â†“
app.mount('#app')
   â†“
isAppMounted = true
   â†“
åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼ãŒã‚ã‚Œã°é€šçŸ¥
   â†“
ã€ç”»é¢è¡¨ç¤ºã€‘
```

### ğŸ”‘ é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

**1. ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®é †åº**
```
Pinia â†’ Router â†’ Vuetify â†’ i18n
ä¾å­˜é–¢ä¿‚ã«æ³¨æ„ï¼
```

**2. æ°¸ç¶šåŒ–ã®æ´»ç”¨**
```
persist: { paths: ['user'] }
ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚çŠ¶æ…‹ç¶­æŒ
```

**3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°**
```
isAppMounted ãƒ•ãƒ©ã‚°ã§
ãƒã‚¦ãƒ³ãƒˆå‰ã®é€šçŸ¥ã‚’é˜²ã
```

**4. Graceful Degradation**
```
åˆæœŸåŒ–å¤±æ•—æ™‚ã‚‚ã‚¢ãƒ—ãƒªèµ·å‹•
finally ãƒ–ãƒ­ãƒƒã‚¯ã§å¿…ãš mount
```

---

## å‚è€ƒãƒªãƒ³ã‚¯

**Vue 3 å…¬å¼:**
- [Creating a Vue Application](https://vuejs.org/guide/essentials/application.html)
- [Lifecycle Hooks](https://vuejs.org/guide/essentials/lifecycle.html)
- [Composition API](https://vuejs.org/guide/extras/composition-api-faq.html)

**Pinia å…¬å¼:**
- [Getting Started](https://pinia.vuejs.org/getting-started.html)
- [Plugins](https://pinia.vuejs.org/core-concepts/plugins.html)
- [pinia-plugin-persistedstate](https://prazdevs.github.io/pinia-plugin-persistedstate/)

**Vuetify 3 å…¬å¼:**
- [Installation](https://vuetifyjs.com/en/getting-started/installation/)
- [Internationalization](https://vuetifyjs.com/en/features/internationalization/)

**Vue I18n å…¬å¼:**
- [Getting Started](https://vue-i18n.intlify.dev/guide/)

---

**ã“ã®ã‚¬ã‚¤ãƒ‰ãŒã€åˆæœŸåŒ–å‡¦ç†ã®ç†è§£ã«å½¹ç«‹ã¦ã°å¹¸ã„ã§ã™ï¼** ğŸš€âœ¨

**ã‚ã‹ã‚‰ãªã„ã“ã¨ãŒã‚ã‚Œã°ã€ã„ã¤ã§ã‚‚è³ªå•ã—ã¦ãã ã•ã„ï¼** ğŸ’ªğŸ˜Š