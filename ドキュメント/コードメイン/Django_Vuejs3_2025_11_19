# Django REST Framework + Vue.js 3 æŠ€è¡“ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ğŸ“‹ ç›®æ¬¡

1. [ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦](#ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦)
2. [æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯](#æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯)
3. [ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Django + DRF)](#ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰-django--drf)
4. [ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vue.js 3)](#ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰-vuejs-3)
5. [é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³](#é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³)
6. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ã‚·ã‚¹ãƒ†ãƒ æ¦‚è¦

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ãƒ¦ãƒ¼ã‚¶ãƒ¼                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vue.js 3)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚ Vuetify 3   â”‚  â”‚  Pinia   â”‚  â”‚   Vue Router 4     â”‚    â”‚
â”‚  â”‚ (UI Library)â”‚  â”‚ (çŠ¶æ…‹ç®¡ç†)â”‚  â”‚  (ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚ HTTP/HTTPS (Axios)
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚             ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Django + DRF)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   Django REST  â”‚  â”‚     èªè¨¼ã‚·ã‚¹ãƒ†ãƒ               â”‚      â”‚
â”‚  â”‚   Framework    â”‚  â”‚  (Session + CSRF)            â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ (PostgreSQL)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¸»ãªç‰¹å¾´

- **SPA (Single Page Application)**: ãƒšãƒ¼ã‚¸é·ç§»ãªã—ã§ã‚¹ãƒ ãƒ¼ã‚ºãªç”»é¢åˆ‡ã‚Šæ›¿ãˆ
- **ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼**: Cookie + CSRF ãƒˆãƒ¼ã‚¯ãƒ³ã«ã‚ˆã‚‹å®‰å…¨ãªèªè¨¼
- **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³**: PCãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»ã‚¹ãƒãƒ›ã«å¯¾å¿œ
- **å¤šè¨€èªå¯¾å¿œ**: æ—¥æœ¬èªãƒ»è‹±èªåˆ‡ã‚Šæ›¿ãˆå¯èƒ½
- **æ¨©é™ç®¡ç†**: ç®¡ç†è€…ãƒ»ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®åŒºåˆ¥

---

## æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å½¹å‰² |
|------|-----------|------|
| **Python** | 3.10+ | ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èª |
| **Django** | 4.x | Webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| **Django REST Framework (DRF)** | 3.x | APIæ§‹ç¯‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| **PostgreSQL** | 13+ | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ |

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

| æŠ€è¡“ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å½¹å‰² |
|------|-----------|------|
| **Vue.js** | 3.x | UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ (Composition API) |
| **Vuetify** | 3.x | Material Design UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ |
| **Pinia** | 2.x | çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| **Vue Router** | 4.x | ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç®¡ç† |
| **Vue I18n** | 9.x | å¤šè¨€èªå¯¾å¿œ |
| **Axios** | 1.x | HTTPé€šä¿¡ãƒ©ã‚¤ãƒ–ãƒ©ãƒª |
| **Vite** | 5.x | ãƒ“ãƒ«ãƒ‰ãƒ„ãƒ¼ãƒ« |

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ (Django + DRF)

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
backend/
â”œâ”€â”€ config/                 # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®š
â”‚   â”œâ”€â”€ settings.py        # Djangoè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ urls.py           # ãƒ«ãƒ¼ãƒˆURLconf
â”‚   â””â”€â”€ wsgi.py           # WSGIã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ accounts/              # èªè¨¼ã‚¢ãƒ—ãƒª
â”‚   â”œâ”€â”€ backends.py       # ã‚«ã‚¹ã‚¿ãƒ èªè¨¼ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚   â”œâ”€â”€ serializers.py    # ãƒ­ã‚°ã‚¤ãƒ³ç”¨ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼
â”‚   â”œâ”€â”€ views.py          # èªè¨¼API (ãƒ­ã‚°ã‚¤ãƒ³/ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ/CSRF)
â”‚   â””â”€â”€ urls.py           # èªè¨¼ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ users/                 # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚¢ãƒ—ãƒª
â”œâ”€â”€ common/                # å…±é€šæ©Ÿèƒ½ (ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£)
â””â”€â”€ .env                   # ç’°å¢ƒå¤‰æ•° (Gitç®¡ç†å¤–)
```

### 2. èªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã®ä»•çµ„ã¿

#### 2.1 ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ™ãƒ¼ã‚¹èªè¨¼ã®æµã‚Œ

Django ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆèªè¨¼ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ãŒã€**ç¤¾å“¡ç•ªå· (employee_id)** ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã„ã¾ã™ã€‚

```python
# accounts/backends.py - ã‚«ã‚¹ã‚¿ãƒ èªè¨¼ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

class EmployeeIdBackend(BaseBackend):
    """ç¤¾å“¡ç•ªå·ã§ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹èªè¨¼ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰"""
    
    def authenticate(self, request, username=None, password=None, **kwargs):
        # username ã¯ç¤¾å“¡ç•ªå·ã¨ã—ã¦æ‰±ã†
        employee_id = username
        
        if not employee_id or not password:
            return None
        
        try:
            user = User.objects.filter(employee_id=employee_id).first()
        except Exception:
            # ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–: DBã‚¨ãƒ©ãƒ¼æ™‚ã‚‚åŒã˜å‡¦ç†æ™‚é–“ã‚’ç¢ºä¿
            User().set_password(password)
            return None
        
        if user is None:
            # ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå­˜åœ¨ã—ãªã„å ´åˆã‚‚å‡¦ç†æ™‚é–“ã‚’çµ±ä¸€
            User().set_password(password)
            return None
        
        # ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼
        if user.check_password(password):
            return user
        
        return None
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- **ã‚¿ã‚¤ãƒŸãƒ³ã‚°æ”»æ’ƒå¯¾ç­–**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ‰ç„¡ã‚’å‡¦ç†æ™‚é–“ã‹ã‚‰æ¨æ¸¬ã§ããªã„ã‚ˆã†ã€å¸¸ã« `set_password()` ã‚’å®Ÿè¡Œ
- Django ã® `check_password()` ã¯è‡ªå‹•çš„ã«ãƒãƒƒã‚·ãƒ¥åŒ–ã•ã‚ŒãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨æ¯”è¼ƒ
- èªè¨¼æˆåŠŸæ™‚ã¯ User ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿”ã™

**ğŸ“š å‚è€ƒ:** [Django Authentication Backends](https://docs.djangoproject.com/en/stable/topics/auth/customizing/#writing-an-authentication-backend)

#### 2.2 ãƒ­ã‚°ã‚¤ãƒ³APIå®Ÿè£…

```python
# accounts/views.py

class LoginAPIView(APIView):
    permission_classes = [AllowAny]  # èª°ã§ã‚‚ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
    
    def post(self, request):
        serializer = LoginSerializer(data=request.data)
        if not serializer.is_valid():
            return Response(serializer.errors, status=400)
        
        employee_id = serializer.validated_data["employee_id"]
        password = serializer.validated_data["password"]
        
        # ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒå¯¾ç­–
        if self._is_locked(employee_id):
            return Response({"detail": "ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã¾ã™"}, status=429)
        
        # èªè¨¼
        user = authenticate(request, username=employee_id, password=password)
        
        if user:
            if not user.is_active:
                return Response({"detail": "ç„¡åŠ¹ãªã‚¢ã‚«ã‚¦ãƒ³ãƒˆ"}, status=401)
            
            # ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ
            self._reset_attempts(employee_id)
            login(request, user)  # ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
            
            return Response({
                "detail": "logged_in",
                "user": UserSerializer(user).data
            })
        
        # èªè¨¼å¤±æ•—
        attempts = self._increment_attempts(employee_id)
        if attempts >= settings.LOGIN_MAX_ATTEMPTS:
            self._lock_user(employee_id)
            return Response({"detail": "ãƒ­ãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ"}, status=429)
        
        return Response({"detail": "èªè¨¼å¤±æ•—"}, status=401)
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- **ãƒ–ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ¼ã‚¹æ”»æ’ƒå¯¾ç­–**: Django ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã£ã¦å¤±æ•—å›æ•°ã‚’è¨˜éŒ²
- `login(request, user)` ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä½œæˆ (Cookie ã« `sessionid` ãŒä¿å­˜ã•ã‚Œã‚‹)
- ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸæ™‚ã¯ `200 OK` + ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”ã™

**ğŸ“š å‚è€ƒ:** [Django Authentication Views](https://docs.djangoproject.com/en/stable/topics/auth/default/#how-to-log-a-user-in)

#### 2.3 CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®ä»•çµ„ã¿

CSRF (Cross-Site Request Forgery) æ”»æ’ƒã‚’é˜²ããŸã‚ã€Django ã¯ CSRF ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```python
# accounts/views.py

class CSRFView(APIView):
    permission_classes = [AllowAny]
    
    @method_decorator(ensure_csrf_cookie)
    def get(self, request):
        """
        CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’ Cookie ã«ã‚»ãƒƒãƒˆ
        ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ã“ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’å‘¼ã³å‡ºã—ã¦ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
        """
        return Response(status=204)  # No Content
```

**ãƒ•ãƒ­ãƒ¼:**

1. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ `/api/auth/csrf/` ã‚’å‘¼ã³å‡ºã™
2. Django ãŒ `csrftoken` Cookie ã‚’ã‚»ãƒƒãƒˆ
3. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ Cookie ã‹ã‚‰å–å¾—ã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ã‚’ `X-CSRFToken` ãƒ˜ãƒƒãƒ€ãƒ¼ã«å«ã‚ã¦ POST ãƒªã‚¯ã‚¨ã‚¹ãƒˆ

```javascript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (axios.js)

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼
api.interceptors.request.use(async (config) => {
    const method = config.method.toLowerCase();
    
    // POST/PUT/PATCH/DELETE ã®å ´åˆã¯ CSRF ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦
    if (['post', 'put', 'patch', 'delete'].includes(method)) {
        await csrfManager.ensureToken();  // ãƒˆãƒ¼ã‚¯ãƒ³å–å¾—
        const csrfToken = Cookies.get('csrftoken');
        if (csrfToken) {
            config.headers['X-CSRFToken'] = csrfToken;
        }
    }
    
    return config;
});
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- CSRF ãƒˆãƒ¼ã‚¯ãƒ³ã¯ Cookie ã«ä¿å­˜ã•ã‚Œã‚‹ãŒã€`HttpOnly` ã§ã¯ãªã„ (JavaScript ã‹ã‚‰èª­ã¿å–ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚)
- POST/PUT/PATCH/DELETE ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ã¯å¿…ãš `X-CSRFToken` ãƒ˜ãƒƒãƒ€ãƒ¼ãŒå¿…è¦
- GET ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ CSRF ä¿è­·ã®å¯¾è±¡å¤–

**ğŸ“š å‚è€ƒ:** 
- [Django CSRF Protection](https://docs.djangoproject.com/en/stable/ref/csrf/)
- [DRF CSRF with Session Authentication](https://www.django-rest-framework.org/topics/ajax-csrf-cors/#csrf)

### 3. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š

#### 3.1 ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–

```python
# config/settings.py

PASSWORD_HASHERS = [
    'django.contrib.auth.hashers.Argon2PasswordHasher',  # æ¨å¥¨
    'django.contrib.auth.hashers.PBKDF2PasswordHasher',
    'django.contrib.auth.hashers.PBKDF2SHA1PasswordHasher',
    'django.contrib.auth.hashers.BCryptSHA256PasswordHasher',
]
```

**Argon2** ã¯ç¾åœ¨æœ€ã‚‚å®‰å…¨ã¨ã•ã‚Œã‚‹ãƒãƒƒã‚·ãƒ¥ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã§ã™ã€‚

**ğŸ“š å‚è€ƒ:** [Django Password Management](https://docs.djangoproject.com/en/stable/topics/auth/passwords/)

#### 3.2 CORSè¨­å®š

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒç•°ãªã‚‹ãƒãƒ¼ãƒˆã§å‹•ä½œã™ã‚‹ãŸã‚ã€CORS (Cross-Origin Resource Sharing) è¨­å®šãŒå¿…è¦ã§ã™ã€‚

```python
# config/settings.py

CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",  # Vite ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼
]

CORS_ALLOW_CREDENTIALS = True  # Cookie ã‚’é€å—ä¿¡ã™ã‚‹ãŸã‚ã«å¿…é ˆ
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- `CORS_ALLOW_CREDENTIALS = True` ã‚’è¨­å®šã—ãªã„ã¨ã€Cookie (ã‚»ãƒƒã‚·ãƒ§ãƒ³ID) ãŒãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œãªã„
- æœ¬ç•ªç’°å¢ƒã§ã¯ `CORS_ALLOWED_ORIGINS` ã«å®Ÿéš›ã®ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰URLã‚’è¨­å®š

**ğŸ“š å‚è€ƒ:** [django-cors-headers](https://github.com/adamchainz/django-cors-headers)

#### 3.3 ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®š

```python
# config/settings.py

SESSION_COOKIE_AGE = 86400  # 24æ™‚é–“ (ç§’å˜ä½)
SESSION_EXPIRE_AT_BROWSER_CLOSE = False  # ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‰ã˜ã¦ã‚‚ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¶­æŒ
SESSION_SAVE_EVERY_REQUEST = False  # ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ã«ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ä¿å­˜ã—ãªã„ (DBè² è·è»½æ¸›)

# æœ¬ç•ªç’°å¢ƒã§ã¯ä»¥ä¸‹ã‚’æœ‰åŠ¹åŒ–
# SESSION_COOKIE_SECURE = True  # HTTPS ã®ã¿
# SESSION_COOKIE_HTTPONLY = True  # JavaScript ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ä¸å¯
# SESSION_COOKIE_SAMESITE = 'Lax'  # CSRFæ”»æ’ƒå¯¾ç­–
```

**ğŸ“š å‚è€ƒ:** [Django Session Framework](https://docs.djangoproject.com/en/stable/topics/http/sessions/)

### 4. REST APIè¨­è¨ˆ

#### 4.1 ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆä¸€è¦§

| ãƒ¡ã‚½ãƒƒãƒ‰ | ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ | èª¬æ˜ | èªè¨¼ |
|---------|---------------|------|------|
| GET | `/api/auth/csrf/` | CSRFãƒˆãƒ¼ã‚¯ãƒ³å–å¾— | ä¸è¦ |
| POST | `/api/auth/login/` | ãƒ­ã‚°ã‚¤ãƒ³ | ä¸è¦ |
| POST | `/api/auth/logout/` | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ | å¿…è¦ |
| GET | `/api/auth/me/` | ãƒ­ã‚°ã‚¤ãƒ³ä¸­ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾— | å¿…è¦ |
| GET | `/api/users/` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾— | å¿…è¦ |
| GET | `/api/users/{id}/` | ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°å–å¾— | å¿…è¦ |
| POST | `/api/users/` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ | å¿…è¦ (ç®¡ç†è€…) |
| PUT | `/api/users/{id}/` | ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–° | å¿…è¦ (ç®¡ç†è€…) |
| DELETE | `/api/users/{id}/` | ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ | å¿…è¦ (ç®¡ç†è€…) |

#### 4.2 DRF ã®åŸºæœ¬æ¦‚å¿µ

**Serializer (ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼)**

Python ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ â‡” JSON ã®å¤‰æ›ã‚’è¡Œã„ã¾ã™ã€‚

```python
# accounts/serializers.py

class UserSerializer(serializers.ModelSerializer):
    display_name = serializers.CharField(read_only=True)
    
    class Meta:
        model = User
        fields = [
            'id',
            'employee_id',
            'username',
            'email',
            'display_name',
            'is_admin',
            'is_active',
        ]
        read_only_fields = fields  # ã™ã¹ã¦èª­ã¿å–ã‚Šå°‚ç”¨
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- `ModelSerializer` ã¯ Django ãƒ¢ãƒ‡ãƒ«ã‹ã‚‰è‡ªå‹•çš„ã«ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’ç”Ÿæˆ
- `read_only=True` ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å«ã¾ã‚Œã‚‹ãŒã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã¯ç„¡è¦–ã•ã‚Œã‚‹

**ğŸ“š å‚è€ƒ:** [DRF Serializers](https://www.django-rest-framework.org/api-guide/serializers/)

**ViewSet vs APIView**

- **APIView**: ä½ãƒ¬ãƒ™ãƒ«ãªAPIã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãŒå¤šã„å ´åˆã«ä½¿ç”¨
- **ViewSet**: CRUDæ“ä½œã‚’è‡ªå‹•ç”Ÿæˆã€‚æ¨™æº–çš„ãªRESTful APIã«æœ€é©

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€èªè¨¼ç³»ã¯ `APIView`ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã¯ `ViewSet` ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

**ğŸ“š å‚è€ƒ:** [DRF Views](https://www.django-rest-framework.org/api-guide/views/)

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ (Vue.js 3)

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆ

```
frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/              # APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ auth.js       # èªè¨¼API
â”‚   â”‚   â””â”€â”€ users.js      # ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API
â”‚   â”œâ”€â”€ assets/           # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”‚   â””â”€â”€ style/
â”‚   â”‚       â””â”€â”€ main.scss # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”œâ”€â”€ components/       # å†åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ NavBar.vue
â”‚   â”‚   â”œâ”€â”€ SideBar.vue
â”‚   â”‚   â”œâ”€â”€ Header.vue
â”‚   â”‚   â”œâ”€â”€ Footer.vue
â”‚   â”‚   â”œâ”€â”€ Notification.vue
â”‚   â”‚   â””â”€â”€ ...
â”‚   â”œâ”€â”€ composables/      # Composition API ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ usePermissions.js  # æ¨©é™ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ useValidation.js   # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”‚   â”œâ”€â”€ useBreadcrumbs.js  # ãƒ‘ãƒ³ããšãƒªã‚¹ãƒˆ
â”‚   â”‚   â””â”€â”€ useApiError.js     # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”‚   â”œâ”€â”€ constants/        # å®šæ•°å®šç¾©
â”‚   â”‚   â”œâ”€â”€ routes.js     # ãƒ«ãƒ¼ãƒˆãƒ‘ã‚¹
â”‚   â”‚   â”œâ”€â”€ icons.js      # ã‚¢ã‚¤ã‚³ãƒ³
â”‚   â”‚   â””â”€â”€ theme.js      # ãƒ†ãƒ¼ãƒè¨­å®š
â”‚   â”œâ”€â”€ locales/          # å¤šè¨€èªå¯¾å¿œ
â”‚   â”‚   â”œâ”€â”€ ja.json
â”‚   â”‚   â””â”€â”€ en.json
â”‚   â”œâ”€â”€ plugins/          # Vue ãƒ—ãƒ©ã‚°ã‚¤ãƒ³
â”‚   â”‚   â”œâ”€â”€ axios.js      # Axiosè¨­å®š
â”‚   â”‚   â”œâ”€â”€ vuetify.js    # Vuetifyè¨­å®š
â”‚   â”‚   â””â”€â”€ i18n.js       # å¤šè¨€èªè¨­å®š
â”‚   â”œâ”€â”€ router/           # ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”‚   â”‚   â”œâ”€â”€ index.js
â”‚   â”‚   â”œâ”€â”€ auth-guard.js
â”‚   â”‚   â””â”€â”€ admin-guard.js
â”‚   â”œâ”€â”€ stores/           # Pinia ã‚¹ãƒˆã‚¢
â”‚   â”‚   â”œâ”€â”€ auth.js       # èªè¨¼çŠ¶æ…‹
â”‚   â”‚   â”œâ”€â”€ ui.js         # UIçŠ¶æ…‹
â”‚   â”‚   â”œâ”€â”€ notification.js
â”‚   â”‚   â””â”€â”€ locale.js
â”‚   â”œâ”€â”€ utils/            # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚   â”‚   â””â”€â”€ validation.js
â”‚   â”œâ”€â”€ views/            # ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â”œâ”€â”€ Login.vue
â”‚   â”‚   â”œâ”€â”€ Home.vue
â”‚   â”‚   â”œâ”€â”€ Settings.vue
â”‚   â”‚   â””â”€â”€ admin/
â”‚   â”‚       â””â”€â”€ AdminMenu.vue
â”‚   â”œâ”€â”€ App.vue           # ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ main.js           # ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”œâ”€â”€ .env                  # ç’°å¢ƒå¤‰æ•°
â”œâ”€â”€ index.html
â””â”€â”€ vite.config.js        # Viteè¨­å®š
```

### 2. Vue.js 3 Composition API ã®åŸºç¤

Vue.js 3 ã§ã¯ **Composition API** ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚Options API ã«æ¯”ã¹ã¦ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨æ€§ãŒé«˜ãã€TypeScript ã¨ã®ç›¸æ€§ã‚‚è‰¯å¥½ã§ã™ã€‚

#### 2.1 åŸºæœ¬æ§‹æ–‡

```vue
<script setup>
import { ref, computed, onMounted } from 'vue';

// ãƒªã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªçŠ¶æ…‹
const count = ref(0);

// ç®—å‡ºãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
const doubleCount = computed(() => count.value * 2);

// ãƒ¡ã‚½ãƒƒãƒ‰
function increment() {
    count.value++;
}

// ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ•ãƒƒã‚¯
onMounted(() => {
    console.log('ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¾ã—ãŸ');
});
</script>

<template>
    <div>
        <p>Count: {{ count }}</p>
        <p>Double: {{ doubleCount }}</p>
        <button @click="increment">+1</button>
    </div>
</template>
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- `<script setup>` ã¯ Composition API ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚·ãƒ¥ã‚¬ãƒ¼ (ç°¡æ½”ã«æ›¸ã‘ã‚‹)
- `ref()` ã§å®šç¾©ã—ãŸå¤‰æ•°ã¯ `.value` ã§ã‚¢ã‚¯ã‚»ã‚¹ (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã¯è‡ªå‹•ã‚¢ãƒ³ãƒ©ãƒƒãƒ—ã•ã‚Œã‚‹ã®ã§ä¸è¦)
- `computed()` ã¯ä¾å­˜ã™ã‚‹å€¤ãŒå¤‰ã‚ã‚‹ã¨è‡ªå‹•çš„ã«å†è¨ˆç®—

**ğŸ“š å‚è€ƒ:** [Vue 3 Composition API](https://vuejs.org/guide/introduction.html#composition-api)

#### 2.2 Composable (å†åˆ©ç”¨å¯èƒ½ãªãƒ­ã‚¸ãƒƒã‚¯)

Composable ã¯ React ã® Custom Hooks ã«ç›¸å½“ã—ã¾ã™ã€‚

```javascript
// composables/usePermissions.js

import { computed } from 'vue';
import { useAuthStore } from '@/stores/auth';

export const usePermissions = () => {
    const auth = useAuthStore();
    
    // ç®¡ç†è€…æ¨©é™ã‚’æŒã¤ã‹åˆ¤å®š
    const isAdmin = computed(() => {
        return auth.user?.is_admin === true;
    });
    
    return {
        isAdmin,
    };
};
```

**ä½¿ç”¨ä¾‹:**

```vue
<script setup>
import { usePermissions } from '@/composables/usePermissions';

const { isAdmin } = usePermissions();
</script>

<template>
    <div v-if="isAdmin">
        ç®¡ç†è€…å°‚ç”¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
    </div>
</template>
```

**ğŸ“š å‚è€ƒ:** [Vue 3 Composables](https://vuejs.org/guide/reusability/composables.html)

### 3. Pinia (çŠ¶æ…‹ç®¡ç†)

Pinia ã¯ Vuex ã®å¾Œç¶™ã§ã€Vue 3 ã«æœ€é©åŒ–ã•ã‚ŒãŸçŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

#### 3.1 åŸºæœ¬æ§‹æ–‡

```javascript
// stores/auth.js

import { defineStore } from 'pinia';
import { ref, computed } from 'vue';

export const useAuthStore = defineStore('auth', () => {
    // State (çŠ¶æ…‹)
    const user = ref(null);
    const loading = ref(false);
    
    // Getters (ç®—å‡ºãƒ—ãƒ­ãƒ‘ãƒ†ã‚£)
    const isAuthenticated = computed(() => !!user.value);
    
    // Actions (ãƒ¡ã‚½ãƒƒãƒ‰)
    async function login(employeeId, password) {
        loading.value = true;
        try {
            const response = await authAPI.login(employeeId, password);
            user.value = response.data.user;
        } finally {
            loading.value = false;
        }
    }
    
    return {
        user,
        loading,
        isAuthenticated,
        login,
    };
}, {
    // æ°¸ç¶šåŒ–è¨­å®š
    persist: {
        paths: ['user'],  // user ã®ã¿ localStorage ã«ä¿å­˜
    },
});
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- `defineStore()` ã®ç¬¬2å¼•æ•°ã¯ Setup é–¢æ•° (Composition API ã‚¹ã‚¿ã‚¤ãƒ«)
- `persist: true` ã§ localStorage ã«è‡ªå‹•ä¿å­˜ (ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰å¾Œã‚‚çŠ¶æ…‹ç¶­æŒ)
- `computed()` ã¯ Vuex ã® getters ã«ç›¸å½“

**ğŸ“š å‚è€ƒ:** [Pinia Documentation](https://pinia.vuejs.org/)

#### 3.2 ã‚¹ãƒˆã‚¢ã®ä½¿ç”¨

```vue
<script setup>
import { useAuthStore } from '@/stores/auth';

const auth = useAuthStore();

async function handleLogin() {
    await auth.login(employeeId.value, password.value);
}
</script>

<template>
    <div>
        <p v-if="auth.isAuthenticated">
            ã‚ˆã†ã“ãã€{{ auth.user.username }} ã•ã‚“
        </p>
        <button @click="handleLogin">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </div>
</template>
```

### 4. Vue Router 4

#### 4.1 ãƒ«ãƒ¼ãƒˆå®šç¾©

```javascript
// router/index.js

import { createRouter, createWebHistory } from 'vue-router';

const router = createRouter({
    history: createWebHistory(),
    routes: [
        {
            path: '/',
            name: 'Home',
            component: () => import('@/views/Home.vue'),
            meta: {
                requiresAuth: true,  // èªè¨¼å¿…é ˆ
                breadcrumb: 'breadcrumbs.home',
            },
        },
        {
            path: '/admin',
            name: 'Admin',
            component: () => import('@/views/admin/AdminMenu.vue'),
            meta: {
                requiresAuth: true,
                requiresAdmin: true,  // ç®¡ç†è€…æ¨©é™å¿…é ˆ
                breadcrumb: 'breadcrumbs.admin',
            },
        },
    ],
});
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- `meta` ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã§ãã‚‹
- `() => import()` ã¯é…å»¶ãƒ­ãƒ¼ãƒ‰ (ã‚³ãƒ¼ãƒ‰åˆ†å‰²) ã§åˆæœŸãƒ­ãƒ¼ãƒ‰æ™‚é–“ã‚’çŸ­ç¸®

**ğŸ“š å‚è€ƒ:** [Vue Router 4](https://router.vuejs.org/)

#### 4.2 ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒ¼ãƒ‰

ãƒ«ãƒ¼ãƒˆé·ç§»ã®å‰ã«èªè¨¼ãƒã‚§ãƒƒã‚¯ã‚’è¡Œã„ã¾ã™ã€‚

```javascript
// router/auth-guard.js

export const authGuard = async (to, from) => {
    const auth = useAuthStore();
    
    // èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã®å ´åˆ
    if (to.meta.requiresAuth) {
        if (!auth.user) {
            // ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            return {
                path: '/auth/login',
                query: { next: to.fullPath },  // ãƒ­ã‚°ã‚¤ãƒ³å¾Œã«å…ƒã®ãƒšãƒ¼ã‚¸ã«æˆ»ã‚‹
            };
        }
    }
    
    return true;  // é€šé
};

// router/index.js ã§ç™»éŒ²
router.beforeEach(authGuard);
```

**ğŸ“š å‚è€ƒ:** [Vue Router Navigation Guards](https://router.vuejs.org/guide/advanced/navigation-guards.html)

### 5. Vuetify 3 (UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)

Vuetify ã¯ Material Design ã«åŸºã¥ã„ãŸ Vue ç”¨ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã™ã€‚

#### 5.1 åŸºæœ¬çš„ãªä½¿ã„æ–¹

```vue
<template>
    <!-- ã‚«ãƒ¼ãƒ‰ -->
    <v-card>
        <v-card-title>ã‚¿ã‚¤ãƒˆãƒ«</v-card-title>
        <v-card-text>å†…å®¹</v-card-text>
        <v-card-actions>
            <v-btn color="primary">ãƒœã‚¿ãƒ³</v-btn>
        </v-card-actions>
    </v-card>
    
    <!-- ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ« -->
    <v-data-table
        :items="users"
        :headers="headers"
        :loading="loading"
    />
    
    <!-- ãƒ€ã‚¤ã‚¢ãƒ­ã‚° -->
    <v-dialog v-model="dialog" max-width="500">
        <v-card>
            <v-card-title>ç¢ºèª</v-card-title>
            <v-card-text>å‰Šé™¤ã—ã¾ã™ã‹?</v-card-text>
            <v-card-actions>
                <v-btn @click="handleDelete">å‰Šé™¤</v-btn>
                <v-btn @click="dialog = false">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</v-btn>
            </v-card-actions>
        </v-card>
    </v-dialog>
</template>
```

**ğŸ“š å‚è€ƒ:** [Vuetify 3 Components](https://vuetifyjs.com/en/components/all/)

#### 5.2 ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³

Vuetify ã®ã‚°ãƒªãƒƒãƒ‰ã‚·ã‚¹ãƒ†ãƒ ã¯ Bootstrap ã¨ä¼¼ã¦ã„ã¾ã™ã€‚

```vue
<template>
    <v-container>
        <v-row>
            <!-- ãƒ¢ãƒã‚¤ãƒ«: 12åˆ— (å…¨å¹…), ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ: 6åˆ— (åŠåˆ†), PC: 4åˆ— (1/3) -->
            <v-col cols="12" sm="6" md="4">
                ã‚³ãƒ³ãƒ†ãƒ³ãƒ„1
            </v-col>
            <v-col cols="12" sm="6" md="4">
                ã‚³ãƒ³ãƒ†ãƒ³ãƒ„2
            </v-col>
            <v-col cols="12" sm="6" md="4">
                ã‚³ãƒ³ãƒ†ãƒ³ãƒ„3
            </v-col>
        </v-row>
    </v-container>
</template>
```

**ãƒ–ãƒ¬ã‚¤ã‚¯ãƒã‚¤ãƒ³ãƒˆ:**

| ã‚µã‚¤ã‚º | å¹… | ãƒ‡ãƒã‚¤ã‚¹ |
|-------|----|----|
| xs | < 600px | ãƒ¢ãƒã‚¤ãƒ« (ç¸¦) |
| sm | 600-960px | ãƒ¢ãƒã‚¤ãƒ« (æ¨ª), å°å‹ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ |
| md | 960-1280px | ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆ |
| lg | 1280-1920px | PC |
| xl | > 1920px | å¤§å‹ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ |

**ğŸ“š å‚è€ƒ:** [Vuetify Grid System](https://vuetifyjs.com/en/components/grids/)

### 6. Axios (HTTPé€šä¿¡)

#### 6.1 ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼

ã™ã¹ã¦ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ/ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«å…±é€šå‡¦ç†ã‚’é©ç”¨ã—ã¾ã™ã€‚

```javascript
// plugins/axios.js

import axios from 'axios';
import Cookies from 'js-cookie';

const api = axios.create({
    baseURL: 'http://localhost:8000/api/',
    withCredentials: true,  // Cookie ã‚’é€ä¿¡
    timeout: 10000,
});

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼
api.interceptors.request.use(async (config) => {
    // è¨€èªãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
    const localeStore = useLocaleStore();
    config.headers['Accept-Language'] = localeStore.locale;
    
    // POST/PUT/DELETE ã«ã¯ CSRF ãƒˆãƒ¼ã‚¯ãƒ³ãŒå¿…è¦
    if (['post', 'put', 'patch', 'delete'].includes(config.method)) {
        const csrfToken = Cookies.get('csrftoken');
        if (csrfToken) {
            config.headers['X-CSRFToken'] = csrfToken;
        }
    }
    
    return config;
});

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼
api.interceptors.response.use(
    response => response,
    async error => {
        // 401/403 ã‚¨ãƒ©ãƒ¼æ™‚ã¯è‡ªå‹•ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
        if ([401, 403].includes(error.response?.status)) {
            const auth = useAuthStore();
            await auth.logout();
        }
        return Promise.reject(error);
    }
);

export default api;
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- `withCredentials: true` ã‚’è¨­å®šã—ãªã„ã¨ Cookie ãŒé€ä¿¡ã•ã‚Œãªã„
- ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã§ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã‚’ä¸€å…ƒç®¡ç†

**ğŸ“š å‚è€ƒ:** [Axios Interceptors](https://axios-http.com/docs/interceptors)

### 7. Vue I18n (å¤šè¨€èªå¯¾å¿œ)

#### 7.1 ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«

```json
// locales/ja.json
{
    "auth": {
        "login": "ãƒ­ã‚°ã‚¤ãƒ³",
        "logout": "ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ"
    },
    "form": {
        "fields": {
            "username": "ãƒ¦ãƒ¼ã‚¶ãƒ¼å",
            "password": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
        },
        "validation": {
            "required": "{field}ã¯å¿…é ˆã§ã™"
        }
    }
}
```

#### 7.2 ä½¿ç”¨æ–¹æ³•

```vue
<script setup>
import { useI18n } from 'vue-i18n';

const { t } = useI18n();
</script>

<template>
    <h1>{{ t('auth.login') }}</h1>
    
    <!-- ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ã -->
    <p>{{ t('form.validation.required', { field: t('form.fields.username') }) }}</p>
</template>
```

**ğŸ“š å‚è€ƒ:** [Vue I18n](https://vue-i18n.intlify.dev/)

---

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### 1. æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ ã™ã‚‹æ‰‹é †

#### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰

1. **ãƒ¢ãƒ‡ãƒ«ã‚’ä½œæˆ** (`models.py`)
2. **ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’ä½œæˆ** (`serializers.py`)
3. **ViewSet/APIView ã‚’ä½œæˆ** (`views.py`)
4. **URLã‚’ç™»éŒ²** (`urls.py`)
5. **ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ**

#### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰

1. **APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’ä½œæˆ** (`src/api/xxx.js`)
2. **ãƒ«ãƒ¼ãƒˆã‚’ç™»éŒ²** (`src/router/index.js`)
3. **ã‚¹ãƒˆã‚¢ã‚’ä½œæˆ** (å¿…è¦ã«å¿œã˜ã¦ `src/stores/xxx.js`)
4. **ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œæˆ** (`src/views/Xxx.vue`)
5. **ç¿»è¨³ã‚’è¿½åŠ ** (`src/locales/ja.json`, `en.json`)

### 2. ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„

- **å‘½åè¦å‰‡**:
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ: PascalCase (`UserList.vue`)
  - é–¢æ•°ãƒ»å¤‰æ•°: camelCase (`fetchUser`)
  - å®šæ•°: UPPER_SNAKE_CASE (`API_BASE_URL`)
  - CSS ã‚¯ãƒ©ã‚¹: kebab-case (`user-list-item`)

- **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¨­è¨ˆ**:
  - 1ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ = 1è²¬å‹™
  - 200è¡Œã‚’è¶…ãˆãŸã‚‰åˆ†å‰²ã‚’æ¤œè¨
  - Props ã¯èª­ã¿å–ã‚Šå°‚ç”¨ (å­ã‹ã‚‰è¦ªã®ãƒ‡ãƒ¼ã‚¿ã‚’å¤‰æ›´ã—ãªã„)

---

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼

#### 1. CORS ã‚¨ãƒ©ãƒ¼

```
Access to XMLHttpRequest at 'http://localhost:8000/api/...' from origin 'http://localhost:5173' has been blocked by CORS policy
```

**è§£æ±ºæ–¹æ³•:**

```python
# backend/config/settings.py

CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
]
CORS_ALLOW_CREDENTIALS = True
```

#### 2. CSRF ãƒˆãƒ¼ã‚¯ãƒ³ã‚¨ãƒ©ãƒ¼

```
403 Forbidden: CSRF token missing or incorrect
```

**è§£æ±ºæ–¹æ³•:**

- `/api/auth/csrf/` ã‚’å‘¼ã³å‡ºã—ã¦ Cookie ã‚’å–å¾—
- `X-CSRFToken` ãƒ˜ãƒƒãƒ€ãƒ¼ã« Cookie ã®å€¤ã‚’è¨­å®š

#### 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒä¿å­˜ã•ã‚Œãªã„

**åŸå› :** `withCredentials: true` ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„

```javascript
// ä¿®æ­£å‰
axios.get('http://localhost:8000/api/auth/me/');

// ä¿®æ­£å¾Œ
axios.get('http://localhost:8000/api/auth/me/', {
    withCredentials: true
});
```

---

## ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¿œç”¨ç·¨

### 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½ã®å®Ÿè£…

#### 1.1 ãƒ¢ãƒ‡ãƒ«è¨­è¨ˆï¼ˆè«–ç†å‰Šé™¤å¯¾å¿œï¼‰

```python
# users/models.py

class User(AbstractBaseUser, PermissionsMixin):
    """è«–ç†å‰Šé™¤å¯¾å¿œãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¢ãƒ‡ãƒ«"""
    
    employee_id = models.CharField("ç¤¾å“¡ç•ªå·", max_length=50, db_index=True)
    username = models.CharField("ãƒ¦ãƒ¼ã‚¶ãƒ¼å", max_length=50)
    email = models.EmailField("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹", max_length=255)
    
    is_admin = models.BooleanField("ç®¡ç†è€…", default=False)
    is_active = models.BooleanField("ã‚¢ã‚¯ãƒ†ã‚£ãƒ–", default=True)
    
    created_at = models.DateTimeField("ä½œæˆæ—¥æ™‚", default=timezone.now)
    updated_at = models.DateTimeField("æ›´æ–°æ—¥æ™‚", auto_now=True)
    deleted_at = models.DateTimeField("å‰Šé™¤æ—¥æ™‚", null=True, blank=True)
    
    objects = CustomUserManager()  # å‰Šé™¤æ¸ˆã¿é™¤å¤–
    all_objects = AllObjectsManager()  # å‰Šé™¤æ¸ˆã¿å«ã‚€
    
    class Meta:
        constraints = [
            # å‰Šé™¤æ¸ˆã¿ã§ãªã„å ´åˆã®ã¿ç¤¾å“¡ç•ªå·ã‚’ä¸€æ„ã«
            models.UniqueConstraint(
                fields=["employee_id"],
                condition=models.Q(deleted_at__isnull=True),
                name="unique_active_employee_id",
            )
        ]
    
    def soft_delete(self):
        """è«–ç†å‰Šé™¤"""
        self.deleted_at = timezone.now()
        self.is_active = False
        self.save(update_fields=["deleted_at", "is_active"])
```

**ğŸ” è«–ç†å‰Šé™¤ã®ãƒ¡ãƒªãƒƒãƒˆ:**

- **ãƒ‡ãƒ¼ã‚¿å¾©æ—§**: èª¤å‰Šé™¤æ™‚ã«å¾©å…ƒå¯èƒ½
- **ç›£æŸ»è¨¼è·¡**: å‰Šé™¤ã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å±¥æ­´ã‚’ä¿æŒ
- **ç¤¾å“¡ç•ªå·ã®å†åˆ©ç”¨**: é€€è·å¾Œã®ç¤¾å“¡ç•ªå·ã‚’æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å‰²ã‚Šå½“ã¦å¯èƒ½

**æ¡ä»¶ä»˜ããƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„:**

```sql
-- ç”Ÿæˆã•ã‚Œã‚‹ SQLï¼ˆPostgreSQLï¼‰
CREATE UNIQUE INDEX unique_active_employee_id 
ON users (employee_id) 
WHERE deleted_at IS NULL;
```

ã“ã‚Œã«ã‚ˆã‚Šã€`deleted_at` ãŒ NULLï¼ˆã‚¢ã‚¯ãƒ†ã‚£ãƒ–ï¼‰ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã®ã¿ `employee_id` ãŒä¸€æ„ã«ãªã‚Šã¾ã™ã€‚

**ğŸ“š å‚è€ƒ:** [Django Constraints](https://docs.djangoproject.com/en/stable/ref/models/constraints/)

#### 1.2 ã‚«ã‚¹ã‚¿ãƒ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼

```python
class CustomUserManager(BaseUserManager):
    """å‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–ã™ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼"""
    
    def get_queryset(self):
        return super().get_queryset().filter(deleted_at__isnull=True)

class AllObjectsManager(BaseUserManager):
    """å‰Šé™¤æ¸ˆã¿ã‚‚å«ã‚ã‚‹ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼"""
    
    def get_queryset(self):
        return super().get_queryset()
```

**ä½¿ã„åˆ†ã‘:**

```python
# é€šå¸¸ã®æ“ä½œï¼ˆå‰Šé™¤æ¸ˆã¿é™¤å¤–ï¼‰
User.objects.all()  # ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã¿

# å‰Šé™¤æ¸ˆã¿ã‚‚å«ã‚ã‚‹
User.all_objects.all()  # ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼

# å‰Šé™¤æ¸ˆã¿ã®ã¿å–å¾—
User.all_objects.filter(deleted_at__isnull=False)
```

**ğŸ“š å‚è€ƒ:** [Django Custom Managers](https://docs.djangoproject.com/en/stable/topics/db/managers/)

#### 1.3 ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆã‚µãƒ¼ãƒ“ã‚¹å±¤ï¼‰

```python
# users/services/user_service.py

class UserService:
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã®ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯"""
    
    @staticmethod
    def delete_user(user_instance, request_user_id=None):
        """
        ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤ï¼ˆè«–ç†å‰Šé™¤ï¼‰
        
        ãƒã‚§ãƒƒã‚¯:
        1. è‡ªåˆ†è‡ªèº«ã®å‰Šé™¤ã‚’é˜²æ­¢
        2. æœ€å¾Œã®ç®¡ç†è€…å‰Šé™¤ã‚’é˜²æ­¢
        """
        # è‡ªå·±å‰Šé™¤ãƒã‚§ãƒƒã‚¯
        if request_user_id and user_instance.id == request_user_id:
            raise CannotDeleteSelfError()
        
        # æœ€å¾Œã®ç®¡ç†è€…ãƒã‚§ãƒƒã‚¯
        if user_instance.is_admin:
            admin_count = User.objects.filter(
                is_admin=True, is_active=True
            ).exclude(id=user_instance.id).count()
            
            if admin_count == 0:
                raise LastAdminError(action="delete")
        
        user_instance.soft_delete()
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- **ã‚µãƒ¼ãƒ“ã‚¹å±¤**: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’ View ã‹ã‚‰åˆ†é›¢
- **ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**: `@transaction.atomic` ã§ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚’ä¿è¨¼
- **ã‚«ã‚¹ã‚¿ãƒ ä¾‹å¤–**: ã‚ã‹ã‚Šã‚„ã™ã„ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸

**MVC ã¨ MVT ã®é•ã„:**

```
MVC (ä¸€èˆ¬çš„ãªãƒ‘ã‚¿ãƒ¼ãƒ³)          MVT (Django)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model â”‚                      â”‚  Model â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘                               â†‘
     â”‚                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  View  â”‚â†â”€â”€â†’â”‚Controllerâ”‚      â”‚  View  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â†‘
                                     â”‚
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Template  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚µãƒ¼ãƒ“ã‚¹å±¤ã‚’è¿½åŠ ã—ãŸæ§‹é€ :
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Model â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service   â”‚  â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â†‘
     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  View  â”‚  â† HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆå‡¦ç†
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 1.4 ViewSetå®Ÿè£…

```python
# users/views.py

class UserViewSet(viewsets.ModelViewSet):
    """ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†API"""
    
    queryset = User.objects.all()
    permission_classes = [IsAuthenticated, IsAdminUser]
    
    def get_queryset(self):
        """
        ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã«å¿œã˜ã¦ã‚¯ã‚¨ãƒªã‚»ãƒƒãƒˆã‚’å¤‰æ›´
        - retrieve: å‰Šé™¤æ¸ˆã¿ã‚‚å«ã‚ã‚‹ï¼ˆæ˜ç¢ºãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ãŸã‚ï¼‰
        - ãã®ä»–: å‰Šé™¤æ¸ˆã¿ã‚’é™¤å¤–
        """
        if self.action == "retrieve":
            return User.all_objects.all()
        return super().get_queryset()
    
    def retrieve(self, request, *args, **kwargs):
        """è©³ç´°å–å¾—ï¼ˆå‰Šé™¤æ¸ˆã¿ãƒã‚§ãƒƒã‚¯ä»˜ãï¼‰"""
        instance = self.get_object()
        
        # å‰Šé™¤æ¸ˆã¿ãƒã‚§ãƒƒã‚¯
        if instance.deleted_at:
            raise DeletedUserAccessError()
        
        return Response(UserSerializer(instance).data)
```

**åŒæ™‚æ“ä½œå¯¾ç­–:**

```python
def destroy(self, request, *args, **kwargs):
    """å‰Šé™¤ï¼ˆåŒæ™‚å‰Šé™¤ã‚’æ¤œçŸ¥ï¼‰"""
    
    # all_objects ã§å–å¾—ï¼ˆå‰Šé™¤æ¸ˆã¿ã‚‚å«ã‚ã‚‹ï¼‰
    try:
        instance = User.all_objects.get(pk=self.kwargs["pk"])
    except User.DoesNotExist:
        raise UserNotFoundError()
    
    # åˆ¥ã‚¿ãƒ–ã§æ—¢ã«å‰Šé™¤ã•ã‚Œã¦ã„ãªã„ã‹ãƒã‚§ãƒƒã‚¯
    if instance.deleted_at:
        raise DeletedUserAccessError()
    
    UserService.delete_user(instance, request_user_id=request.user.id)
    return Response(status=status.HTTP_204_NO_CONTENT)
```

**ğŸ“š å‚è€ƒ:** [DRF ViewSets](https://www.django-rest-framework.org/api-guide/viewsets/)

### 2. ç›£æŸ»ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 

#### 2.1 ã‚·ã‚°ãƒŠãƒ«ã«ã‚ˆã‚‹è‡ªå‹•è¨˜éŒ²

Django ã® **ã‚·ã‚°ãƒŠãƒ«** ã¯ã€ç‰¹å®šã®ã‚¤ãƒ™ãƒ³ãƒˆç™ºç”Ÿæ™‚ã«è‡ªå‹•çš„ã«å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ä»•çµ„ã¿ã§ã™ã€‚

```python
# common/signals.py

from django.db.models.signals import post_save, post_delete, pre_save
from django.dispatch import receiver

@receiver(pre_save)
def audit_pre_save(sender, instance, **kwargs):
    """
    æ›´æ–°å‰ã®å€¤ã‚’ä¿å­˜
    
    ã‚·ã‚°ãƒŠãƒ«ã®æµã‚Œ:
    1. user.save() ãŒå‘¼ã°ã‚Œã‚‹
    2. pre_save ã‚·ã‚°ãƒŠãƒ«ãŒç™ºç«
    3. å¤ã„å€¤ã‚’ instance._old_instance ã«ä¿å­˜
    4. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    5. post_save ã‚·ã‚°ãƒŠãƒ«ãŒç™ºç«
    """
    if not should_audit(sender):
        return
    
    if instance.pk:
        try:
            old = sender.objects.get(pk=instance.pk)
            instance._old_instance = old
        except sender.DoesNotExist:
            pass

@receiver(post_save)
def audit_post_save(sender, instance, created, **kwargs):
    """ä½œæˆãƒ»æ›´æ–°ã‚’è¨˜éŒ²"""
    if not should_audit(sender):
        return
    
    action = "CREATE" if created else "UPDATE"
    changes = {}
    
    if not created and hasattr(instance, "_old_instance"):
        changes = get_field_changes(instance._old_instance, instance)
    
    log_audit(action, instance, changes)
```

**ğŸ” ã‚·ã‚°ãƒŠãƒ«ã®ä»•çµ„ã¿:**

```
é€šå¸¸ã®å‡¦ç†:
user.username = "æ–°ã—ã„åå‰"
user.save()  â†’  ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜

ã‚·ã‚°ãƒŠãƒ«ã‚ã‚Šã®å‡¦ç†:
user.username = "æ–°ã—ã„åå‰"
user.save()
    â†“
ã€pre_save ã‚·ã‚°ãƒŠãƒ«ã€‘
    â†“ å¤ã„å€¤ã‚’ä¿å­˜
ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
    â†“
ã€post_save ã‚·ã‚°ãƒŠãƒ«ã€‘
    â†“ ç›£æŸ»ãƒ­ã‚°ã«è¨˜éŒ²
å®Œäº†
```

**ç›£æŸ»ãƒ­ã‚°å‡ºåŠ›ä¾‹:**

```json
{
  "request_id": "c0eb301c-f5db-4c2a-a35f-d843e9e11a90",
  "timestamp": "2025-11-13 20:07:35",
  "level": "INFO",
  "user": "9999",
  "action": "UPDATE",
  "model": "User",
  "object_id": 1,
  "ip": "127.0.0.1",
  "changes": "{\"username\": {\"old\": \"å¤ªéƒ\", \"new\": \"èŠ±å­\"}}",
  "message": "user UPDATE: 1"
}
```

**ğŸ“š å‚è€ƒ:** [Django Signals](https://docs.djangoproject.com/en/stable/topics/signals/)

#### 2.2 ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã‚’è¨˜éŒ²

```python
# common/middleware.py

class AuditMiddleware:
    """ç›£æŸ»ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢"""
    
    def __call__(self, request):
        # ãƒªã‚¯ã‚¨ã‚¹ãƒˆIDã‚’ç”Ÿæˆ
        request_id = request.META.get("HTTP_X_REQUEST_ID", str(uuid.uuid4()))
        request._request_id = request_id
        
        # ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ï¼ˆã‚·ã‚°ãƒŠãƒ«ã‹ã‚‰å‚ç…§ï¼‰
        set_current_request(request)
        
        response = self.get_response(request)
        
        # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¿½åŠ 
        response["X-Request-ID"] = request_id
        
        return response
```

**ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸:**

```python
# common/context.py

import threading

_request_local = threading.local()

def set_current_request(request):
    """ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜"""
    _request_local.request = request

def get_current_request():
    """ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ã‚¹ãƒ¬ãƒƒãƒ‰ãƒ­ãƒ¼ã‚«ãƒ«ã‹ã‚‰å–å¾—"""
    return getattr(_request_local, "request", None)
```

**ã‚·ã‚°ãƒŠãƒ«å†…ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±ã‚’å–å¾—:**

```python
def log_audit(action, instance, changes=None):
    request = get_current_request()
    
    user_info = "system"
    ip = "127.0.0.1"
    request_id = "N/A"
    
    if request:
        user_info = request.user.employee_id
        ip = get_client_ip(request)
        request_id = getattr(request, "_request_id", "N/A")
    
    audit_logger.info(f"{action}: {instance.pk}", extra={
        "request_id": request_id,
        "user": user_info,
        "ip": ip,
        "changes": json.dumps(changes or {})
    })
```

**ğŸ“š å‚è€ƒ:** [Django Middleware](https://docs.djangoproject.com/en/stable/topics/http/middleware/)

### 3. CSVå‡ºåŠ›æ©Ÿèƒ½

```python
# users/views.py

@action(detail=False, methods=["get"], url_path="export-csv")
def export_csv(self, request):
    """CSVå‡ºåŠ›ï¼ˆæ¤œç´¢æ¡ä»¶ã‚’åæ˜ ï¼‰"""
    
    # ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã‚’é©ç”¨
    queryset = self.filter_queryset(self.get_queryset())
    
    # ä»¶æ•°åˆ¶é™
    count = queryset.count()
    if count > 1100:
        return Response({
            "detail": f"CSVå‡ºåŠ›ã¯1100ä»¶ã¾ã§ã§ã™ã€‚ç¾åœ¨: {count}ä»¶"
        }, status=status.HTTP_400_BAD_REQUEST)
    
    # CSVç”Ÿæˆ
    output = StringIO()
    writer = csv.writer(output)
    
    # ãƒ˜ãƒƒãƒ€ãƒ¼
    writer.writerow(["ID", "ç¤¾å“¡ç•ªå·", "ãƒ¦ãƒ¼ã‚¶ãƒ¼å", "ç®¡ç†è€…", "ä½œæˆæ—¥æ™‚"])
    
    # ãƒ‡ãƒ¼ã‚¿
    for user in queryset:
        writer.writerow([
            user.id,
            user.employee_id,
            user.username or "",
            "â—‹" if user.is_admin else "",
            user.created_at.strftime("%Y-%m-%d %H:%M:%S"),
        ])
    
    # ãƒ¬ã‚¹ãƒãƒ³ã‚¹
    response = HttpResponse(
        output.getvalue().encode("utf-8-sig"),  # BOMä»˜ãã§Excelå¯¾å¿œ
        content_type="text/csv; charset=utf-8-sig",
    )
    
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    filename = f"users_{timestamp}.csv"
    response["Content-Disposition"] = f'attachment; filename="{filename}"'
    
    return response
```

**ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†:**

```javascript
// utils/file.js

export function downloadCSVFromResponse(response, defaultFilename = 'export.csv') {
    // ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—
    const filename = extractFilename(
        response.headers['content-disposition'],
        defaultFilename
    );
    
    // Blobä½œæˆ
    const blob = new Blob([response.data], {
        type: 'text/csv; charset=utf-8-sig'
    });
    
    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
    const url = window.URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = filename;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    window.URL.revokeObjectURL(url);
}
```

**ğŸ“š å‚è€ƒ:** [DRF Actions](https://www.django-rest-framework.org/api-guide/viewsets/#marking-extra-actions-for-routing)

### 4. å¤šè¨€èªå¯¾å¿œï¼ˆi18nï¼‰

#### 4.1 ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ

```bash
# ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
python manage.py makemessages -l ja
python manage.py makemessages -l en

# .po ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†å¾Œã€ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«
python manage.py compilemessages
```

#### 4.2 ã‚³ãƒ¼ãƒ‰å†…ã§ã®ä½¿ç”¨

```python
from django.utils.translation import gettext_lazy as _

class UserSerializer(serializers.ModelSerializer):
    employee_id = serializers.CharField(
        error_messages={
            "required": _("ç¤¾å“¡ç•ªå·ã¯å¿…é ˆã§ã™"),
            "blank": _("ç¤¾å“¡ç•ªå·ã¯å¿…é ˆã§ã™"),
        }
    )
```

**ç¿»è¨³ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.poï¼‰:**

```po
# locale/ja/LC_MESSAGES/django.po
msgid "ç¤¾å“¡ç•ªå·ã¯å¿…é ˆã§ã™"
msgstr "ç¤¾å“¡ç•ªå·ã¯å¿…é ˆã§ã™"

# locale/en/LC_MESSAGES/django.po
msgid "ç¤¾å“¡ç•ªå·ã¯å¿…é ˆã§ã™"
msgstr "Employee ID is required"
```

**ğŸ“š å‚è€ƒ:** [Django Internationalization](https://docs.djangoproject.com/en/stable/topics/i18n/)

---

## ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å¿œç”¨ç·¨

### 1. ãƒ‡ãƒ¼ã‚¿ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚½ãƒ¼ãƒˆã€æ¤œç´¢ï¼‰

```vue
<script setup>
import { ref, computed, onMounted } from 'vue';
import { usersAPI } from '@/api/users';

const users = ref([]);
const loading = ref(false);
const searchQuery = ref('');
const currentPage = ref(1);
const itemsPerPage = ref(10);
const totalItems = ref(0);
const sortBy = ref([]);

// ãƒ‡ãƒ¼ã‚¿å–å¾—
async function loadItems({ page, itemsPerPage, sortBy }) {
    loading.value = true;
    
    try {
        const params = {
            page,
            page_size: itemsPerPage,
        };
        
        // æ¤œç´¢ã‚¯ã‚¨ãƒª
        if (searchQuery.value?.trim()) {
            params.search = searchQuery.value.trim();
        }
        
        // ã‚½ãƒ¼ãƒˆ
        if (sortBy && sortBy.length > 0) {
            const sort = sortBy[0];
            const orderPrefix = sort.order === 'desc' ? '-' : '';
            params.ordering = `${orderPrefix}${sort.key}`;
        }
        
        const response = await usersAPI.list(params);
        users.value = response.data.results;
        totalItems.value = response.data.count;
    } finally {
        loading.value = false;
    }
}

// æ¤œç´¢æ™‚ã®å‡¦ç†ï¼ˆãƒ‡ãƒã‚¦ãƒ³ã‚¹ï¼‰
let searchTimer = null;
watch(searchQuery, () => {
    clearTimeout(searchTimer);
    searchTimer = setTimeout(() => {
        currentPage.value = 1;
        loadItems({
            page: 1,
            itemsPerPage: itemsPerPage.value,
            sortBy: sortBy.value,
        });
    }, 300);
});

onMounted(() => {
    loadItems({
        page: currentPage.value,
        itemsPerPage: itemsPerPage.value,
        sortBy: sortBy.value,
    });
});
</script>

<template>
    <v-data-table-server
        :headers="headers"
        :items="users"
        :items-length="totalItems"
        :loading="loading"
        v-model:page="currentPage"
        v-model:items-per-page="itemsPerPage"
        v-model:sort-by="sortBy"
        @update:options="loadItems"
    >
        <!-- ã‚«ã‚¹ã‚¿ãƒ ã‚¹ãƒ­ãƒƒãƒˆ -->
        <template #item.is_admin="{ item }">
            <v-icon :color="item.is_admin ? 'success' : 'grey'">
                {{ item.is_admin ? 'check' : 'remove' }}
            </v-icon>
        </template>
    </v-data-table-server>
</template>
```

**ğŸ” é‡è¦ãƒã‚¤ãƒ³ãƒˆ:**

- **v-data-table-server**: ã‚µãƒ¼ãƒãƒ¼å´ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå¤§é‡ãƒ‡ãƒ¼ã‚¿ã«å¯¾å¿œï¼‰
- **ãƒ‡ãƒã‚¦ãƒ³ã‚¹**: æ¤œç´¢å…¥åŠ›ã®ãŸã³ã«APIã‚’å‘¼ã°ãªã„ï¼ˆ300mså¾…æ©Ÿï¼‰
- **ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: `onBeforeUnmount` ã§ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢

**ğŸ“š å‚è€ƒ:** [Vuetify Data Tables](https://vuetifyjs.com/en/components/data-tables/basics/)

### 2. ãƒ•ã‚©ãƒ¼ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```javascript
// composables/useValidation.js

export function useValidation() {
    const { t } = useI18n();
    
    const createRules = {
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼åï¼ˆ3æ–‡å­—ä»¥ä¸Šï¼‰
        username() {
            return [
                (value) => !!value || t('form.validation.required', { field: t('form.fields.username') }),
                (value) => value.length >= 3 || t('form.validation.minLength', { field: t('form.fields.username'), min: 3 }),
            ];
        },
        
        // ç¤¾å“¡ç•ªå·ï¼ˆåŠè§’æ•°å­—ã®ã¿ï¼‰
        employeeId() {
            return [
                (value) => !!value || t('form.validation.required', { field: t('form.fields.employeeId') }),
                (value) => /^\d{1,50}$/.test(value) || t('form.validation.employeeIdFormat'),
            ];
        },
        
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆè‹±æ•°å­—8æ–‡å­—ä»¥ä¸Šï¼‰
        newPassword() {
            return [
                (value) => !!value || t('form.validation.required', { field: t('form.fields.password') }),
                (value) => value.length >= 8 || t('form.validation.minLength', { field: t('form.fields.password'), min: 8 }),
                (value) => /(?=.*[a-zA-Z])(?=.*\d)/.test(value) || t('form.validation.passwordStrength'),
            ];
        },
    };
    
    return { createRules };
}
```

**ä½¿ç”¨ä¾‹:**

```vue
<script setup>
const { createRules } = useValidation();

const usernameRules = createRules.username();
const passwordRules = createRules.newPassword();
</script>

<template>
    <v-form ref="form">
        <v-text-field
            v-model="formData.username"
            :rules="usernameRules"
            label="ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
        />
        
        <v-text-field
            v-model="formData.password"
            :rules="passwordRules"
            type="password"
            label="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
        />
    </v-form>
</template>
```

### 3. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

```javascript
// composables/useApiError.js

export function useApiError() {
    const notification = useNotificationStore();
    const { t } = useI18n();
    
    async function handleApiError(error, fallbackMessageKey = null) {
        let errorMessage = null;
        
        if (error.response?.data) {
            let errorData = error.response.data;
            
            // Blob ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã®å ´åˆã¯ JSON ã«å¤‰æ›
            if (errorData instanceof Blob) {
                try {
                    const text = await errorData.text();
                    errorData = JSON.parse(text);
                } catch (e) {
                    errorMessage = t('backend.errors.UNKNOWN_ERROR');
                }
            }
            
            // Django ãŒç¿»è¨³æ¸ˆã¿ã® detail ã‚’å„ªå…ˆ
            if (errorData.detail) {
                errorMessage = errorData.detail;
            }
            
            // ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆ¥ã‚¨ãƒ©ãƒ¼
            if (!errorMessage) {
                errorMessage = extractFirstFieldError(errorData);
            }
        }
        
        // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
        if (!errorMessage && fallbackMessageKey) {
            errorMessage = t(fallbackMessageKey);
        }
        
        if (!errorMessage) {
            errorMessage = t('backend.errors.UNKNOWN_ERROR');
        }
        
        notification.error(errorMessage, 7000);
        return errorMessage;
    }
    
    return { handleApiError };
}
```

---

## é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼ˆå¿œç”¨ç·¨ï¼‰

### 1. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ç®¡ç†

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œæˆã¨é©ç”¨

```bash
# ãƒ¢ãƒ‡ãƒ«ã‚’å¤‰æ›´ã—ãŸå¾Œ
python manage.py makemigrations

# SQLã‚’ç¢ºèª
python manage.py sqlmigrate users 0002

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«åæ˜ 
python manage.py migrate

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çŠ¶æ…‹ã‚’ç¢ºèª
python manage.py showmigrations
```

#### ãƒ‡ãƒ¼ã‚¿ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```python
# users/migrations/0002_create_initial_superuser.py

from django.db import migrations

def create_initial_superuser(apps, schema_editor):
    """åˆæœŸç®¡ç†è€…ã‚’ä½œæˆ"""
    User = apps.get_model('users', 'User')
    
    if User.objects.filter(employee_id='9999').exists():
        return
    
    from django.contrib.auth.hashers import make_password
    
    User.objects.create(
        employee_id='9999',
        username='ç®¡ç†è€…',
        password=make_password('test1234'),
        is_admin=True,
        is_active=True,
    )

def reverse_func(apps, schema_editor):
    """ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å‡¦ç†"""
    User = apps.get_model('users', 'User')
    User.objects.filter(employee_id='9999').delete()

class Migration(migrations.Migration):
    dependencies = [
        ('users', '0001_initial'),
    ]
    
    operations = [
        migrations.RunPython(create_initial_superuser, reverse_func),
    ]
```

**ğŸ“š å‚è€ƒ:** [Django Migrations](https://docs.djangoproject.com/en/stable/topics/migrations/)

### 2. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

#### N+1å•é¡Œã®å›é¿

```python
# âŒ æ‚ªã„ä¾‹ï¼ˆN+1å•é¡Œï¼‰
users = User.objects.all()
for user in users:
    print(user.groups.all())  # å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ã‚¯ã‚¨ãƒªç™ºè¡Œ

# âœ… è‰¯ã„ä¾‹ï¼ˆprefetch_relatedï¼‰
users = User.objects.prefetch_related('groups').all()
for user in users:
    print(user.groups.all())  # 1å›ã®ã‚¯ã‚¨ãƒªã§å–å¾—æ¸ˆã¿
```

#### ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®æ´»ç”¨

```python
class User(models.Model):
    employee_id = models.CharField(max_length=50, db_index=True)
    
    class Meta:
        indexes = [
            models.Index(fields=['employee_id']),
            models.Index(fields=['is_admin', 'is_active']),
            models.Index(fields=['-created_at']),
        ]
```

**ğŸ“š å‚è€ƒ:** [Django Database Optimization](https://docs.djangoproject.com/en/stable/topics/db/optimization/)

### 3. ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹

```python
# users/tests.py

from django.test import TestCase
from django.contrib.auth import get_user_model

User = get_user_model()

class UserModelTest(TestCase):
    def test_soft_delete(self):
        """è«–ç†å‰Šé™¤ã®ãƒ†ã‚¹ãƒˆ"""
        user = User.objects.create_user(
            employee_id='12345',
            username='ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼',
            password='test1234'
        )
        
        user.soft_delete()
        
        # å‰Šé™¤ãƒ•ãƒ©ã‚°ãŒç«‹ã¤
        self.assertIsNotNone(user.deleted_at)
        self.assertFalse(user.is_active)
        
        # objects ã§ã¯å–å¾—ã§ããªã„
        self.assertFalse(User.objects.filter(id=user.id).exists())
        
        # all_objects ã§ã¯å–å¾—ã§ãã‚‹
        self.assertTrue(User.all_objects.filter(id=user.id).exists())
```

**ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ:**

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆ
python manage.py test

# ç‰¹å®šã®ã‚¢ãƒ—ãƒªã®ã¿
python manage.py test users

# ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š
coverage run manage.py test
coverage report
```

**ğŸ“š å‚è€ƒ:** [Django Testing](https://docs.djangoproject.com/en/stable/topics/testing/)

---

## ãƒ‡ãƒãƒƒã‚°ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æ

### 1. Django Debug Toolbar

Django Debug Toolbar ã¯é–‹ç™ºæ™‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

#### 1.1 ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š

```python
# settings.py

INSTALLED_APPS = [
    # ...
    'debug_toolbar',
]

MIDDLEWARE = [
    'debug_toolbar.middleware.DebugToolbarMiddleware',  # å…ˆé ­ä»˜è¿‘ã«è¿½åŠ 
    # ...
]

INTERNAL_IPS = [
    '127.0.0.1',
]
```

```python
# urls.py

from django.conf import settings

if settings.DEBUG:
    import debug_toolbar
    urlpatterns = [
        path('__debug__/', include(debug_toolbar.urls)),
    ] + urlpatterns
```

**ğŸ“š å‚è€ƒ:** [Django Debug Toolbar](https://django-debug-toolbar.readthedocs.io/)

#### 1.2 ä½¿ã„æ–¹

é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®å³å´ã«ãƒ„ãƒ¼ãƒ«ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ãƒšãƒ¼ã‚¸å†…å®¹                              â”‚
â”‚                                         â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         â”‚  â”‚ DjDT     â”‚
â”‚                                         â”‚  â”‚ 7 SQL    â”‚
â”‚                                         â”‚  â”‚ 0.19s    â”‚
â”‚                                         â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨è©³ç´°æƒ…å ±ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š

- **SQL**: å®Ÿè¡Œã•ã‚ŒãŸSQLã‚¯ã‚¨ãƒª
- **Time**: å‡¦ç†æ™‚é–“
- **Request**: ãƒªã‚¯ã‚¨ã‚¹ãƒˆæƒ…å ±
- **Settings**: è¨­å®šå€¤
- **Cache**: ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®ä½¿ç”¨çŠ¶æ³

### 2. django-querycount ã®èª­ã¿æ–¹

django-querycount ã¯å„ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§å®Ÿè¡Œã•ã‚ŒãŸSQLã‚¯ã‚¨ãƒªã®çµ±è¨ˆã‚’è¡¨ç¤ºã—ã¾ã™ã€‚

#### 2.1 åŸºæœ¬çš„ãªè¦‹æ–¹

```
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |    4     |    0     |    4     |     0      |
|------|-----------|----------|----------|----------|------------|
Total queries: 4 in 0.2093s
```

**å„é …ç›®ã®æ„å‘³:**

| é …ç›® | èª¬æ˜ |
|------|------|
| **Type** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¿ã‚¤ãƒ— (RESP = ãƒ¬ã‚¹ãƒãƒ³ã‚¹) |
| **Database** | ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹å |
| **Reads** | SELECT ã‚¯ã‚¨ãƒªã®æ•° |
| **Writes** | INSERT/UPDATE/DELETE ã®æ•° |
| **Totals** | åˆè¨ˆã‚¯ã‚¨ãƒªæ•° |
| **Duplicates** | é‡è¤‡ã‚¯ã‚¨ãƒªã®æ•° |
| **Total queries: X in Y.Zs** | åˆè¨ˆã‚¯ã‚¨ãƒªæ•°ã¨å®Ÿè¡Œæ™‚é–“ |

#### 2.2 å®Ÿéš›ã®ãƒ­ã‚°åˆ†æ

##### ä¾‹1: ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†

```
http://localhost:8000/api/auth/logout/
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |    3     |    3     |    6     |     0      |
|------|-----------|----------|----------|----------|------------|
Total queries: 6 in 0.6445s
```

**è§£èª¬:**

- **Reads: 3** - ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—ãªã©
- **Writes: 3** - BEGIN, DELETE (ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤), COMMIT
- **åˆè¨ˆ: 6ã‚¯ã‚¨ãƒª** - å¦¥å½“ãªæ•°ï¼ˆãƒ­ã‚°ã‚¢ã‚¦ãƒˆã¯é‡ã„å‡¦ç†ã§ã¯ãªã„ï¼‰
- **å®Ÿè¡Œæ™‚é–“: 0.64ç§’** - ã‚„ã‚„é…ã„ï¼ˆé€šå¸¸ã¯0.1ç§’ä»¥ä¸‹ãŒç†æƒ³ï¼‰

**å®Ÿè¡Œã•ã‚ŒãŸSQL:**

```sql
-- 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³å–å¾—
SELECT * FROM "django_session" 
WHERE "session_key" = 'xxx' 
AND "expire_date" > '2025-11-18T10:54:15'

-- 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
SELECT * FROM "users" 
WHERE "deleted_at" IS NULL 
AND "id" = 1

-- 3. ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å†å–å¾—ï¼ˆä¸è¦ãªã‚¯ã‚¨ãƒªï¼‰
SELECT * FROM "django_session" 
WHERE "session_key" = 'xxx'

-- 4. ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
BEGIN

-- 5. ã‚»ãƒƒã‚·ãƒ§ãƒ³å‰Šé™¤
DELETE FROM "django_session" 
WHERE "session_key" IN ('xxx')

-- 6. ã‚³ãƒŸãƒƒãƒˆ
COMMIT
```

**æ”¹å–„ãƒã‚¤ãƒ³ãƒˆ:**

- ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’2å›å–å¾—ã—ã¦ã„ã‚‹ï¼ˆã‚¯ã‚¨ãƒª3ãŒé‡è¤‡ï¼‰
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚„ã‚»ãƒƒã‚·ãƒ§ãƒ³è¨­å®šã®è¦‹ç›´ã—ã§æ”¹å–„å¯èƒ½

##### ä¾‹2: ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ

```
http://localhost:8000/api/auth/login/
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |    3     |    4     |    7     |     0      |
|------|-----------|----------|----------|----------|------------|
Total queries: 7 in 0.1966s
```

**å®Ÿè¡Œã•ã‚ŒãŸSQL:**

```sql
-- 1. ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼
SELECT * FROM "users" 
WHERE "deleted_at" IS NULL 
AND "employee_id" = '9999'
ORDER BY "created_at" DESC 
LIMIT 1

-- 2. ã‚»ãƒƒã‚·ãƒ§ãƒ³å­˜åœ¨ãƒã‚§ãƒƒã‚¯
SELECT 1 FROM "django_session" 
WHERE "session_key" = 'xxx' 
LIMIT 1

-- 3-5. ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆï¼ˆãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ï¼‰
BEGIN
INSERT INTO "django_session" (...) VALUES (...)
COMMIT

-- 6. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å†å–å¾—
SELECT * FROM "users" 
WHERE "deleted_at" IS NULL 
AND "id" = 1

-- 7. last_login æ›´æ–°
UPDATE "users" 
SET "last_login" = '2025-11-18T10:54:24' 
WHERE "id" = 1
```

**è§£èª¬:**

- **7ã‚¯ã‚¨ãƒª** - ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã¨ã—ã¦ã¯å¦¥å½“
- **0.19ç§’** - è¨±å®¹ç¯„å›²
- **é‡è¤‡ãªã—** - è‰¯å¥½

##### ä¾‹3: ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§å–å¾—

```
http://localhost:8000/api/users/?page=1&page_size=10
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |    4     |    0     |    4     |     0      |
|------|-----------|----------|----------|----------|------------|
Total queries: 4 in 0.2093s
```

**å®Ÿè¡Œã•ã‚ŒãŸSQL:**

```sql
-- 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼
SELECT * FROM "django_session" 
WHERE "expire_date" > '2025-11-18T10:54:26' 
AND "session_key" = 'xxx'

-- 2. ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
SELECT * FROM "users" 
WHERE "deleted_at" IS NULL 
AND "id" = 1

-- 3. ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆï¼ˆãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰
SELECT COUNT(*) AS "__count" 
FROM "users" 
WHERE "deleted_at" IS NULL

-- 4. ãƒ‡ãƒ¼ã‚¿å–å¾—
SELECT * FROM "users" 
WHERE "deleted_at" IS NULL 
ORDER BY "id" ASC 
LIMIT 10
```

**è§£èª¬:**

- **4ã‚¯ã‚¨ãƒª** - ç†æƒ³çš„ï¼ˆæœ€å°é™ï¼‰
- **0.20ç§’** - è¨±å®¹ç¯„å›²
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³** - COUNT ã¨ LIMIT/OFFSET ã‚’ä½¿ç”¨

##### ä¾‹4: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°ï¼ˆå•é¡Œã‚ã‚Šï¼‰

```
http://localhost:8000/api/users/1/
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |    6     |    3     |    9     |     2      |
|------|-----------|----------|----------|----------|------------|
Total queries: 9 in 0.1296s
```

**âš ï¸ å•é¡Œç‚¹: Duplicates ãŒ 2**

```sql
-- âŒ åŒã˜ã‚¯ã‚¨ãƒªãŒ2å›å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹
Executed 2 time(s).
SELECT * FROM "users" 
WHERE "deleted_at" IS NULL 
AND "id" = 1
```

**åŸå› ã¨å¯¾ç­–:**

```python
# âŒ æ‚ªã„ä¾‹
def update(self, request, *args, **kwargs):
    user = User.objects.get(pk=self.kwargs['pk'])  # 1å›ç›®
    
    # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†...
    
    user = User.objects.get(pk=self.kwargs['pk'])  # 2å›ç›®ï¼ˆé‡è¤‡ï¼‰
    user.username = request.data['username']
    user.save()

# âœ… è‰¯ã„ä¾‹
def update(self, request, *args, **kwargs):
    user = User.objects.get(pk=self.kwargs['pk'])  # 1å›ã ã‘
    
    # ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å‡¦ç†...
    
    user.username = request.data['username']
    user.save()
```

**ğŸ“š å‚è€ƒ:** [django-querycount](https://github.com/bradmontgomery/django-querycount)

### 3. N+1å•é¡Œã®æ¤œå‡ºã¨è§£æ±º

#### 3.1 N+1å•é¡Œã¨ã¯

```python
# âŒ N+1å•é¡Œï¼ˆæ‚ªã„ä¾‹ï¼‰
users = User.objects.all()  # 1å›ã®ã‚¯ã‚¨ãƒª

for user in users:
    print(user.groups.all())  # ãƒ¦ãƒ¼ã‚¶ãƒ¼ã”ã¨ã«ã‚¯ã‚¨ãƒªï¼ˆNå›ï¼‰
    # â†’ åˆè¨ˆ: 1 + Nå›ã®ã‚¯ã‚¨ãƒª
```

**ãƒ­ã‚°å‡ºåŠ›ä¾‹:**

```
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |   101    |    0     |   101    |    100     |
|------|-----------|----------|----------|----------|------------|
Total queries: 101 in 2.5s
```

**âš ï¸ 100äººã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’å–å¾—ã™ã‚‹ã¨ 101å›ã®ã‚¯ã‚¨ãƒªï¼**

#### 3.2 è§£æ±ºæ–¹æ³•

```python
# âœ… select_relatedï¼ˆ1å¯¾1ã€å¤šå¯¾1ï¼‰
users = User.objects.select_related('profile').all()
for user in users:
    print(user.profile.bio)  # ã‚¯ã‚¨ãƒªãªã—ï¼ˆJOINæ¸ˆã¿ï¼‰

# âœ… prefetch_relatedï¼ˆå¤šå¯¾å¤šã€1å¯¾å¤šï¼‰
users = User.objects.prefetch_related('groups').all()
for user in users:
    print(user.groups.all())  # ã‚¯ã‚¨ãƒªãªã—ï¼ˆäº‹å‰å–å¾—æ¸ˆã¿ï¼‰
```

**æ”¹å–„å¾Œã®ãƒ­ã‚°:**

```
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |    2     |    0     |    2     |     0      |
|------|-----------|----------|----------|----------|------------|
Total queries: 2 in 0.05s
```

**ğŸ“š å‚è€ƒ:** [Django Select Related](https://docs.djangoproject.com/en/stable/ref/models/querysets/#select-related)

### 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 4.1 ã‚¯ã‚¨ãƒªæ•°ã®ç›®å®‰

| ã‚¯ã‚¨ãƒªæ•° | è©•ä¾¡ | å¯¾å¿œ |
|---------|------|------|
| 1-5 | âœ… å„ªç§€ | å•é¡Œãªã— |
| 6-10 | âš ï¸ è¨±å®¹ç¯„å›² | å¿…è¦ã«å¿œã˜ã¦æœ€é©åŒ– |
| 11-20 | âš ï¸ è¦æ³¨æ„ | æœ€é©åŒ–ã‚’æ¤œè¨ |
| 21+ | âŒ å•é¡Œã‚ã‚Š | å¿…ãšæœ€é©åŒ– |

#### 4.2 å®Ÿè¡Œæ™‚é–“ã®ç›®å®‰

| æ™‚é–“ | è©•ä¾¡ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ |
|------|------|------------|
| < 0.1ç§’ | âœ… å„ªç§€ | å³åº§ã«å¿œç­” |
| 0.1-0.3ç§’ | âš ï¸ è¨±å®¹ç¯„å›² | ã‚ãšã‹ãªé…å»¶ |
| 0.3-1.0ç§’ | âš ï¸ è¦æ³¨æ„ | ä½“æ„Ÿçš„ã«é…ã„ |
| > 1.0ç§’ | âŒ å•é¡Œã‚ã‚Š | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸æº€ |

#### 4.3 æœ€é©åŒ–ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```python
# 1. ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã®ç¢ºèª
class User(models.Model):
    employee_id = models.CharField(db_index=True)  # âœ… ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    
    class Meta:
        indexes = [
            models.Index(fields=['is_admin', 'is_active']),  # è¤‡åˆã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
        ]

# 2. select_related / prefetch_related
queryset = User.objects.select_related('profile').prefetch_related('groups')

# 3. only() / defer() ã§å¿…è¦ãªãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã¿å–å¾—
User.objects.only('id', 'username', 'email')

# 4. exists() ã§å­˜åœ¨ãƒã‚§ãƒƒã‚¯
if User.objects.filter(employee_id='9999').exists():  # âœ… é«˜é€Ÿ
    pass

# âŒ count() ã¯é…ã„
if User.objects.filter(employee_id='9999').count() > 0:
    pass

# 5. bulk_create() ã§ä¸€æ‹¬æŒ¿å…¥
users = [User(...), User(...), User(...)]
User.objects.bulk_create(users)  # 1å›ã®ã‚¯ã‚¨ãƒª

# âŒ ãƒ«ãƒ¼ãƒ—ã§ save() ã¯é…ã„
for user in users:
    user.save()  # Nå›ã®ã‚¯ã‚¨ãƒª
```

### 5. å®Ÿè·µçš„ãªãƒ‡ãƒãƒƒã‚°ä¾‹

#### 5.1 CSVå‡ºåŠ›ã®ã‚¨ãƒ©ãƒ¼

```
http://localhost:8000/api/users/export-csv/
|------|-----------|----------|----------|----------|------------|
| Type | Database  |   Reads  |  Writes  |  Totals  | Duplicates |
|------|-----------|----------|----------|----------|------------|
| RESP |  default  |    3     |    0     |    3     |     0      |
|------|-----------|----------|----------|----------|------------|
Total queries: 3 in 0.1911s

WARNING 2025-11-18 19:54:34,763 log Bad Request: /api/users/export-csv/
WARNING 2025-11-18 19:54:34,765 basehttp "GET /api/users/export-csv/ HTTP/1.1" 400 105
```

**åˆ†æ:**

- **400 Bad Request** - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®ã‚¨ãƒ©ãƒ¼
- **ã‚¯ã‚¨ãƒªæ•°: 3** - ãƒ‡ãƒ¼ã‚¿å–å¾—å‰ã«ã‚¨ãƒ©ãƒ¼
- **0.19ç§’** - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼

**å®Ÿè¡Œã•ã‚ŒãŸSQL:**

```sql
-- 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³æ¤œè¨¼
SELECT * FROM "django_session" ...

-- 2. ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
SELECT * FROM "users" WHERE "id" = 1

-- 3. ä»¶æ•°ã‚«ã‚¦ãƒ³ãƒˆ
SELECT COUNT(*) FROM "users" WHERE "deleted_at" IS NULL
```

**ã‚¨ãƒ©ãƒ¼åŸå› :**

```python
# views.py
def export_csv(self, request):
    queryset = self.filter_queryset(self.get_queryset())
    count = queryset.count()
    
    if count > 1100:
        return Response({
            "detail": "CSVå‡ºåŠ›ã¯1100ä»¶ã¾ã§ã§ã™ã€‚ç¾åœ¨: {count}ä»¶"
        }, status=400)
    
    if count == 0:
        return Response({
            "detail": "å‡ºåŠ›å¯¾è±¡ã®ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã›ã‚“ã€‚"
        }, status=400)
```

**å¯¾ç­–:**

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§é©åˆ‡ãªã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼š

```javascript
try {
    const response = await usersAPI.exportCSV(params);
    downloadCSVFromResponse(response, 'users.csv');
} catch (error) {
    // 400ã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ detail ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
    if (error.response?.status === 400) {
        const message = error.response.data.detail;
        notification.error(message);
    }
}
```

### 6. é–‹ç™ºç’°å¢ƒã§ã®è¨­å®š

#### 6.1 django-querycount ã®è©³ç´°è¨­å®š

```python
# settings.py

QUERYCOUNT = {
    'THRESHOLDS': {
        'MEDIUM': 50,      # 50ã‚¯ã‚¨ãƒªã§è­¦å‘Š
        'HIGH': 200,       # 200ã‚¯ã‚¨ãƒªã§ã‚¢ãƒ©ãƒ¼ãƒˆ
        'MIN_TIME_TO_LOG': 0,  # 0ç§’ä»¥ä¸Šã§è¨˜éŒ²
        'MIN_QUERY_COUNT_TO_LOG': 0,  # 0ã‚¯ã‚¨ãƒªä»¥ä¸Šã§è¨˜éŒ²
    },
    'IGNORE_REQUEST_PATTERNS': [
        r'^/__debug__/',   # Debug Toolbarã‚’é™¤å¤–
    ],
    'IGNORE_SQL_PATTERNS': [],
    'DISPLAY_DUPLICATES': 10,  # é‡è¤‡ã‚¯ã‚¨ãƒªã‚’10å€‹ã¾ã§è¡¨ç¤º
    'RESPONSE_HEADER': 'X-DjangoQueryCount-Count',  # ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼
}
```

#### 6.2 æœ¬ç•ªç’°å¢ƒã§ã®æ³¨æ„

```python
# settings.py

if DEBUG:
    INSTALLED_APPS += ['debug_toolbar']
    MIDDLEWARE = ['debug_toolbar.middleware.DebugToolbarMiddleware'] + MIDDLEWARE

# âš ï¸ æœ¬ç•ªç’°å¢ƒã§ã¯å¿…ãš DEBUG = False
DEBUG = os.getenv('DEBUG', 'False') == 'True'
```

**æœ¬ç•ªç’°å¢ƒã§ã®ãƒ­ã‚°è¨˜éŒ²:**

```python
# settings.py

LOGGING = {
    'version': 1,
    'handlers': {
        'file': {
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': BASE_DIR / 'logs' / 'django.log',
            'maxBytes': 10 * 1024 * 1024,  # 10MB
            'backupCount': 10,
        },
    },
    'loggers': {
        'django.db.backends': {  # SQLã‚¯ã‚¨ãƒªã‚’ãƒ­ã‚°ã«è¨˜éŒ²
            'handlers': ['file'],
            'level': 'DEBUG',
        },
    },
}
```

---

## ã¾ã¨ã‚

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€Django + Vue.js 3 ã®å®Ÿè·µçš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è§£èª¬ã—ã¾ã—ãŸã€‚

**é‡è¦ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³:**

- **è«–ç†å‰Šé™¤**: ãƒ‡ãƒ¼ã‚¿å¾©æ—§å¯èƒ½ãªå‰Šé™¤æ–¹å¼
- **ç›£æŸ»ãƒ­ã‚°**: ã‚·ã‚°ãƒŠãƒ«ã«ã‚ˆã‚‹è‡ªå‹•è¨˜éŒ²
- **æ¨©é™ç®¡ç†**: æœ€å¾Œã®ç®¡ç†è€…å‰Šé™¤é˜²æ­¢
- **CSVå‡ºåŠ›**: æ¤œç´¢æ¡ä»¶ã‚’åæ˜ ã—ãŸã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- **åŒæ™‚æ“ä½œå¯¾ç­–**: å‰Šé™¤æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã®æ¤œçŸ¥

**å‚è€ƒãƒªãƒ³ã‚¯:**

- [Django å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.djangoproject.com/)
- [Django REST Framework](https://www.django-rest-framework.org/)
- [Vue.js 3](https://vuejs.org/)
- [Pinia](https://pinia.vuejs.org/)
- [Vuetify 3](https://vuetifyjs.com/)
- [Vue Router 4](https://router.vuejs.org/)

é–‹ç™ºã‚’é€²ã‚ã‚‹ä¸­ã§ä¸æ˜ç‚¹ãŒã‚ã‚Œã°ã€å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’å‚ç…§ã—ã¦ãã ã•ã„!