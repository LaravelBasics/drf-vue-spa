ç°¡å˜ãªsessionèªè¨¼ã‚„ã¤9/15


ãƒ—ãƒ«ã«è¨€ã†ã¨ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ–ãƒ©ã‚¦ã‚¶ã§æœ€åˆã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã¨ãã«èª­ã¿è¾¼ã¾ã‚Œã‚‹ã®ã¯ index.html ã§ã™ã€‚ãã—ã¦ã€ãã® index.html ãŒVue.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã€ãã®ä¸­ã§Vue RouterãŒå‹•ãã€ã¨ã„ã†æµã‚Œã§ã™ã€‚

ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®èµ·å‹•ãƒ—ãƒ­ã‚»ã‚¹
å…·ä½“çš„ãªæµã‚Œã‚’ã€ã‚ãªãŸãŒæä¾›ã—ã¦ãã‚ŒãŸã‚³ãƒ¼ãƒ‰ã¨é–¢é€£ä»˜ã‘ãªãŒã‚‰è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ http://localhost:8080/ ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ã¾ã™ã€‚

index.html ã®èª­ã¿è¾¼ã¿: Webã‚µãƒ¼ãƒãƒ¼ï¼ˆé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ï¼‰ã¯ã€ãã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾ã—ã¦ã€C:\Users\pvufx\Desktop\template\frontend\index.html ã‚’è¿”ã—ã¾ã™ã€‚

JavaScriptãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿: ãƒ–ãƒ©ã‚¦ã‚¶ã¯ index.html ã‚’è§£æã—ã€<body> ã‚¿ã‚°ã®ä¸­ã«ã‚ã‚‹ä»¥ä¸‹ã® <script> ã‚¿ã‚°ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚

HTML

<script type="module" src="/src/main.js"></script>

ã“ã® <script> ã‚¿ã‚°ã¯ã€src/main.js ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ãƒ–ãƒ©ã‚¦ã‚¶ã«æŒ‡ç¤ºã—ã¦ã„ã¾ã™ã€‚

Vue.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®èµ·å‹•: src/main.js ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ã€Vue.jsã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã€ã‚ãªãŸã® router/index.js ã§å®šç¾©ã•ã‚ŒãŸãƒ«ãƒ¼ã‚¿ãƒ¼ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã¾ã‚Œã¾ã™ã€‚

Vue Routerã®å‹•ä½œ: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ·å‹•ã™ã‚‹ã¨ã€Vue Routerã¯ç¾åœ¨ã®URLï¼ˆã“ã®å ´åˆã¯ /ï¼‰ã‚’è¦‹ã¦ã€ã©ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã¹ãã‹åˆ¤æ–­ã—ã¾ã™ã€‚ãã—ã¦ã€ã‚ãªãŸã® router/index.js ã®è¨­å®šã«å¾“ã£ã¦ã€Home.vue ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒ index.html ã® <div id="app"></div> ã®ä¸­ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

main.js ã®å½¹å‰²
main.js ã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã™ã¹ã¦ã®éƒ¨å“ã‚’çµã³ã¤ã‘ã€Vue.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’åˆæœŸåŒ–ã™ã‚‹å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚

createApp (Vue.jsã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ)ã€createPinia (çŠ¶æ…‹ç®¡ç†)ã€App.vue (ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)ã€ãã—ã¦ã‚ãªãŸãŒä½œæˆã—ãŸãƒ«ãƒ¼ã‚¿ãƒ¼ï¼ˆrouterï¼‰ ãªã©ã‚’ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ä½¿ãˆã‚‹ã‚ˆã†ã«èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚

ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä½œæˆ

JavaScript

const app = createApp(App);
ã“ã“ã§ã€Vue.jsã®æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™ã€‚App ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã€ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã€Œè¦ªã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ãªã‚Šã¾ã™ã€‚

ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã®çµ„ã¿è¾¼ã¿

JavaScript

app.use(createPinia().use(piniaPluginPersistedstate));
app.use(router); // ğŸ‘ˆ ã“ã“ã§ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã‚€
app.use(vuetify);

app.use() ã¯ã€ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã€ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚„çŠ¶æ…‹ç®¡ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆPiniaï¼‰ã€UIãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆVuetifyï¼‰ã¨ã„ã£ãŸæ©Ÿèƒ½ã‚’è¿½åŠ ã™ã‚‹å½¹å‰²ã‚’æ‹…ã„ã¾ã™ã€‚ã“ã®æ™‚ç‚¹ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãƒ«ãƒ¼ãƒˆï¼ˆURLï¼‰ã®å¤‰æ›´ã‚’èªè­˜ã—ã€ãã‚Œã«å¿œã˜ã¦ç”»é¢ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹æº–å‚™ãŒæ•´ã„ã¾ã™ã€‚

DOMã¸ã®ãƒã‚¦ãƒ³ãƒˆ

JavaScript

app.mount('#app');
ã“ã®æœ€å¾Œã®è¡ŒãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’HTMLã«è¡¨ç¤ºã™ã‚‹é­”æ³•ã§ã™ã€‚index.html ã® <div id="app"></div> ã‚’æ¢ã—ã€ãã“ã«Vue.jsã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã—ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ç”»é¢ã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã—ãŸãŒã£ã¦ã€index.html â†’ main.js â†’ router/index.js ã¨ã„ã†æµã‚Œã§å‡¦ç†ãŒé€²ã¿ã¾ã™ã€‚

main.js ãŒã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã™ã¹ã¦ã®éƒ¨å“ï¼ˆãƒ«ãƒ¼ã‚¿ãƒ¼ã€çŠ¶æ…‹ç®¡ç†ã€UIï¼‰ã‚’é›†ã‚ã¦ã€æœ€çµ‚çš„ã«ãƒ–ãƒ©ã‚¦ã‚¶ã®ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã€Œå¸ä»¤å¡”ã€ã®ã‚ˆã†ãªå½¹å‰²ã‚’æœãŸã—ã¦ã„ã‚‹ã‚ã‘ã§ã™ã€‚

router/index.js ã®å½¹å‰²
main.js ãŒã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’çµ„ã¿è¾¼ã‚€ã¨ã€Vue Routerã¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒšãƒ¼ã‚¸ã®é·ç§»ï¼‰ã‚’ç®¡ç†ã—å§‹ã‚ã¾ã™ã€‚ãã®éš›ã€å„ãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å‰ã«ç‰¹åˆ¥ãªå‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«è¨­å®šã§ãã¾ã™ã€‚

ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ãã®ç‰¹æ®Šãªå‡¦ç†ã¨ã—ã¦**router.beforeEach(authGuard)** ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚ã“ã‚Œã¯ã€ã€Œã™ã¹ã¦ã®ãƒ«ãƒ¼ãƒˆã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹å‰ã«ã€å¿…ãš authGuard é–¢æ•°ã‚’å®Ÿè¡Œã—ãªã•ã„ã€ ã¨ã„ã†å‘½ä»¤ã§ã™ã€‚

auth-guard.js ã®å½¹å‰²
ã“ã® authGuard.js ã“ããŒã€èªè¨¼ã®è¦ã¨ãªã‚‹éƒ¨åˆ†ã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã‹ã€ã“ã‚Œã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã‚ˆã†ã¨ã—ã¦ã„ã‚‹ãƒšãƒ¼ã‚¸ãŒèªè¨¼ã‚’å¿…è¦ã¨ã™ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€é©åˆ‡ãªãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ±ºå®šã—ã¾ã™ã€‚

/ (ãƒ«ãƒ¼ãƒˆ) ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã® authGuard ã®å…·ä½“çš„ãªå‹•ä½œã¯ä»¥ä¸‹ã®é€šã‚Šã§ã™ã€‚

setCsrfToken() ã®å®Ÿè¡Œ: ãƒšãƒ¼ã‚¸é·ç§»ãŒå§‹ã¾ã‚‹å‰ã«ã€Djangoã‹ã‚‰ã®CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’éåŒæœŸã§å–å¾—ã—ã¾ã™ã€‚ã“ã‚Œã¯ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã§å¿…è¦ã§ã™ã€‚

ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯: if (to.path === '/login') ã®æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã®å ´åˆã¯ / ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ãªã®ã§ã€ã“ã®æ¡ä»¶ã¯æº€ãŸã•ã‚Œã¾ã›ã‚“ã€‚

èªè¨¼ãŒå¿…è¦ã‹ã©ã†ã‹ã®ãƒã‚§ãƒƒã‚¯: if (to.meta.requiresAuth) ã®æ¡ä»¶ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚router/index.js ã®è¨­å®šã§ã€/ ã®ãƒ«ãƒ¼ãƒˆã«ã¯ meta: { requiresAuth: true } ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã“ã®æ¡ä»¶ã¯æº€ãŸã•ã‚Œã¾ã™ã€‚

ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®æœ‰ç„¡ã‚’ãƒã‚§ãƒƒã‚¯: if (!auth.user) ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã¾ã ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ãªã„å ´åˆï¼ˆauth.user ãŒnullï¼‰ã€auth.fetchUser() ã‚’å®Ÿè¡Œã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ã¾ã™ã€‚

èªè¨¼æˆåŠŸã®å ´åˆ: auth.fetchUser() ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ããŸå ´åˆã€auth.user ã«å€¤ãŒå…¥ã‚Šã€æ¬¡ã® if (!auth.user) ã®æ¡ä»¶ã¯æº€ãŸã•ã‚Œãšã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãã®ã¾ã¾ç¶šè¡Œã•ã‚Œã€Home.vue ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

èªè¨¼å¤±æ•—ã®å ´åˆ: auth.fetchUser() ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã€auth.user ã¯null ã®ã¾ã¾ã§ã€æ¬¡ã® if (!auth.user) ã®æ¡ä»¶ãŒæº€ãŸã•ã‚Œã¾ã™ã€‚ãã®çµæœã€return { path: '/login', ... } ãŒå®Ÿè¡Œã•ã‚Œã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸(/login)ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚Œã¾ã™ã€‚

ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Œäº†: ä¸Šè¨˜ã®ãƒã‚§ãƒƒã‚¯ã‚’ã™ã¹ã¦ãƒ‘ã‚¹ã—ãŸå ´åˆã€return true ãŒå®Ÿè¡Œã•ã‚Œã€Vue Routerã¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç¶šè¡Œã—ã€/ ã«å¯¾å¿œã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆã“ã®å ´åˆã¯ Home.vueï¼‰ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«è¡¨ç¤ºã—ã¾ã™ã€‚

ã“ã®ã‚ˆã†ã«ã€router/index.js ã¨ auth-guard.js ã¯å”åŠ›ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé©åˆ‡ãªæ¨©é™ã‚’æŒã£ã¦ã„ãªã„é™ã‚Šã€èªè¨¼ãŒå¿…è¦ãªãƒšãƒ¼ã‚¸ã«ã¯ã‚¢ã‚¯ã‚»ã‚¹ã•ã›ãªã„ã¨ã„ã†ã€é‡è¦ãªã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®å½¹å‰²ã‚’æœãŸã—ã¦ã„ã¾ã™ã€‚


***************************************************************************

1. auth.fetchUser() ã®å‘¼ã³å‡ºã—
auth-guard.js ã®ä¸­ã§ await auth.fetchUser(); ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

ã“ã‚Œã¯ã€Piniaã®ã‚¹ãƒˆã‚¢ã§ã‚ã‚‹ useAuthStore å†…ã® fetchUser ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã®å½¹å‰²ã¯ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å°‹ã­ã‚‹ã“ã¨ã§ã™ã€‚

2. plugins/axios.js ã®åˆ©ç”¨
fetchUser() ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã«ã¯ const res = await api.get('me/'); ã¨ã„ã†è¡ŒãŒã‚ã‚Šã¾ã™ã€‚

ã“ã‚Œã¯ã€ã‚ãªãŸãŒå…±é€šåŒ–ã—ãŸ api ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼ˆplugins/axios.js ã§å®šç¾©ï¼‰ã‚’ä½¿ã£ã¦ã€me/ ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã«GETãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ã‚‹ã“ã¨ã‚’æ„å‘³ã—ã¾ã™ã€‚ã“ã® api ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã¯ã€baseURL: 'http://localhost:8000/api/' ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€å®Ÿéš›ã«ã¯ http://localhost:8000/api/me/ ã¨ã„ã†URLã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã™ã€‚

ã“ã®ã¨ãã€plugins/axios.js ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ãŒå‹•ãã€withCredentials: true ã®ãŠã‹ã’ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒƒã‚­ãƒ¼ï¼ˆsessionidï¼‰ãŒè‡ªå‹•çš„ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã¾ã‚Œã¾ã™ã€‚

3. Djangoãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã§ã®å‡¦ç†
ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã€ã‚ãªãŸã®Djangoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®URLè¨­å®šã«å¾“ã£ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¾ã™ã€‚

backend/config/urls.py: /api/ ã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ api.urls ã«è»¢é€ã•ã‚Œã¾ã™ã€‚

Python

path('api/', include('api.urls'))
backend/api/urls.py: me/ ã®ãƒ‘ã‚¹ãŒ me_api ãƒ“ãƒ¥ãƒ¼ã«è»¢é€ã•ã‚Œã¾ã™ã€‚

Python

path('me/', me_api, name='me')
backend/api/views.py: me_api é–¢æ•°ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

if not request.user.is_authenticated: ã§ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«æœ‰åŠ¹ãªã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚¯ãƒƒã‚­ãƒ¼ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚

ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒæœ‰åŠ¹ãªå ´åˆ: request.user ã«ãƒ­ã‚°ã‚¤ãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚return Response({'username': request.user.username, 'email': request.user.email}) ã«ã‚ˆã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å«ã‚€JSONãƒ‡ãƒ¼ã‚¿ãŒãƒ¬ã‚¹ãƒãƒ³ã‚¹ã¨ã—ã¦è¿”ã•ã‚Œã¾ã™ã€‚

ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒç„¡åŠ¹ãªå ´åˆ: èªè¨¼ã•ã‚Œã¦ã„ãªã„ãŸã‚ã€return Response({'detail':'unauthenticated'}, status=401) ãŒè¿”ã•ã‚Œã¾ã™ã€‚ã“ã®ã¨ãã€HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ 401 Unauthorized ã¨ãªã‚Šã¾ã™ã€‚

4. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã¯ã€plugins/axios.js ã«è¨­å®šã•ã‚Œã¦ã„ã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ãŒã€Djangoã‹ã‚‰ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’å—ã‘å–ã‚Šã¾ã™ã€‚

èªè¨¼æˆåŠŸã®å ´åˆ: HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ 200 OK ã§ã™ã€‚const res = await api.get('me/'); ã® res.data ã«ã¯ã€Djangoã‹ã‚‰è¿”ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ï¼ˆ{username: '...', email: '...'}ï¼‰ãŒå…¥ã‚Šã¾ã™ã€‚auth.user.value = res.data; ã§ã€Piniaã‚¹ãƒˆã‚¢ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒæ›´æ–°ã•ã‚Œã¾ã™ã€‚

èªè¨¼å¤±æ•—ã®å ´åˆ: HTTPã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯ 401 Unauthorized ã§ã™ã€‚Promise.reject(error) ãŒå‘¼ã³å‡ºã•ã‚Œã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã«ç§»ã‚Šã¾ã™ã€‚ã“ã®ã¨ãã€onAuthErrorCallback() ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã¯ auth.js ã§ç™»éŒ²ã•ã‚Œã¦ã„ã‚‹ logout() é–¢æ•°ã‚’å‘¼ã³å‡ºã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’ã‚¯ãƒªã‚¢ã—ã€/login ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹å‡¦ç†ã§ã™ã€‚

5. ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®å®Œäº†
èªè¨¼æˆåŠŸ: auth.user ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒã‚»ãƒƒãƒˆã•ã‚Œã€auth-guard.js ã§ return true; ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€router/index.js ã®è¦ªãƒ«ãƒ¼ãƒˆã§ã‚ã‚‹ / ã«å¯¾å¿œã™ã‚‹ Home.vue ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ã€‚

èªè¨¼å¤±æ•—: auth-guard.js ã® if (!auth.user) ã®æ¡ä»¶ãŒæº€ãŸã•ã‚Œã€return { path: '/login', ... } ãŒå®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€Vue RouterãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ /login ã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã—ã¾ã™ã€‚ã‚ãªãŸã®è¨­å®šã§ã¯ /login ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã•ã‚ŒãŸå¾Œã€router/index.js ã®ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰ãƒ«ãƒ¼ãƒˆã®redirect: routes.LOGIN ã«ã¯ãƒãƒƒãƒã›ãšã€æ˜ç¢ºã«å®šç¾©ã•ã‚ŒãŸ /login ãƒ«ãƒ¼ãƒˆã«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¾ã™ã€‚



*******************************************************************************

ã‚ãªãŸã®ã‚³ãƒ¼ãƒ‰ã®å„è¡Œã¯ã€ä»¥ä¸‹ã®å½¹å‰²ã‚’æ‹…ã£ã¦ã„ã¾ã™ã€‚

import 'vuetify/styles';:

ã“ã®è¡Œã¯ã€Vuetifyã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚·ãƒ¼ãƒˆï¼ˆCSSï¼‰ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®Vuetifyã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«é©åˆ‡ãªãƒ‡ã‚¶ã‚¤ãƒ³ãŒé©ç”¨ã•ã‚Œã¾ã™ã€‚

import { createVuetify } from 'vuetify';:

Vuetifyã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã™ã‚‹ãŸã‚ã® createVuetify é–¢æ•°ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

import * as components from 'vuetify/components';:

VuetifyãŒæä¾›ã™ã‚‹ã™ã¹ã¦ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆVBtn, VCard, VTextFieldãªã©ï¼‰ã‚’componentsã¨ã„ã†åå‰ã§ã¾ã¨ã‚ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

import * as directives from 'vuetify/directives';:

Vuetifyã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ï¼ˆv-modelã®ã‚ˆã†ãªç‰¹åˆ¥ãªå±æ€§ï¼‰ã‚’directivesã¨ã„ã†åå‰ã§ã¾ã¨ã‚ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚

export default createVuetify({...});:

æœ€å¾Œã«ã€createVuetify é–¢æ•°ã‚’ä½¿ã£ã¦Vuetifyã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã€ãã‚Œã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã™ã€‚ã“ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒã€main.js ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«çµ„ã¿è¾¼ã¾ã‚Œã‚‹ã“ã¨ã§ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§Vuetifyã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„æ©Ÿèƒ½ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

ã“ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ main.js ãŒèª­ã¿è¾¼ã¿ã€app.use(vuetify) ã§ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«é©ç”¨ã™ã‚‹ã“ã¨ã§ã€ã‚ãªãŸã¯ã©ã®Vueã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‹ã‚‰ã§ã‚‚Vuetifyã®UIéƒ¨å“ã‚’å‘¼ã³å‡ºã—ã¦ä½¿ã†ã“ã¨ãŒã§ãã¾ã™ã€‚

SCSSãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ:
frontend/src/assets/style/main.scss ã®ã‚ˆã†ãªå ´æ‰€ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€Vuetifyã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¹ã‚¿ã‚¤ãƒ«ã‚’ä¸Šæ›¸ãã—ãŸã„ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ï¼ˆã‚¯ãƒ©ã‚¹ã‚„IDãªã©ï¼‰ã‚’è¨˜è¿°ã—ã¾ã™ã€‚

SCSS

// ä¾‹ï¼šVuetifyã®ãƒœã‚¿ãƒ³ã®è‰²ã‚’ä¸Šæ›¸ãã™ã‚‹
.v-btn {
  background-color: #ff5722 !important; // å¥½ããªè‰²ã«å¤‰æ›´
}

// ç‰¹å®šã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã®ã¿é©ç”¨ã™ã‚‹
.my-custom-card {
  background-color: #f5f5f5;
  box-shadow: none;
}
main.js ã¸ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ:
ã“ã®SCSSãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã«é©ç”¨ã™ã‚‹ãŸã‚ã€main.js ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

JavaScript

// src/main.js

import { createApp } from 'vue';
import App from './App.vue';
// ...ãã®ä»–ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import vuetify from './plugins/vuetify';

// ä½œæˆã—ãŸSCSSãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã“ã“ã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import './assets/style/main.scss'; 

const app = createApp(App);

app.use(vuetify);
app.mount('#app');
ã“ã®ã‚ˆã†ã«ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•æ™‚ã«Vuetifyã®ã‚¹ã‚¿ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã€ãã®å¾Œã«ã‚«ã‚¹ã‚¿ãƒ CSSãŒä¸Šæ›¸ãã•ã‚Œã‚‹ãŸã‚ã€ç‹™ã£ãŸé€šã‚Šã®ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é©ç”¨ã§ãã¾ã™ã€‚

*************************************************************************

// src/router/auth-guard.js

import { useAuthStore } from '@/stores/auth';
import { setCsrfToken } from '@/plugins/axios';

// beforeEachã§ä½¿ã†èªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’é–¢æ•°ã¨ã—ã¦ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
export const authGuard = async (to) => {
    const auth = useAuthStore();

    // ãƒšãƒ¼ã‚¸é·ç§»æ™‚ã«CSRFãƒˆãƒ¼ã‚¯ãƒ³ã‚’äº‹å‰ã«å–å¾—
    await setCsrfToken();

    // ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã®å ´åˆã®å‡¦ç†
    if (to.path === '/login') {
        if (auth.user) {
            return { path: '/' };
        }
        return true;
    }

    // ãƒ«ãƒ¼ãƒˆãŒèªè¨¼ã‚’è¦æ±‚ã™ã‚‹å ´åˆã®å‡¦ç†
    if (to.meta.requiresAuth) {
        if (!auth.user) {
            await auth.fetchUser();
        }

        if (!auth.user) {
            return { path: '/login', query: { next: to.fullPath } };
        }
    }

    // å•é¡Œãªã‘ã‚Œã°ä½•ã‚‚ã—ãªã„ï¼ˆæ¬¡ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã¸é€²ã‚€ï¼‰
    return true;
};

// src/router/index.js

import { createRouter, createWebHistory } from 'vue-router';
// ğŸ’¡ åˆ†é›¢ã—ãŸèªè¨¼ãƒ­ã‚¸ãƒƒã‚¯ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
import { authGuard } from './auth-guard.js';
import { routes } from '@/constants/routes';

const router = createRouter({
    history: createWebHistory(),
    routes: [
        {
            // ğŸ’¡ èªè¨¼ãŒå¿…è¦ãªãƒ«ãƒ¼ãƒˆã‚’ã¾ã¨ã‚ã‚‹ãŸã‚ã®è¦ªãƒ«ãƒ¼ãƒˆ
            path: '/',
            meta: { requiresAuth: true }, // ğŸ‘ˆ ã“ã“ã«ã¾ã¨ã‚ã¦å®šç¾©
            children: [
                {
                    path: routes.HOME, // ğŸ’¡ ãƒ‘ã‚¹ã¯ '/home' ã®ã¾ã¾
                    name: 'Home',
                    component: () =>
                        import(
                            /* webpackChunkName: "home" */ '@/views/Home.vue'
                        ),
                },
                // {
                //     path: routes.PROFILE, // ğŸ’¡ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒšãƒ¼ã‚¸ã‚‚è¿½åŠ 
                //     name: 'Profile',
                //     component: () =>
                //         import(
                //             /* webpackChunkName: "login" */ '@/views/Login.vue'
                //         ),
                // },
            ],
        },
        {
            path: routes.LOGIN,
            name: 'Login',
            component: () => import('@/views/Login.vue'),
        },
        {
            path: '/:pathMatch(.*)*',
            redirect: routes.LOGIN,
        },
    ],
});

// ğŸ’¡ å‘¼ã³å‡ºã—ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«
router.beforeEach(authGuard);

export default router;

C:\Users\pvufx\Desktop\template\frontend\src\plugins\axios.js

import axios from 'axios';
import Cookies from 'js-cookie';

// axios ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å…±é€šåŒ–
const api = axios.create({
    baseURL: 'http://localhost:8000/api/',
    withCredentials: true,
});

// CSRFãƒˆãƒ¼ã‚¯ãƒ³è¨­å®šé–¢æ•°
export async function setCsrfToken() {
    try {
        await api.get('csrf/');
    } catch (error) {
        console.error('CSRFãƒˆãƒ¼ã‚¯ãƒ³ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
    }
}

// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆCSRFãƒˆãƒ¼ã‚¯ãƒ³ç”¨ï¼‰
api.interceptors.request.use((config) => {
    const methodsRequiringCsrf = ['post', 'put', 'patch', 'delete'];
    if (methodsRequiringCsrf.includes(config.method)) {
        const csrfToken = Cookies.get('csrftoken');
        if (csrfToken) {
            config.headers['X-CSRFToken'] = csrfToken;
        }
    }
    return config;
});

// ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ï¼ˆèªè¨¼ã‚¨ãƒ©ãƒ¼ç”¨ï¼‰
// **ã“ã®é–¢æ•°ãŒauth.jsã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™**
let onAuthErrorCallback = null;
export const setOnAuthErrorCallback = (callback) => {
    onAuthErrorCallback = callback;
};

api.interceptors.response.use(
    (response) => response,
    (error) => {
        if (
            error.response &&
            (error.response.status === 401 || error.response.status === 403)
        ) {
            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆAPIã¸ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‹ã‚‰ã®ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ã™ã‚‹
            const isLogoutRequest = error.config.url.endsWith('logout/');
            if (!isLogoutRequest && onAuthErrorCallback) {
                // èªè¨¼ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å®Ÿè¡Œ
                onAuthErrorCallback();
            }
        }
        return Promise.reject(error);
    },
);

export default api;

C:\Users\pvufx\Desktop\template\frontend\src\stores\auth.js

import { defineStore } from 'pinia';
import { ref } from 'vue';
import api, { setOnAuthErrorCallback } from '@/plugins/axios';
import router from '@/router';

export const useAuthStore = defineStore(
    'auth',
    () => {
        const user = ref(null);
        const loading = ref(false);

        // Axiosã‚¤ãƒ³ã‚¿ãƒ¼ã‚»ãƒ—ã‚¿ãƒ¼ã«ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†ã‚’ç™»éŒ²
        // ã“ã‚Œã«ã‚ˆã‚Šã€å¾ªç’°ä¾å­˜ãŒè§£æ¶ˆã•ã‚Œã‚‹
        setOnAuthErrorCallback(() => {
            logout();
        });

        async function loginSession(username, password) {
            loading.value = true;
            try {
                await api.post('login/', { username, password });
                await fetchUser();
                return true;
            } catch (e) {
                console.error('login failed', e);
                return false;
            } finally {
                loading.value = false;
            }
        }

        async function fetchUser() {
            try {
                const res = await api.get('me/');
                user.value = res.data;
            } catch (e) {
                user.value = null;
                console.error('fetchUser failed', e);
            }
        }

        async function logout() {
            // user.valueãŒnullã§ãªã„ï¼ˆï¼ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ãƒ­ã‚°ã‚¤ãƒ³çŠ¶æ…‹ã¨èªè­˜ã•ã‚Œã¦ã„ã‚‹ï¼‰å ´åˆã®ã¿ã€
            // logout APIã‚’å‘¼ã³å‡ºã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€ã‚»ãƒƒã‚·ãƒ§ãƒ³åˆ‡ã‚Œå¾Œã®ç„¡é§„ãªAPIå‘¼ã³å‡ºã—ã‚’é˜²ãã€‚
            if (user.value) {
                try {
                    await api.post('logout/');
                } catch (e) {
                    console.error('logout failed', e);
                }
            }

            // APIå‘¼ã³å‡ºã—ã®æˆåŠŸãƒ»å¤±æ•—ã«é–¢ã‚ã‚‰ãšã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çŠ¶æ…‹ã‚’ã‚¯ãƒªã‚¢ã—ã¦ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
            user.value = null;
            router.push('/login');
        }

        // `router.beforeEach`ã§å‘¼ã³å‡ºã™ãŸã‚ã®é–¢æ•°ã¨ã—ã¦è¿”ã™
        return { user, loading, loginSession, fetchUser, logout };
    },
    {
        // ğŸ’¡ ã“ã“ã«æ°¸ç¶šåŒ–è¨­å®šã‚’è¿½åŠ 
        persist: true,
    },
);

main.js
// main.js

import { createApp } from 'vue';
import { createPinia } from 'pinia';
import App from './App.vue';
import router from './router';
import vuetify from './plugins/vuetify';
import '@mdi/font/css/materialdesignicons.css';
import piniaPluginPersistedstate from 'pinia-plugin-persistedstate';

const app = createApp(App);

app.use(createPinia().use(piniaPluginPersistedstate));
app.use(router);
app.use(vuetify);
app.mount('#app');




// src/constants/routes.js

export const routes = {
    HOME: '/',
    LOGIN: '/login',
    // PROFILE: '/profile',
    // DASHBOARD: '/dashboard',
};



C:\Users\pvufx\Desktop\template\frontend\src\views\Login.vue
<script setup>
import { ref } from 'vue';
import { useRouter, useRoute } from 'vue-router';
import { useAuthStore } from '@/stores/auth';

const auth = useAuthStore();
const router = useRouter();
const route = useRoute();

const username = ref('');
const password = ref('');
const error = ref('');
const loading = ref(false);

async function onSubmit() {
    error.value = '';
    loading.value = true;
    const ok = await auth.loginSession(username.value, password.value);
    loading.value = false;

    if (ok) {
        const redirect = route.query.next || '/';
        router.push(redirect);
    } else {
        error.value =
            'ãƒ­ã‚°ã‚¤ãƒ³ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚';
    }
}
</script>

<template>
    <v-container>
        <v-row justify="center">
            <v-col class="fixed-col">
                <v-card rounded="lg" elevation="10">
                    <v-toolbar
                        color="blue-darken-3"
                        dark
                        flat
                        class="rounded-t-lg"
                    >
                        <div class="d-flex w-100 justify-center align-center">
                            <span class="text-h5 font-weight-bold text-white">
                                ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢
                            </span>
                        </div>
                    </v-toolbar>
                    <v-card-text class="py-6 px-4">
                        <v-form @submit.prevent="onSubmit">
                            <v-text-field
                                v-model="username"
                                label="ãƒ¦ãƒ¼ã‚¶ãƒ¼å"
                                required
                                prepend-inner-icon="mdi-account"
                            />
                            <v-text-field
                                v-model="password"
                                label="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰"
                                type="password"
                                required
                                prepend-inner-icon="mdi-lock"
                            />
                            <v-btn
                                type="submit"
                                :loading="loading"
                                color="blue-darken-3"
                                class="mt-6"
                                block
                                size="large"
                            >
                                ãƒ­ã‚°ã‚¤ãƒ³
                            </v-btn>
                        </v-form>
                    </v-card-text>
                    <v-card-actions v-if="error" class="justify-center">
                        <v-alert
                            type="error"
                            dense
                            outlined
                            class="text-center w-100"
                            >{{ error }}</v-alert
                        >
                    </v-card-actions>
                </v-card>
            </v-col>
        </v-row>
    </v-container>
</template>

<style scoped></style>















































